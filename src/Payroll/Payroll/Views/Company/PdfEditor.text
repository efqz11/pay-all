@{
    ViewData["Title"] = "Home Page";
}

@section scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.0.943/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.2.9/interact.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.0.943/pdf.worker.min.js"></script>

    <script src="~/js/pdfSetup.js"></script>

    <script type="text/javascript">
        var currentPageWidth = 0;
        var currentPageHeight = 0;
        var currentPageScale = 1;
        var $pdfCanvas;
        var $viewerToolbar;
        // var renderTimer = null;
        var password;
        var drawing = false;
        var pageScale = 1;
        var scales = {};
        var pageHeights = {};
        var pageWidths = {};
        var tbScales = {};
        var redoArray = { 0: [] };
        var undoArray = { 0: [] };
        var redoing = false;
        var lastActiveElement;
        var lastSavedJson;
        var firstSaved = true;
        var rotatedPages = {};
        var deletedAnnots = {};
        var deletedFields = {};
        var lastFormHandles = {};
        var thumbnailsView = false;
        var lastPageNumber;
        var lastMergeNumber = 0;
        var protectSettings = {};
        var tbHeight = 200;
        var tbSizes = {};
        var renderingPage = true;
        var firstRender = true;
        var savingTimeout;
        var formsEnabled = false;
        var firstLoad = true;
        var processType = "Editor";
        var changedOrder = false;
        $("#page_num").hide();
        $("#one_page").hide();
        $("#nav-btns").hide();
        $('[data-toggle="popover"]').popover();
        $('#symbols-popover').on('shown.bs.popover', function () {
            $(".close-symbols-popover").on('click', function () {
                $('#symbols-popover').popover('hide');
            });
        })
        $('#shapes-popover').on('shown.bs.popover', function () {
            $(".close-shapes-popover").on('click', function () {
                $('#shapes-popover').popover('hide');
            });
        });
        $('.nav-tabs a').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
        });
        const lozadEl = document.querySelector('canvas');
        const lozadOb = lozad('.thumb-canvas', {
            load: function (el) {
                $pdfCanvas.PDFViewer("renderThumbnail", "thumb_canvas_", el.getAttribute('id').replace('thumb_canvas_', ''), true);
            }
        });
        const lozadSort = lozad('.page-canvas', {
            load: function (el) {
                $pdfCanvas.PDFViewer("renderThumbnail", "sortable_canvas_", el.getAttribute('id').replace('sortable_canvas_', ''), false);
            }
        });

        $("#pdf-password-form").on('submit', function (e) {
            var passwordFieldLength = $("#pro_file_pdf_password").val().length;
            if (passwordFieldLength > 0) {
                $("#password-error").remove();
                $("#progress-block").show();
                $("#password-error-message").hide();
            } else {
                $("#password-error").remove();
                $("#password-field-group").append("<p id='password-error' style='color:red;font-weight:bold;'>You have not entered a password.</p>");
                return false;
            }
        });

        $('#open-password-checkbox').change(function () {
            if (this.checked) {
                $("#open-password-error").remove();
                $("#open-password-required").prop("disabled", false);
                $("#document-open-alert").text("This password will be required to open this PDF.");
            } else {
                $("#open-password-error").remove();
                $("#open-password-required").prop("disabled", true);
                $("#document-open-alert").text("No password will be required to open this PDF.");
                $("#open-password-input").val("");
                $("#open-password-confirmation-input").val("");
            }
        });

        $('#owner-password-checkbox').change(function () {
            if (this.checked) {
                $("#owner-perm-error").remove();
                $("#owner-password-required").prop("disabled", false);
            } else {
                $("#owner-perm-error").remove();
                $("#owner-password-required").prop("disabled", true);
                $("#owner-password-input").val("");
                $("#owner-password-confirmation-input").val("");
            }
        });

        $("#submit-protect-btn").on("click", function () {
            var openPasswordField = $("#open-password-input").val();
            var ownPasswordField = $("#owner-password-input").val();
            var openChecked = $("#open-password-checkbox").prop("checked");
            var ownerChecked = $("#owner-password-checkbox").prop("checked")
            if ((openPasswordField.length == 0) && openChecked) {
                $("#open-password-error").remove();
                $("#owner-perm-error").remove();
                $("#open-password-required").append("<p id='open-password-error' style='color:red;font-weight:bold;'>You have not entered a password.</p>");
            } else if ((ownPasswordField.length == 0) && ownerChecked) {
                $("#owner-perm-error").remove();
                $("#open-password-error").remove();
                $("#owner-password-required").append("<p id='owner-perm-error' style='color:red;font-weight:bold;'>You have not entered a password.</p>");
            } else if (ownerChecked && openChecked && (openPasswordField == ownPasswordField)) {
                $("#owner-perm-error").remove();
                $("#open-password-error").remove();
                $("#owner-password-required").append("<p id='owner-perm-error' style='color:red;font-weight:bold;'>The document open password can not be the same as the permissions password for this PDF.</p>");
            } else if (openChecked && (openPasswordField != $("#open-password-confirmation-input").val())) {
                $("#open-password-error").remove();
                $("#owner-perm-error").remove();
                $("#open-password-required").append("<p id='open-password-error' style='color:red;font-weight:bold;'>The passwords entered do not match.</p>");
            } else if (ownerChecked && (ownPasswordField != $("#owner-password-confirmation-input").val())) {
                $("#owner-perm-error").remove();
                $("#open-password-error").remove();
                $("#owner-password-required").append("<p id='owner-perm-error' style='color:red;font-weight:bold;'>The passwords entered do not match.</p>");
            } else {
                $("#open-password-error").remove();
                $("#owner-perm-error").remove();
                swal({
                    title: "Are you sure you want to save these password settings?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#4cae4c",
                    confirmButtonText: "OK",
                    cancelButtonText: "Cancel",
                    closeOnConfirm: true,
                    closeOnCancel: true
                },
                    function (isConfirm) {
                        if (isConfirm) {
                            var openChecked = $("#open-password-checkbox").prop("checked");
                            var ownChecked = $("#owner-password-checkbox").prop("checked");
                            protectSettings = { "open": openChecked, "permissions": ownChecked };
                            if (openChecked || ownChecked) {
                                protectSettings["isEncrypted"] = true;
                                if (openChecked) {
                                    protectSettings["password"] = openPasswordField;
                                }
                                if (ownChecked) {
                                    protectSettings["owner_password"] = ownPasswordField;
                                    protectSettings["print"] = $("#owner-printing").val();
                                    protectSettings["changes"] = $("#owner-changes").val();
                                    protectSettings["copy"] = $("#copying-checkbox").prop("checked");
                                    protectSettings["text_access"] = $("#text-access-checkbox").prop("checked");
                                }
                            } else {
                                protectSettings["isEncrypted"] = false;
                            }
                            $("#new-surface").activeEditor("mode", "TRANSFORM");
                        }
                    });
            }
        });

        $("#remove-security-btn").on("click", function () {
            swal({
                title: "Are you sure you want to remove all security settings?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#4cae4c",
                confirmButtonText: "OK",
                cancelButtonText: "Cancel",
                closeOnConfirm: true,
                closeOnCancel: true
            },
                function (isConfirm) {
                    if (isConfirm) {
                        protectSettings = { "open": false, "permissions": false, "isEncrypted": false };
                        $("#owner-perm-error").remove();
                        $("#owner-password-required").prop("disabled", true);
                        $("#owner-password-input").val("");
                        $("#owner-password-confirmation-input").val("");
                        $('#owner-password-checkbox').prop("checked", false);
                        $('#open-password-checkbox').prop("checked", false);
                        $("#open-password-error").remove();
                        $("#open-password-required").prop("disabled", true);
                        $("#document-open-alert").text("No password will be required to open this PDF.");
                        $("#open-password-input").val("");
                        $("#open-password-confirmation-input").val("");
                        $("#new-surface").activeEditor("mode", "TRANSFORM");
                    }
                });
        });

        $(function () {
            $("#slider").slider({
                min: 150,
                max: 550,
                range: "height",
                value: 200,
                step: 50,
                slide: function (event, ui) {
                    tbHeight = ui.value;
                    $(".reorder-item").each(function () {
                        var pageCanvas = $(this).find(".page-canvas");
                        var thisPageNumber = parseInt($(this).attr("data-original-page"));
                        var newDegrees = parseInt(pageCanvas.attr('data-rotation'));
                        pageCanvas.parent().css("height", tbHeight);
                        var layerElement = pageCanvas.parent().find(".active-editor");
                        if (tbSizes[thisPageNumber] == "h") {
                            pageCanvas.css("height", ui.value + "px");
                            if ((newDegrees == 90) || (newDegrees == 270)) {
                                pageCanvas.parent().css("width", pageCanvas.height());
                                layerElement.css("width", tbHeight);
                                // layerElement.css("width", "auto");
                                // layerElement.css("height", tbHeight);
                            } else {
                                pageCanvas.parent().css("width", pageCanvas.width());
                            }
                        } else {
                            pageCanvas.css("width", ui.value + "px");
                            if ((newDegrees == 90) || (newDegrees == 270)) {
                                pageCanvas.parent().css("width", pageCanvas.width());
                                layerElement.css("height", tbHeight);
                            } else {
                                pageCanvas.parent().css("width", pageCanvas.height());
                                layerElement.css("height", pageCanvas.height());
                            }
                        }
                        if (thisPageNumber in documentData["pages"]) {
                            $("#active-editor-" + thisPageNumber).tbDisplay("renderJSON", documentData.pages[thisPageNumber].elements, $(this).find(".active-layer"), thisPageNumber, true);
                        }
                    });
                }
            });
        });

        //  $(function () {
        //   $("body").tooltip({ selector: '[data-toggle=tooltip]' });
        // });
        $('body').on('hidden.bs.modal', '.delete-modal-content', function () {
            $(this).removeData('bs.modal');
            $(this).find(".modal-content").html("");
        });

        var pdfURL = "https://create-pdf.s3.eu-west-1.amazonaws.com/created/aewpulhhsku-f412dfe3/dummyform.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAJBG24RZNZSPKQRPA%2F20201001%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20201001T110447Z&X-Amz-Expires=900&X-Amz-SignedHeaders=host&X-Amz-Signature=7f64c35a27ba6b9f65946b7dfc11befe3e5e3d0886076f7b044b0b22e6e9926a";
        var isEncrypted = false;
        var permissions = {};
        $pdfCanvas = $('#pdf-canvas');

        password = '';
        var encryptVal = "";
        if (encryptVal.length > 0) {
            isEncrypted = JSON.parse(encryptVal);
        }
        var permVal = "";
        if (permVal.length > 0) {
            permissions = JSON.parse(_.unescape(permVal));
        }
        var defaultSignature = null;
        var defaultInitials = null;

        var documentData;
        var inputFiles = {};
        if ("{\&quot;0\&quot;:{\&quot;id\&quot;:\&quot;aewpulhhsku-f412dfe3\&quot;,\&quot;url\&quot;:\&quot;https://create-pdf.s3.eu-west-1.amazonaws.com/created/aewpulhhsku-f412dfe3/dummyform.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256\\u0026X-Amz-Credential=AKIAJBG24RZNZSPKQRPA%2F20201001%2Feu-west-1%2Fs3%2Faws4_request\\u0026X-Amz-Date=20201001T110447Z\\u0026X-Amz-Expires=900\\u0026X-Amz-SignedHeaders=host\\u0026X-Amz-Signature=7f64c35a27ba6b9f65946b7dfc11befe3e5e3d0886076f7b044b0b22e6e9926a\&quot;,\&quot;first\&quot;:1,\&quot;password\&quot;:null}}") {
            try {
                inputFiles = JSON.parse(_.unescape("{\&quot;0\&quot;:{\&quot;id\&quot;:\&quot;aewpulhhsku-f412dfe3\&quot;,\&quot;url\&quot;:\&quot;https://create-pdf.s3.eu-west-1.amazonaws.com/created/aewpulhhsku-f412dfe3/dummyform.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256\\u0026X-Amz-Credential=AKIAJBG24RZNZSPKQRPA%2F20201001%2Feu-west-1%2Fs3%2Faws4_request\\u0026X-Amz-Date=20201001T110447Z\\u0026X-Amz-Expires=900\\u0026X-Amz-SignedHeaders=host\\u0026X-Amz-Signature=7f64c35a27ba6b9f65946b7dfc11befe3e5e3d0886076f7b044b0b22e6e9926a\&quot;,\&quot;first\&quot;:1,\&quot;password\&quot;:null}}"));
            } catch (err) {
                inputFiles = {};
            }
        }
    </script>

    <script src="/assets/make-cd94b090b216552e5f6058212b4a24164d7bbce2bf438a7275c685b9de68baa5.js"></script>

    <script type="text/javascript">

  function checkPermissions(changes, open, print, copy, textAccess, owner) {
    if ((changes.length > 0) && (["none", "insertDeleteRotate", "fillForms", "comment"].includes(changes)) && (!owner || owner.length == 0)) {
      $("#progress-block").hide();
      if (changes == "none") {
        $("#password-error-msg-content").text("This PDF is protected from editing. Please enter a permissions password below.");
      } else if (changes == "insertDeleteRotate") {
        // notice: only allow insert, delete, rotate
        // allow owner pword input
        $("#password-error-msg-content").html("This PDF is protected from editing except organising the pages.<br>Please enter a permissions password below to edit the file.<br>Alternatively, you can use our merge, rotate, reorder and delete pages features on this file.");
      } else {
        // notice: only allow fill & sign
        // allow owner pword input
        // notice: only allow comment, fill & sign
        // allow owner pword input
        $("#password-error-msg-content").text("This PDF is protected from editing except form filling. Please enter a permissions password below or go to our form filler page.");
        $("#fill-form-page-section").show();
      }
      $("#password-type").html('<input type="hidden" name="password_type" id="password_type" value="Owner">');
      $("#password-input").html('<input id="pro_file_pdf_password" type="password" name="pro_file[owner_pwd]">');
      $("#password-error-message").show();
      return false;
    } else {
      if ((changes.length > 0) && (changes != "all") && !owner) {
        $("#change-protect-settings").hide();
        $("#view-protect-form").show();
      } else {
        $("#view-protect-form").hide();
        $("#change-protect-settings").show();
        if ((open.length > 0) && (open == "deny")) {
          $("#open-password-checkbox").click();
          $("#document-open-alert").text("This password will be required to open this PDF.");
        } else {
          $("#document-open-alert").text("No password will be required to open this PDF.");
        }
        if (((changes.length > 0) && (changes != "all")) || ((print.length > 0) && (print != "highRes")) ) {
          $("#owner-password-checkbox").click();
          $("#owner-printing").val(print);
          $("#owner-changes").val(changes);
          if (copy == "all"){ $("#copying-checkbox").click(); }
          if (textAccess == "all"){ $("#text-access-checkbox").click(); }
        }
      }
      return true;
    }
  }

  function loadPDFViewer() {
    lastSavedJson = JSON.stringify(documentData);
    if (firstLoad) {
      if(password.length > 0) {
        $pdfCanvas.PDFViewer({pdf_url: pdfURL, password: password});
      } else {
        $pdfCanvas.PDFViewer({pdf_url: pdfURL});
      }
    } else {
      try {
        $pdfCanvas.PDFViewer("loadFiles", pdfURL, password);
      } catch(err) {
        if(password.length > 0) {
          $pdfCanvas.PDFViewer({pdf_url: pdfURL, password: password});
        } else {
          $pdfCanvas.PDFViewer({pdf_url: pdfURL});
        }
      }
    }
  }

  try {
    if ($("#document_data").val() != '') {
      if (isEncrypted && ("changes" in permissions) && (!checkPermissions(permissions["changes"], permissions["open"], permissions["print"], permissions["copy"], permissions["text_access"], permissions["owner"]))) {
      } else {
        documentData = JSON.parse($("#document_data").val());
        if (documentData.rotated_pages) {
          rotatedPages = documentData.rotated_pages;
        }
        if (documentData.changed_order) {
          changedOrder = documentData.changed_order;
        }
        if (documentData.deleted_annots) {
          deletedAnnots = documentData.deleted_annots;
        }
        if (documentData.deleted_fields) {
          deletedFields = documentData.deleted_fields;
        }
        if (documentData.last_form_handles) {
          lastFormHandles = documentData.last_form_handles;
        }
        if (documentData.last_page_no) {
          lastPageNumber = parseInt(documentData.last_page_no);
        }
        if (documentData.last_merge_no) {
          lastMergeNumber = parseInt(documentData.last_merge_no);
        }
        loadPDFViewer();
      }
    } else {
        queryFileData("aewpulhhsku-f412dfe3");
    }
  }
  catch(err) {
    if (isEncrypted && ("changes" in permissions) && (!checkPermissions(permissions["changes"], permissions["open"], permissions["print"], permissions["copy"], permissions["text_access"], permissions["owner"]))) {
    } else {
      documentData = {"pages":{},"page_order":[],"deleted_annots":{},"last_form_handles":{},"rotated_pages":{},"last_page_no":null,"last_merge_no":null};
      loadPDFViewer();
    }
  }

  var documentImages = {};
  var documentSignatures = {};
  var documentInitials = {};
  var mergeIds = [];

  $('.document-button').on('click',function(e) {
    if ($(this).hasClass('disabled')) {
      e.stopImmediatePropagation();
      return false;
    }
  });

  function updateOnePageThumbnails() {
    var newPageNumbers = $pdfCanvas.PDFViewer("pageNumbers");
    $("#thumb_pane").empty();
    for (i=0; i < newPageNumbers.length; i++) {
      var rotation = 0;
      if (rotatedPages[newPageNumbers[i]]) {
        rotation = rotatedPages[newPageNumbers[i]];
      }
      $("#thumb_pane").append(
        "<div id='thumb_" + newPageNumbers[i] + "' class='thumb_element thumb_preview' data-page-shown='" + (i+1) + "' data-page-idx='" + newPageNumbers[i] + "'><div style='position: relative;'><canvas id='thumb_canvas_" + newPageNumbers[i] + "' class='deg-" + rotation + " lozad thumb-canvas' data-rotation='" + rotation + "' width='100px' height='141px'></canvas><div id='active-thumb-" + newPageNumbers[i] + "' class='active-editor' style='height: 100%;position: absolute;top: 0px;width: 100%;'><div class='active-layer'></div></div></div><div><small class='thumb-number'>Page "+ (i+1) +"</small></div></div>"
      );
      $("#active-thumb-" + newPageNumbers[i]).tbDisplay();
      // $pdfCanvas.PDFViewer("renderThumbnail", "thumb_canvas_", newPageNumbers[i], true);
      $("#thumb_" + newPageNumbers[i]).on('click', function() {
        goToPage(parseInt($(this).data("pageIdx")), $pdfCanvas.PDFViewer("pageNumber"), "TRANSFORM", false);
      });
      // var thisPageNumber = parseInt(newPageNumbers[i]);
      // $("#active-thumb-" + thisPageNumber).tbDisplay();
      // if (thisPageNumber in documentData["pages"]) {
      //   $("#active-thumb-" + thisPageNumber).tbDisplay("renderJSON", documentData.pages[thisPageNumber].elements, $("#active-thumb-" + thisPageNumber).find(".active-layer"), thisPageNumber, false);
      // }
    }
    lozadOb.observe();
  }

  function goToOnePageView(forms) {
    var currentPageNumber;
    if(thumbnailsView) {
      if ($('#thumb_pane').length) {updateOnePageThumbnails();};
      currentPageNumber = $pdfCanvas.PDFViewer("pageNumber");
      if($pdfCanvas.PDFViewer("pageNumbers").includes(currentPageNumber)) {
        goToPage(currentPageNumber, null, "TRANSFORM", forms);
      } else {
        goToPage($pdfCanvas.PDFViewer("pageNumbers")[0], null, "TRANSFORM", forms);
      }
      thumbnailsView = false;
    } else {
      if (forms) {
        formsEnabled = true;
      }
      $("#new-surface").activeEditor("mode", "TRANSFORM");
    }
    $("#one-page-view").show();
    $("#thumbnails-view").hide();
    $('.file-tab-btn').hide();
    $('.tools-edit-tab-btn').show();
    $('#file-tab-container').removeClass('active-tab');
  }

  // $('#tools-tab-container').on('click', function(e) {
  //   goToOnePageView();
  //   if (formsEnabled) {
  //     $('#new-surface').activeEditor('disableFormEditing');
  //     $('#new-surface').activeEditor('mode','TRANSFORM');
  //     formsEnabled = false;
  //   }
  //   $('.edit-tab-btn').hide();
  //   $('.forms-tab-btn').hide();
  //   $('#file-tab').addClass('border-tab');
  //   $('#forms-tab').removeClass('border-tab');
  //   $('#edit-tab-container').removeClass('active-tab');
  //   $('#forms-tab-container').removeClass('active-tab');
  //   $('#tools-tab-container').addClass('active-tab');
  //   $('.tools-tab-btn').show();
  // });

  // $('#edit-tab-container').mouseenter(function(){
  //   if($('#edit-tab-container').hasClass('active-tab')){
  //   } else {
  //     $('#forms-tab').removeClass('border-tab');
  //     $('#file-tab').removeClass('border-tab');
  //   }
  // });

  // $('#edit-tab-container').mouseleave(function(){
  //   if($('#edit-tab-container').hasClass('active-tab')){
  //   } else {
  //     $('#forms-tab').addClass('border-tab');
  //     $('#file-tab').addClass('border-tab');
  //   }
  // });

  $('#forms-tab-container').mouseenter(function(){
    if($('#forms-tab-container').hasClass('active-tab')){
    } else {
      $('#file-tab').removeClass('border-tab');
      $('#edit-tab').removeClass('border-tab');
    }
  });

  $('#forms-tab-container').mouseleave(function(){
    if($('#forms-tab-container').hasClass('active-tab')){
    } else {
      $('#file-tab').addClass('border-tab');
      $('#edit-tab').addClass('border-tab');
    }
  });

  // $('#tools-tab-container').mouseenter(function(){
  //   if($('#tools-tab-container').hasClass('active-tab')){
  //   } else {
  //     $('#edit-tab').removeClass('border-tab');
  //     $('#forms-tab').removeClass('border-tab');
  //   }
  // });

  // $('#tools-tab-container').mouseleave(function(){
  //   if($('#tools-tab-container').hasClass('active-tab')){
  //   } else {
  //     $('#edit-tab').addClass('border-tab');
  //     if($('#forms-tab-container').hasClass('active-tab')){
  //     } else {
  //       $('#forms-tab').addClass('border-tab');
  //     }
  //   }
  // });

  $('#edit-tab-container').on('click', function(e) {
    goToOnePageView(false);
    if (formsEnabled) {
      $('#new-surface').activeEditor('disableFormEditing');
      formsEnabled = false;
    }
    $('.forms-tab-btn').hide();
    // $('.tools-tab-btn').hide();
    // $('#tools-tab-container').removeClass('active-tab');
    $('#forms-tab-container').removeClass('active-tab');
    // $('#tools-tab').removeClass('border-tab');
    $('#file-tab').addClass('border-tab');
    $('#shapes-popover').popover('hide');
    $('#symbols-popover').popover('hide');
    $('#edit-tab-container').addClass('active-tab');
    $('.edit-tab-btn').show();
  });

  $('#forms-tab-container').on('click', function(e) {
    goToOnePageView(true);
    $('#new-surface').activeEditor('enableFormEditing');
    $('.edit-tab-btn').hide();
    // $('.tools-tab-btn').hide();
    // $('#tools-tab-container').removeClass('active-tab');
    $('#edit-tab-container').removeClass('active-tab');
    // $('#tools-tab').addClass('border-tab');
    $('#edit-tab').removeClass('border-tab');
    $('#file-tab').removeClass('border-tab');
    $('#shapes-popover').popover('hide');
    $('#symbols-popover').popover('hide');
    $('#forms-tab-container').addClass('active-tab');
    $('.forms-tab-btn').show();
  });

  function renderJSON() {
    $("#sortable li").each(function() {
      var thisPageNumber = parseInt($(this).attr("data-original-page"));
      if (thisPageNumber in documentData["pages"]) {
        $("#active-editor-" + thisPageNumber).tbDisplay("renderJSON", documentData.pages[thisPageNumber].elements, $(this).find(".active-layer"), thisPageNumber, true);
      } else {
        $("#active-editor-" + thisPageNumber).tbDisplay("clear");
      }
    });
  }

  $('#file-tab-container').on('click', function(e) {
    if (formsEnabled) {
      $('#new-surface').activeEditor('disableFormEditing');
      formsEnabled = false;
    }
    writeJSON();
    thumbnailsView = true;
    if ($.isEmptyObject(deletedAnnots)) {
      renderJSON();
    } else {
      reorderedThumbnails();
    }
    if(redoArray[0] && redoArray[0].length) {
      $("#redo-btn").addClass("active-undoredo");
    } else {
      $("#redo-btn").removeClass("active-undoredo");
    }
    if(undoArray[0] && undoArray[0].length) {
      $("#undo-btn").addClass("active-undoredo");
    } else {
      $("#undo-btn").removeClass("active-undoredo");
    }
    $("#one-page-view").hide();
    $("#thumbnails-view").show();
    $("#new-surface").activeEditor("mode", "TRANSFORM");
    // showToolbar("none");
    $('.tools-edit-tab-btn').hide();
    // $('.tools-tab-btn').hide();
    // $('#tools-tab-container').removeClass('active-tab');
    // $('#tools-tab').addClass('border-tab');
    $('.edit-tab-btn').hide();
    $('#edit-tab-container').removeClass('active-tab');
    $('.forms-tab-btn').hide();
    $('#forms-tab-container').removeClass('active-tab');
    $('#edit-tab').addClass('border-tab');
    $('#file-tab').removeClass('border-tab');
    $('#shapes-popover').popover('hide');
    $('#symbols-popover').popover('hide');
    $('#file-tab-container').addClass('active-tab');
    $('.file-tab-btn').show();
  });

  $("#th-btn").on('click', function() {
    $("#left-side-panel").toggle();
    $("#th-btn").toggleClass("active");
    setHeightsAndWidths(currentPageWidth, currentPageHeight);
  });

  $('.drop-box').on(
    'dragover',
    function(e) {
      e.preventDefault();
      e.stopPropagation();
    }
  );
  $('.drop-box').on(
    'dragenter',
    function(e) {
      e.preventDefault();
      e.stopPropagation();
    }
  );

  $( function() {
    $( "#sortable" ).sortable({
      scroll: true,
      start: function(event, ui) {
        var start_pos = ui.item.index();
        ui.item.data('start_pos', start_pos);
      },
      update: function(event, ui) {
        var start_pos = ui.item.data('start_pos');
        var end_pos = ui.item.index();
        addToUndoArray("reorder", ui.item.data("originalPage"), [start_pos, end_pos])
        var newPageNumbers = [];
        $("#sortable li").each(function(i){
          newPageNumbers.push($(this).data("originalPage"));
          $(this).data("orderedPage", (i+1));
        });
        $pdfCanvas.PDFViewer("setPageNumbers", newPageNumbers);
        correctSortablePageNumbers();
      }
    });

    $( "#field-sortable" ).sortable({
      scroll: true,
      start: function(event, ui) {
        var start_pos = ui.item.index();
        ui.item.data('start_pos', start_pos);
      },
      update: function(event, ui) {
        var start_pos = ui.item.data('start_pos');
        var end_pos = ui.item.index();
        if (start_pos != end_pos) {
          var this_id = ui.item.data('id');
          $("#new-surface").activeEditor("updateOrder", this_id, start_pos, end_pos);
        }
      }
    });
  });

  $(window).on('resize', function(){
    setHeightsAndWidths(currentPageWidth, currentPageHeight);
  });

  function setHeightsAndWidths(pageWidth, pageHeight) {
    var widthMargin, isCentered, leftOffset;
    if ($("#th-btn").hasClass("active")) {
      widthMargin = Math.max(20.0, (window.innerWidth - 420) - pageWidth);
      $("#centre-pdf").css("margin", ('10px ' + widthMargin / 2 + 'px'));
      // isCentered = pageWidth <= (window.innerWidth - 400);
      // leftOffset = (Math.max(0.0, (window.innerWidth - 410) - pageWidth) - widthMargin) / 2;
    } else if ($("#right-side-panel").hasClass("active")) {
      widthMargin = Math.max(20.0, (window.innerWidth - 220) - pageWidth);
      if (widthMargin > 200) {
        $("#centre-pdf").css("margin", ('10px ' + ((widthMargin - 200)/2) + 'px 10px ' + ((widthMargin + 200)/2) + "px"));
      } else {
        $("#centre-pdf").css("margin", ('10px ' + widthMargin / 2 + 'px'));
      }
      // isCentered = pageWidth <= (window.innerWidth - 220);
      // leftOffset = (Math.max(0.0, (window.innerWidth - 220) - pageWidth) - widthMargin) / 2;
    } else {
      widthMargin = Math.max(20.0, (window.innerWidth - 20) - pageWidth);
      // isCentered = pageWidth <= window.innerWidth;
      // leftOffset = (Math.max(0.0, window.innerWidth - pageWidth) - widthMargin) / 2;
      $("#centre-pdf").css("margin", ('10px ' + widthMargin / 2 + 'px'));
    }
    var w = Math.round(pageWidth + widthMargin) + "px";
    // if(!isCentered) {
    //   $("#page-size-coord").css({"margin": "0 10px"});
    // } else {
    //   $("#page-size-coord").css({"margin": "0px"});
    // }
    $("#page-size-coord").css({"min-width": w, "width": w, "max-width": w, "min-height": (pageHeight + 40) + "px" });
    // $("#page-size-coord").css({"min-width": w, "width": w, "max-width": w, "left": leftOffset + "px", "min-height": (pageHeight + 40) + "px" });
    if (window.innerWidth < 1150) {
      $("#file-section").css("height", window.innerHeight - 164 + "px");
    } else {
      $("#file-section").css("height", window.innerHeight - 152 + "px");
    }
  }

  $("#zi-btn").on('click', function() {
    var newPageScale = nextZoomInValue(currentPageScale);
    // if(newPageScale != pageScale) {
      disablePageNav();
      writeJSON();
      position = setZoomAndKeepPosition(newPageScale);
      // currentPageScale = newPageScale;
      // $("#new-surface").activeEditor("clear");
      var related = $("#new-surface").activeEditor("mode");
      if (_.contains(["IMAGE", "SIGNATURE"], related)) {
        $("#new-surface").activeEditor("mode", "TRANSFORM");
      }
      $pdfCanvas.PDFViewer("renderPage", $pdfCanvas.PDFViewer("pageNumber"), newPageScale, false, position, "TRANSFORM");
      // queueRenderPage(pageNum);
    // }
  });

  $("#zo-btn").on('click', function() {
    var newPageScale = nextZoomOutValue(currentPageScale);
    // if(newPageScale != pageScale) {
      disablePageNav();
      writeJSON();
      position = setZoomAndKeepPosition(newPageScale);
      // currentPageScale = newPageScale;
    // $("#new-surface").activeEditor("clear");
      var related = $("#new-surface").activeEditor("mode");
      if (_.contains(["IMAGE", "SIGNATURE"], related)) {
        $("#new-surface").activeEditor("mode", "TRANSFORM");
      }
      $pdfCanvas.PDFViewer("renderPage", $pdfCanvas.PDFViewer("pageNumber"), newPageScale, false, position, "TRANSFORM");
      // queueRenderPage(pageNum);
    // }
  });

  function nextZoomInValue(currentVal) {
    $("#zo-btn").removeAttr("disabled");
    var i, len, ref, x;
    ref = [0.1, 0.25, 0.5, 1, 1.5, 2, 3, 4, 6, 10];
    for (i = 0, len = ref.length; i < len; i++) {
      x = ref[i];
      if (x > currentVal) {
        return x;
      }
    }
    $("#zi-btn").attr("disabled", "disabled");
    return 10;
  }
  function nextZoomOutValue(currentVal) {
    $("#zi-btn").removeAttr("disabled");
    var i, len, ref, x;
    ref = [10, 6, 4, 3, 2, 1.5, 1, 0.5, 0.25, 0.1];
    for (i = 0, len = ref.length; i < len; i++) {
      x = ref[i];
      if (x < currentVal) {
        return x;
      }
    }
    $("#zo-btn").attr("disabled", "disabled");
    return 0.1;
  }
  function setZoomAndKeepPosition(ps) {
    var $vp, sf, startZf, vpOffset, x, y;
    sf = ps / currentPageScale;
    currentPageScale = ps;
    $vp = $('#pdf-viewport');
    vpOffset = $vp.offset() || {
        top: 0,
        left: 0
    };
    y = $vp.scrollTop() * sf + ($vp.height() / 2 - vpOffset.top) * (sf - 1);
    x = $vp.scrollLeft() * sf + ($vp.width() / 2 - vpOffset.left) * (sf - 1);
    if (sf === 3) {
        x -= 60 * 3;
        y -= 20 * 3;
    }
    // this.set('zoomFactor', zf);
    // return Em.run.scheduleOnce('afterRender', this, function() {
    //     $vp.scrollTop(y);
    //     return $vp.scrollLeft(x);
    // });
    // $pdfCanvas.PDFViewer("renderPage", parseInt($pdfCanvas.PDFViewer("pageNumber")), false, false, {x: x, y: y});
    return {x: x, y: y};
  }

  function saveDocument(userPopup) {
    setTimeout(saveDocument, 20000);

    if (saving || renderingPage) {}
    else if ((userPopup != "showPopup") && (($("#text-transformer").css('display') != 'none') || ($("#text-field-transformer").css('display') != 'none') || ($("#date-field-transformer").css('display') != 'none') || ($("#check-field-transformer").css('display') != 'none') || ($("#combo-field-transformer").css('display') != 'none') || ($("#sig-field-transformer").css('display') != 'none') || ($("#transformer").css('display') != 'none') || ($("#hori-transformer").css('display') != 'none') || ($("#vert-transformer").css('display') != 'none') || ($("#annot-transformer").css('display') != 'none') || ((($("#creation-layer").children().length > 0) && ($('#creation-layer').find('div.symbol-element').length == 0)) || drawing || $('#linkForm').is(':visible') || $('#signature-modal').hasClass('in') || $('#image-modal').hasClass('in')  || $('#initials-modal').hasClass('in')) || $("#editor-radiofield-btn").hasClass("active") || $("#transform-layer").find(".drag-box"))){
      // if ($("#creation-layer").children().length > 0) { console.log("creating shapes")};
      // if($("#text-transformer").css('display') != 'none') { console.log("creating text")};
      // if($("#transformer").css('display') != 'none') { console.log("moving elements")};
      // if(drawing) {console.log("drawing")};
      // if($('#signature-modal').hasClass('in') || $('#image-modal').hasClass('in')){console.log("modal open")};
    } else {
      saving = true;
      if(savingTimeout){
        clearTimeout(savingTimeout);
        savingTimeout = null;
      }
      // console.log("saving");
      result = {};
      $documentForm = $("form#document-form");
      writeJSON();
      /** @@type {string} */
      var udataCur = JSON.stringify(documentData);
      // console.log("udataCur: " + udataCur);
      if ((userPopup != "showPopup") && (udataCur == '{"pages":{}}') && firstSaved) {
        // console.log("no content");
        saving = false;
        // if(userPopup == "showPopup") {
        //  swal({title: "Please edit your file before saving.", type: "error", confirmButtonColor: "#4cae4c"});
        // }
      } else if ((userPopup != "showPopup") && (lastSavedJson == udataCur)) {
      // } else if ((userPopup != "showPopup") && ($documentForm.find('input[name="pro_file[content]"]').val() == udataCur)) {
        // console.log("hasnt changed content");
        saving = false;
        // if(userPopup == "showPopup") {
        //  swal({title: "Please edit your file before saving.", type: "error", confirmButtonColor: "#4cae4c"});
        // }
      } else {
        var newFilename = $("input#document-name-input").val() + ".pdf";
        if (newFilename == ".pdf") {
          saving = false;
          if(userPopup == "showPopup") {
            swal({title: "Please enter a filename.", type: "error", confirmButtonColor: "#4cae4c"});
          }
        } else {
          try {
            firstSaved = false;
            // console.log($documentForm.find('input[name="pro_file[content]"]').val())
            // console.log("submitForm");
            $documentForm.find('input[name="pro_file[content]"]').val(udataCur);
            $documentForm.find('input[name="pro_file[filename]"]').val(newFilename);
            $documentForm.find('input[name="merge_files"]').val(JSON.stringify(mergeIds));
            $documentForm.find('#document_images').val(Object.keys($("#new-surface").activeEditor("images")));
            $documentForm.find('#document_signatures').val(Object.keys($("#new-surface").activeEditor("signatures")));
            $documentForm.find('#document_initials').val(Object.keys($("#new-surface").activeEditor("initials")));
            $documentForm.find('#document_protect_settings').val(JSON.stringify(protectSettings));
            $(".document-button").addClass("disabled");
            $("#save-btn").text("Saving...");
            savingError();
            sendForm();
            // $documentForm.submit();
          }
          catch(err) {
            console.log(err);
            // if(typeof Rollbar != "undefined") {
            //   Rollbar.error("Form submit error", err.message);
            // }
            $("#save-btn").text("Save");
            if(userPopup == "showPopup") {
              swal({title: "There was an error saving your file", type: "error", confirmButtonColor: "#4cae4c"});
            }
            if(savingTimeout){
              clearTimeout(savingTimeout);
              savingTimeout = null;
            }
            saving = false;
            if (!renderingPage) {$('.document-button').removeClass('disabled');};
          }
        }
      }
    }
  }

  savingError = function() {
    savingTimeout = setTimeout(function(){
      $.ajax({
        url: "/failed_uploads",
        type: "POST",
        data: { failed_upload: {name: "Save fail", error: $("form#document-form").serialize()}},
        dataType: "json"
      });
      // if(typeof Rollbar != "undefined") {
      //   Rollbar.error("Editor save error", "Editor save error");
      // }
      $("#save-btn").text("Save");
      $('.document-button').removeClass('disabled');
      $("#save-export-display").hide();
      $("#export-display").hide();
      $("#save-failed-display").show();
      if(savingTimeout){
        clearTimeout(savingTimeout);
        savingTimeout = null;
      }
      saving = false;
      swal({title: "Your file could not be saved, please try again.", type: "error", confirmButtonColor: "#4cae4c"});
    }, 300000);
  // }, 40);
  }

  function queryFileData(fileId) {
    $.ajax({
      url: "/files/" + fileId + "/file_data",
      type: "GET",
      dataType: "json"
    }).success(function(data) {
      if (data['content'].length > 0) {
        if (!data['is_encrypted'] || checkPermissions(data['changes'], data['open'], data["print"], data["copy"], data["text_access"], data['owner'])) {
          Offline.off("confirmed-down", function(){});
          documentData = JSON.parse(data['content']);
          if (documentData.rotated_pages) {
            rotatedPages = documentData.rotated_pages;
          }
          if (documentData.changed_order) {
            changedOrder = documentData.changed_order;
          }
          if (documentData.deleted_annots) {
            deletedAnnots = documentData.deleted_annots;
          }
          if (documentData.deleted_fields) {
            deletedFields = documentData.deleted_fields;
          }
          if (documentData.last_form_handles) {
            lastFormHandles = documentData.last_form_handles;
          }
          if (documentData.last_page_no) {
            lastPageNumber = parseInt(documentData.last_page_no);
          }
          if (documentData.last_merge_no) {
            lastMergeNumber = parseInt(documentData.last_merge_no);
          }
          loadPDFViewer();
        }
      } else {
        setTimeout(queryFileData, 2000, fileId);
      }
    }).error(function(data) {
      Offline.off("confirmed-down", function(){});
      if (!data['is_encrypted'] || checkPermissions(data['changes'], data['open'], data["print"], data["copy"], data["text_access"], data['owner'])) {
        documentData = {"pages":{},"page_order":[],"deleted_annots":{},"last_form_handles":{},"rotated_pages":{},"last_page_no":null,"last_merge_no":null};
        loadPDFViewer();
      }
    }).fail(function(data) {
      Offline.off("confirmed-down", function(){});
      if (!data['is_encrypted'] || checkPermissions(data['changes'], data['open'], data["print"], data["copy"], data["text_access"], data['owner'])) {
        documentData = {"pages":{},"page_order":[],"deleted_annots":{},"rotated_pages":{},"last_page_no":null,"last_merge_no":null};
        loadPDFViewer();
      }
    });
  }

  function queryOwner(fileId) {
    $.ajax({
      url: "/files/" + fileId + "/owner",
      type: "GET",
      dataType: "json"
    }).success(function(data) {
      if (data['owner'].length == 0) {
        setTimeout(queryOwner, 2000, fileId);
      } else if (data['owner']) {
        $("#owner-loading").hide();
        if ((data['open'].length > 0) && (data['open'] == "deny")) {
          $("#open-password-checkbox").click();
          $("#document-open-alert").text("This password will be required to open this PDF.");
        } else {
          $("#document-open-alert").text("No password will be required to open this PDF.");
        }
        if (((data['changes'].length > 0) && (data['changes'] != "all")) || ((data['print'].length > 0) && (data['print'] != "highRes")) ) {
          $("#owner-password-checkbox").click();
          $("#owner-printing").val(data['print']);
          $("#owner-changes").val(data['changes']);
          if (data['copy'] == "all"){ $("#copying-checkbox").click(); }
          if (data['text_access'] == "all"){ $("#text-access-checkbox").click(); }
        }
        $("#change-protect-settings").show();
      } else {
        $("#owner-loading").hide();
        $("#owner-password-field-group").append("<p id='owner-password-error' style='color:red;font-weight:bold;'>The password is incorrect. Please make sure that Caps Lock is not on by mistake, and try again.</p>");
        $("#view-protect-form").show();
      }
    }).error(function(data) {
      $("#owner-loading").hide();
      $("#owner-password-field-group").append("<p id='owner-password-error' style='color:red;font-weight:bold;'>The password is incorrect. Please make sure that Caps Lock is not on by mistake, and try again.</p>");
      $("#view-protect-form").show();
    }).fail(function(data) {
      $("#owner-loading").hide();
      $("#owner-password-field-group").append("<p id='owner-password-error' style='color:red;font-weight:bold;'>The password is incorrect. Please make sure that Caps Lock is not on by mistake, and try again.</p>");
      $("#view-protect-form").show();
    });
  }

  queryForUpdatePercentage = function(jobId) {
    Offline.on("confirmed-down", function() {
      if (saving) {
        $("#save-btn").text("Save");
        $("#save-export-display").hide();
        $("#export-display").hide();
        $("#save-failed-display").show();
        if(savingTimeout){
          clearTimeout(savingTimeout);
          savingTimeout = null;
        }
        saving = false;
        if (!renderingPage) {$('.document-button').removeClass('disabled');};
        swal({title: "Your file could not be saved, please check your internet connection and try again.", type: "error", confirmButtonColor: "#4cae4c"});
      }
    });
    $.ajax({
      url: "/files/" + jobId + "/percentage_done",
      type: "GET",
      dataType: "json"
    }).success(function(data) {
      if (data['percentage_done'] == 100) {
        Offline.off("confirmed-down", function(){});
        $("#save-btn").text("Save");
        $("#export-display").show();
        $("#save-export-display").hide();
        lastSavedJson = _.unescape(data['content']);
        if(savingTimeout){
          clearTimeout(savingTimeout);
          savingTimeout = null;
        }
        saving = false;
        if (!renderingPage) {$('.document-button').removeClass('disabled');};
      } else if (data['percentage_done'] == 0) {
        Offline.off("confirmed-down", function(){});
        $("#save-btn").text("Save");
        $("#save-export-display").hide();
        $("#export-display").hide();
        $("#save-failed-display").show();
        if(savingTimeout){
          clearTimeout(savingTimeout);
          savingTimeout = null;
        }
        saving = false;
        if (!renderingPage) {$('.document-button').removeClass('disabled');};
        swal({title: "Your file could not be saved, please try again.", type: "error", confirmButtonColor: "#4cae4c"});
      } else {
        setTimeout(queryForUpdatePercentage, 1000, jobId);
      }
    }).error(function(data) {
      Offline.off("confirmed-down", function(){});
      $("#save-btn").text("Save");
      $("#save-export-display").hide();
      $("#export-display").hide();
      $("#save-failed-display").show();
      if(savingTimeout){
        clearTimeout(savingTimeout);
        savingTimeout = null;
      }
      saving = false;
      if (!renderingPage) {$('.document-button').removeClass('disabled');};
      swal({title: "Your file could not be saved, please check your internet connection and try again.", type: "error", confirmButtonColor: "#4cae4c"});
    });
  }

  function onLoadPDF(data) {
    var pageCount = data.pageCount;

    $newFields = $('form#document-form').find('.new-fields');
    if ($newFields.exists()){
      $newFields.find('input[name="document[page_count]"]').val(pageCount);
    }

    $('.page-count').html(pageCount);

    $('select.page-number').empty();
    for (i=0;i<pageCount;i++){
      $('select.page-number').append($("<option></option>")
               .attr("value",i+1)
               .text(i+1));
    }
    if(pageCount > 1) {
      $("#page_num").show();
      $("#nav-btns").show();
    } else {
      $("#one_page").show();
    }
  }


  function onLoadError(data) {
    $("#progress-block").hide();
    if (data.error.indexOf('Password') !== -1) {
      $("#password-error-message").show();
    } else {
      $("#error-message").show();
      //   if(typeof Rollbar != "undefined") {
      //   Rollbar.error("PDF Load error", data.error);
      // }
    }
  }

  function writeJSON() {
    if(!thumbnailsView) {
      var i = parseInt($pdfCanvas.PDFViewer("pageNumber"));
      var attrs = $("#new-surface").activeEditor("writeJSON", i);
      if (0 == _.isEmpty(attrs)) {
        if (documentData.pages[i]) {
          if (documentData.pages[i].scale) {
            documentData.pages[i].elements = attrs;
          } else {
            documentData.pages[i] = {
              elements : attrs,
              width : currentPageWidth,
              height : currentPageHeight
              // scale : currentPageScale
            }
          };
        } else {
          documentData.pages[i] = {
            elements : attrs,
            width : currentPageWidth,
            height : currentPageHeight
            // scale : currentPageScale
          };
        }
      } else {
        delete documentData.pages[i];
      }
    }
    documentData.page_order = $pdfCanvas.PDFViewer("pageNumbers");
    documentData.rotated_pages = rotatedPages;
    documentData.deleted_annots = deletedAnnots;
    documentData.deleted_fields = deletedFields;
    documentData.last_form_handles = lastFormHandles;
    documentData.last_page_no = lastPageNumber;
    documentData.last_merge_no = lastMergeNumber;
    documentData.changed_order = changedOrder;
  }

  function addToUndoArray(type, pageNumber, info) {
    undoArray[0].push({type: type, page: pageNumber, data: info});
    redoArray[0] = [];
    $("#redo-btn").removeClass("active-undoredo");
    $("#undo-btn").addClass("active-undoredo");
  }

  function reorderedThumbnails() {
    var newPageNumbers = $pdfCanvas.PDFViewer("pageNumbers");
    $( "#sortable").empty();
    for (i=0; i < newPageNumbers.length; i++) {
      var rotation = 0;
      if (rotatedPages[newPageNumbers[i]]) {
        rotation = rotatedPages[newPageNumbers[i]];
      }
      $( "#sortable" ).append("<li class='ui-state-default grabbable reorder-item ui-sortable-handle' id='original_index_" + newPageNumbers[i] + "' data-ordered-page=" + (i+1) + "' data-original-page='" + newPageNumbers[i] + "'><div class='page-delete' id='delete_" + newPageNumbers[i] + "'><span class='fas fa-times close' style='top:0px;font-size:16px;opacity:0.5px'></span></div><div id='sortable_" + newPageNumbers[i] + "' class='thumb_element' data-page-idx='" + newPageNumbers[i] + "' style='padding: 5px 18px;display: table-cell;vertical-align: middle;'><div style='display: table-cell;vertical-align: middle;position: relative;height:" + tbHeight +"px;'><canvas id='sortable_canvas_" + newPageNumbers[i] + "' style='box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);border: 1px solid #e1e1e;'" + tbHeight +"px;' class='lozad page-canvas deg-" + rotation + "' data-rotation='" + rotation + "' width='100px' height='141px'></canvas><div id='active-editor-" + newPageNumbers[i] + "' class='active-editor' style='height: 200px;position: absolute;top: 0px;width: 100%;'><div class='active-layer'></div></div></div><div class='btn-group' role='group' aria-label='rotate' style='margin: 0 auto;display: table;'><button type='button' class='btn'style='border: 1px solid #ccc;' data-degrees='-90'><i class='fas fa-undo'></i></button><button type='button' class='btn' style='border: 1px solid #ccc;' data-degrees='90'><i class='fas fa-redo'></i></button></div><div class='reorder-number' style='float:left;width:100%;font-size:14px;font-weight:bold;padding-top:5px;'>Page " + (i+1) + "</div></div><input type='hidden' value='" + (i+1) + "' class='reorder-index'></li>");
      // $pdfCanvas.PDFViewer("renderThumbnail", "sortable_canvas_", newPageNumbers[i], false);
      $("#active-editor-" + newPageNumbers[i]).tbDisplay();
      var thisCanvas = $("#sortable_canvas_" + newPageNumbers[i]);
      // thisCanvas.css("height", $('#slider').slider("option", "value"));
      if ((rotation == 90) || (rotation == 270)) {
        thisCanvas.parent().css("width", thisCanvas.height());
      }
      // $("#active-editor-" + newPageNumbers[i]).tbDisplay();
      $("#delete_" + newPageNumbers[i]).on('click', function() {
        if($("#sortable li").length == 1) {
          //todo delete all pages
        } else {
          var pagePosition = ($(this)[0].id).substring(7);
          addToUndoArray("delete", parseInt(pagePosition), [$("#original_index_" + pagePosition).data('orderedPage'), $("#sortable_canvas_" + pagePosition).data('rotation')]);
          deletePage(pagePosition);
          pageCount = $pdfCanvas.PDFViewer("pageCount");
          $pdfCanvas.PDFViewer("setPageCount", (pageCount - 1));
          correctSortablePageNumbers();
        }
      });
      $("#original_index_" + newPageNumbers[i] + " button").on("click", function(){
        var degreeChange = parseInt($(this).attr('data-degrees'));
        var page = ($(this)[0].closest("li").id).substring(15);
        $(this).closest(".thumb_element").find("canvas").each(function(){
          var newDegrees = (degreeChange % 360 + 360 + parseInt($(this).attr('data-rotation'))) % 360;
          $(this).attr('data-rotation', newDegrees);
          $(this).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + newDegrees);
          rotatedPages[page] = newDegrees;
          if ((newDegrees == 90) || (newDegrees == 270)) {
            $(this).parent().css("width", $("#sortable_canvas_" + page).height());
          } else {
            $(this).parent().css("width", $("#sortable_canvas_" + page).width());
          }
          // $("#thumb_canvas_" + thisPageNumber).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + newDegrees);
          if (parseInt(page) in documentData["pages"]) {
            // todo update form fields
            $("#active-editor-" + page).tbDisplay("renderJSON", documentData.pages[parseInt(page)].elements, $("#active-editor-" + page).find(".active-layer"), parseInt(page), true);
          }
        });
        addToUndoArray("rotate", page, degreeChange);
      });
    }
    lozadSort.observe();
  }

  function undoDeletedPage(thisPageNumber, pagePosition, rotation) {
    if (pagePosition == 1) {
      $("#sortable").prepend("<li class='ui-state-default grabbable reorder-item ui-sortable-handle' id='original_index_" + thisPageNumber + "' data-ordered-page=" + pagePosition + "' data-original-page='" + thisPageNumber + "'><div class='page-delete' id='delete_" + thisPageNumber + "'><span class='fas fa-times close' style='top: 0px;font-size:16px;opacity:0.5px'></span></div><div id='sortable_" + thisPageNumber + "' class='thumb_element' data-page-idx='" + thisPageNumber + "' style='padding: 5px 18px;display: table-cell;vertical-align: middle;'><div style='display: table-cell;vertical-align: middle;position: relative;height:" + tbHeight +"px;'><canvas id='sortable_canvas_" + thisPageNumber + "' style='box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);border: 1px solid #e1e1e;' class='lozad page-canvas deg-" + rotation + "' data-rotation='" + rotation + "'></canvas><div id='active-editor-" + thisPageNumber + "'  class='active-editor' style='height: 200px;position: absolute;top: 0px;width: 100%;'><div class='active-layer'></div></div></div><div class='btn-group' role='group' aria-label='rotate' style='margin: 0 auto;display: table;'><button type='button' class='btn'style='border: 1px solid #ccc;' data-degrees='-90'><i class='fas fa-undo'></i></button><button type='button' class='btn' style='border: 1px solid #ccc;' data-degrees='90'><i class='fas fa-redo'></i></button></div><div class='reorder-number' style='float:left;width:100%;font-size:14px;font-weight:bold;padding-top:5px;'>Page " + pagePosition + "</div></div><input type='hidden' value='" + pagePosition + "' class='reorder-index'></li>");
    } else {
      $( "#sortable li:nth-child(" + (pagePosition - 1) + ")" ).after("<li class='ui-state-default grabbable reorder-item ui-sortable-handle' id='original_index_" + thisPageNumber + "' data-ordered-page=" + pagePosition + "' data-original-page='" + thisPageNumber + "'><div class='page-delete' id='delete_" + thisPageNumber + "'><span class='fas fa-times close' style='top: 0px;font-size:16px;opacity:0.5px'></span></div><div id='sortable_" + thisPageNumber + "' class='thumb_element' data-page-idx='" + thisPageNumber + "' style='padding: 5px 18px;display: table-cell;vertical-align: middle;'><div style='display: table-cell;vertical-align: middle;position: relative;height:" + tbHeight +"px;'><canvas id='sortable_canvas_" + thisPageNumber + "' style='box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);border: 1px solid #e1e1e;' class='lozad page-canvas deg-" + rotation + "' data-rotation='" + rotation + "'></canvas><div id='active-editor-" + thisPageNumber + "' class='active-editor' style='height: 200px;position: absolute;top: 0px;width: 100%;'><div class='active-layer'></div></div></div><div class='btn-group' role='group' aria-label='rotate' style='margin: 0 auto;display: table;'><button type='button' class='btn'style='border: 1px solid #ccc;' data-degrees='-90'><i class='fas fa-undo'></i></button><button type='button' class='btn' style='border: 1px solid #ccc;' data-degrees='90'><i class='fas fa-redo'></i></button></div><div class='reorder-number' style='float:left;width:100%;font-size:14px;font-weight:bold;padding-top:5px;'>Page " + pagePosition + "</div></div><input type='hidden' value='" + pagePosition + "' class='reorder-index'></li>");
    }
    $("#active-editor-" + thisPageNumber).tbDisplay();
    lozadSort.observe();
    var thisCanvas = $("#sortable_canvas_" + thisPageNumber);
    if ((rotation == 90) || (rotation == 270)) {
      thisCanvas.parent().css("width", thisCanvas.height());
    }
    $pdfCanvas.PDFViewer("pageNumbers").splice((pagePosition - 1), 0, thisPageNumber);
    $("#delete_" + thisPageNumber).on('click', function() {
      if($("#sortable li").length == 1) {
        //todo delete all pages
      } else {
        var pageToDelete = ($(this)[0].id).substring(7);
        addToUndoArray("delete", parseInt(pageToDelete), [$("#original_index_" + pageToDelete).data('orderedPage'), $("#sortable_canvas_" + pageToDelete).data('rotation')]);
        deletePage(pageToDelete);
        pageCount = $pdfCanvas.PDFViewer("pageCount");
        $pdfCanvas.PDFViewer("setPageCount", (pageCount - 1));
        correctSortablePageNumbers();
      }
    });
    $("#original_index_" + thisPageNumber + " button").on("click", function(){
      var degreeChange = parseInt($(this).attr('data-degrees'));
      var pageToRotate = ($(this)[0].closest("li").id).substring(15);
      $(this).closest(".thumb_element").find("canvas").each(function(){
        var newDegrees = (degreeChange % 360 + 360 + parseInt($(this).attr('data-rotation'))) % 360;
        $(this).attr('data-rotation', newDegrees);
        $(this).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + newDegrees);
        rotatedPages[pageToRotate] = newDegrees;
        if ((newDegrees == 90) || (newDegrees == 270)) {
          $(this).parent().css("width", $("#sortable_canvas_" + pageToRotate).height());
        } else {
          $(this).parent().css("width", $("#sortable_canvas_" + pageToRotate).width());
        }
        if (parseInt(pageToRotate) in documentData["pages"]) {
          // todo update form fields
          $("#active-editor-" + pageToRotate).tbDisplay("renderJSON", documentData.pages[parseInt(pageToRotate)].elements, $("#active-editor-" + pageToRotate).find(".active-layer"), parseInt(pageToRotate), true);
        }
      });
      addToUndoArray("rotate", pageToRotate, degreeChange);
    });
  }

  function correctSortablePageNumbers() {
    $(".reorder-item").each(function(index){
      $(this).find(".reorder-number").text("Page " + (index + 1));
      $(this).attr('data-ordered-page', (index + 1));
    });
  };

  function undo() {
    if (thumbnailsView) {
      if (jQuery.isEmptyObject(undoArray)) {
      } else {
        if ((!Array.isArray(undoArray[0]) || !undoArray[0].length)) {
        } else {
          var lastElement = undoArray[0][undoArray[0].length - 1];
          redoArray[0].push(undoArray[0][undoArray[0].length - 1]);

          if (lastElement['type'] == "delete") {
            undoDeletedPage(parseInt(lastElement['page']), parseInt(lastElement['data'][0]), parseInt(lastElement['data'][1]));
            pageCount = $pdfCanvas.PDFViewer("pageCount");
            $pdfCanvas.PDFViewer("setPageCount", (pageCount + 1));
            correctSortablePageNumbers();
          } else if (lastElement['type'] == "delete_many") {
            for (var i=0; i < lastElement['page'].length; i++) {
              undoDeletedPage(parseInt(lastElement['page'][i]), parseInt(lastElement['data'][0][i]), parseInt(lastElement['data'][1][i]));
            }
            $pdfCanvas.PDFViewer("setPageCount", $pdfCanvas.PDFViewer("pageNumbers").length);
            correctSortablePageNumbers();
          } else if (lastElement['type'] == "rotate_all") {
            $(".reorder-item canvas").each(function(i){
              var prevDegrees = lastElement['data'][1][i];
              var page = ($(this)[0].closest("li").id).substring(15);
              $(this).attr('data-rotation', prevDegrees);
              $(this).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + prevDegrees);
              rotatedPages[page] = parseInt(prevDegrees);
              if ((prevDegrees == 90) || (prevDegrees == 270)) {
                $(this).parent().css("width", $(this).height());
              } else {
                $(this).parent().css("width", $(this).width());
              }
              // $("#thumb_canvas_" + page).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + 0);
              if (parseInt(page) in documentData["pages"]) {
                // todo update form fields
                $("#active-editor-" + page).tbDisplay("renderJSON", documentData.pages[parseInt(page)].elements, $("#active-editor-" + page).find(".active-layer"), parseInt(page), true);
              }
            });
          } else if (lastElement['type'] == "rotate") {
            var thisCanvas = $("#sortable_canvas_" + lastElement['page']);
            var newDegrees = (-(lastElement['data'] % 360) + 360 + parseInt(thisCanvas.attr('data-rotation'))) % 360;
            thisCanvas.attr('data-rotation', newDegrees);
            thisCanvas.removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + newDegrees);
            rotatedPages[lastElement['page']] = parseInt(newDegrees);
            if ((newDegrees == 90) || (newDegrees == 270)) {
              thisCanvas.parent().css("width", thisCanvas.height());
            } else {
              thisCanvas.parent().css("width", thisCanvas.width());
            }
            // $("#thumb_canvas_" + lastElement['page']).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + newDegrees);
            if (parseInt(lastElement['page']) in documentData["pages"]) {
              // todo update form fields
              $("#active-editor-" + lastElement['page']).tbDisplay("renderJSON", documentData.pages[parseInt(lastElement['page'])].elements, $("#active-editor-" + lastElement['page']).find(".active-layer"), parseInt(lastElement['page']), true);
            }
          } else if (lastElement['type'] == "reorder") {
            var thisPage = lastElement['page'];
            $pdfCanvas.PDFViewer("pageNumbers").splice(lastElement['data'][1], 1);
            $pdfCanvas.PDFViewer("pageNumbers").splice(lastElement['data'][0], 0, thisPage);
            reorderedThumbnails();
            correctSortablePageNumbers();
          } else if (lastElement['type'] == "blank_page") {
            var pagePosition = lastElement['page'];
            deletePage(pagePosition);
            pageCount = $pdfCanvas.PDFViewer("pageCount");
            $pdfCanvas.PDFViewer("setPageCount", (pageCount - 1));
            correctSortablePageNumbers();
          } else if (lastElement['type'] == "merge") {
            for (var i=0; i < lastElement['page'].length; i++) {
              deletePage(lastElement['page'][i]);
            }
            $pdfCanvas.PDFViewer("setPageCount", $pdfCanvas.PDFViewer("pageNumbers").length);
            correctSortablePageNumbers();
          }
          if (undoArray[0].length == 1) {
            $("#undo-btn").removeClass("active-undoredo");
          }
          undoArray[0].pop();
          $("#redo-btn").addClass("active-undoredo");
        }
      }
    } else {
      if (jQuery.isEmptyObject(undoArray)) {
      } else {
        var currentPageNumber = $pdfCanvas.PDFViewer("pageNumber");
        if (!Array.isArray(undoArray[currentPageNumber]) || !undoArray[currentPageNumber].length) {
        } else {
          if (!(currentPageNumber in redoArray)) {
            redoArray[currentPageNumber] = [];
          }
          if (undoArray[currentPageNumber].length == 1) {
            $("#undo-btn").removeClass("active-undoredo");
          }
          var lastElement = undoArray[currentPageNumber][undoArray[currentPageNumber].length - 1]
          if (lastElement['type'] == "add") {
            var closest = $("#new-surface").find("#element-layer");
            var elementToCheck = closest.find('*[data-id="' + lastElement['id'] + '"]');
            console.log("elementToCheckData");
            var elementToCheckData = elementToCheck.activeElement("toJSON");
            if (elementToCheckData != lastElement['data']) {
              undoArray[currentPageNumber][undoArray[currentPageNumber].length - 1] = {type: "add", data: elementToCheckData, id: lastElement['id']}
            }
          };
          $("#new-surface").activeEditor("undoElement", currentPageNumber);
          $("#redo-btn").addClass("active-undoredo");
        }
      }
    }
  }

  function deletePage(pagePosition) {
    $("#original_index_" + pagePosition).remove();
    // $("#thumb_" + pagePosition).remove();
    var pageNumberIndex = $pdfCanvas.PDFViewer("pageNumbers").indexOf(parseInt(pagePosition));
    if (pageNumberIndex > -1) {
      $pdfCanvas.PDFViewer("pageNumbers").splice(pageNumberIndex, 1);
    }
  }

  function redo() {
    if (jQuery.isEmptyObject(redoArray)) {
    } else {
      if (thumbnailsView) {
        if ((!Array.isArray(redoArray[0]) || !redoArray[0].length)) {
        } else {
          var nextElement = redoArray[0][redoArray[0].length - 1];
          if (nextElement['type'] == "delete") {
            var pagePosition = nextElement['page'];
            deletePage(pagePosition);
            pageCount = $pdfCanvas.PDFViewer("pageCount");
            $pdfCanvas.PDFViewer("setPageCount", (pageCount - 1));
            correctSortablePageNumbers();
          } else if (nextElement['type'] == "delete_many") {
            for (i=0; i < nextElement['page'].length; i++) {
              var pagePosition = nextElement['page'][i];
              deletePage(pagePosition);
            }
            $pdfCanvas.PDFViewer("setPageCount", $pdfCanvas.PDFViewer("pageNumbers").length);
            correctSortablePageNumbers();
          } else if (nextElement['type'] == "rotate_all") {
            var degrees = nextElement['data'][0];
            $(".reorder-item canvas").each(function(){
              var page = ($(this)[0].closest("li").id).substring(15);
              $(this).attr('data-rotation', degrees);
              $(this).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + degrees);
              rotatedPages[page] = parseInt(degrees);
              if ((degrees == 90) || (degrees == 270)) {
                $(this).parent().css("width", $(this).height());
              } else {
                $(this).parent().css("width", $(this).width());
              }
              // $("#thumb_canvas_" + page).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + degrees);
              if (parseInt(nextElement['page']) in documentData["pages"]) {
                // todo update form fields
                $("#active-editor-" + page).tbDisplay("renderJSON", documentData.pages[parseInt(page)].elements, $("#active-editor-" + page).find(".active-layer"), parseInt(page), true);
              }
            });
          } else if (nextElement['type'] == "rotate") {
            var thisCanvas = $("#sortable_canvas_" + nextElement['page']);
            var newDegrees = (nextElement['data'] % 360 + 360 + parseInt(thisCanvas.attr('data-rotation'))) % 360;
            thisCanvas.attr('data-rotation', newDegrees);
            thisCanvas.removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + newDegrees);
            rotatedPages[nextElement['page']] = parseInt(newDegrees);
            if ((newDegrees == 90) || (newDegrees == 270)) {
              thisCanvas.parent().css("width", thisCanvas.height());
            } else {
              thisCanvas.parent().css("width", thisCanvas.width());
            }
            // $("#thumb_canvas_" + nextElement['page']).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + newDegrees);
            if (parseInt(nextElement['page']) in documentData["pages"]) {
              // todo update form fields
              $("#active-editor-" + nextElement['page']).tbDisplay("renderJSON", documentData.pages[parseInt(nextElement['page'])].elements, $("#active-editor-" + nextElement['page']).find(".active-layer"), parseInt(nextElement['page']), true);
            }
          } else if (nextElement['type'] == "reorder") {
            // addToUndoArray("reorder", ui.item.data("originalPage"), [start_pos, index])
            var thisPage = nextElement['page'];
            $pdfCanvas.PDFViewer("pageNumbers").splice(nextElement['data'][0], 1);
            $pdfCanvas.PDFViewer("pageNumbers").splice(nextElement['data'][1], 0, thisPage);
            reorderedThumbnails();
            correctSortablePageNumbers();
          } else if (nextElement['type'] == "blank_page") {
            pageCount = $pdfCanvas.PDFViewer("pageCount");
            undoDeletedPage(parseInt(nextElement['page']), (pageCount + 1), 0);
            $pdfCanvas.PDFViewer("setPageCount", (pageCount + 1));
            correctSortablePageNumbers();
          } else if (nextElement['type'] == "merge") {
            for (var i=0; i < nextElement['page'].length; i++) {
              undoDeletedPage(parseInt(nextElement['page'][i]), parseInt(nextElement['data']) + i, 0);
            }
            $pdfCanvas.PDFViewer("setPageCount", $pdfCanvas.PDFViewer("pageNumbers").length);
            correctSortablePageNumbers();
          }
          if (redoArray[0].length == 1) {
            $("#redo-btn").removeClass("active-undoredo");
          }
          undoArray[0].push(nextElement);
          redoArray[0].pop();
          $("#undo-btn").addClass("active-undoredo");
        }
      } else {
        var currentPageNumber = $pdfCanvas.PDFViewer("pageNumber");
        if (!Array.isArray(redoArray[currentPageNumber]) || !redoArray[currentPageNumber].length) {
        } else {
          $("#new-surface").activeEditor("redoElement", currentPageNumber);
        }
      }
    }
  }

  function addToElementLayer(elementData, thisId) {
    var thisPageNum = parseInt($pdfCanvas.PDFViewer("pageNumber"));
    redoArray[thisPageNum] = [];
    if (!(thisPageNum in undoArray)) {
      undoArray[thisPageNum] = [];
    } else {
      if (undoArray[thisPageNum].length > 0) {
        // console.log(undoArray[thisPageNum]);
        var lastElement = undoArray[thisPageNum][undoArray[thisPageNum].length - 1];
        if (lastElement['type'] == "add") {
          var closest = $("#new-surface").find("#element-layer");
          var elementToCheck = closest.find('*[data-id="' + lastElement['id'] + '"]');
          console.log("elementToCheckData2");
          var elementToCheckData = elementToCheck.activeElement("toJSON");
          if (elementToCheckData != lastElement['data']) {
            undoArray[thisPageNum][undoArray[thisPageNum].length - 1] = {type: "add", data: elementToCheckData, id: lastElement['id']}
          }
        }
      }
    }
    if (undoArray[thisPageNum].length > 0 && undoArray[thisPageNum].filter(function(e) { return ((e.id === thisId) && (e.type === 'add')); }).length > 0) {
    } else {
      undoArray[thisPageNum].push({type: "add", data: elementData, id: thisId});
    }
    // console.log(undoArray[thisPageNum]);
    $("#redo-btn").removeClass("active-undoredo");
    $("#undo-btn").addClass("active-undoredo");
  }

  function updateElement(dataType, elementData, thisId) {
    var thisPageNum = parseInt($pdfCanvas.PDFViewer("pageNumber"));
    redoArray[thisPageNum] = [];
    if (!(thisPageNum in undoArray)) {
      undoArray[thisPageNum] = [];
    } else {
      if (undoArray[thisPageNum].length > 0) {
        // console.log(undoArray[thisPageNum]);
        var lastElement = undoArray[thisPageNum][undoArray[thisPageNum].length - 1];
        if (lastElement['type'] == "add") {
          var closest = $("#new-surface").find("#element-layer");
          var elementToCheck = closest.find('*[data-id="' + lastElement['id'] + '"]');
          console.log("elementToCheckData2");
          var elementToCheckData = elementToCheck.activeElement("toJSON");
          if (elementToCheckData != lastElement['data']) {
            undoArray[thisPageNum][undoArray[thisPageNum].length - 1] = {type: "add", data: elementToCheckData, id: lastElement['id']}
          }
        }
      }
    }
    // if (undoArray[thisPageNum].length > 0 && undoArray[thisPageNum].filter(function(e) { return ((e.id === thisId) && (e.type === 'add')); }).length > 0) {
    // } else {
    undoArray[thisPageNum].push({type: "update", dataType: dataType, data: elementData, id: thisId});
    // }
    $("#redo-btn").removeClass("active-undoredo");
    $("#undo-btn").addClass("active-undoredo");
  }

  function readJSON() {
    var i = $pdfCanvas.PDFViewer("pageNumber");
    var r20 = documentData.pages[i] ? documentData.pages[i].elements : [];
    $("#new-surface").activeEditor("readJSON", r20, i);
  }

  function checkAutosize() {
    $("#new-surface").activeEditor("checkAutosize");
  }

  function goToPage(result, prevPage, changeToMode, forms) {
    disablePageNav();
    writeJSON();
    if(prevPage) {
      if (prevPage in documentData["pages"]) {
        $("#active-thumb-" + prevPage).tbDisplay("renderJSON", documentData.pages[prevPage].elements, $("#active-thumb-" + prevPage).find(".active-layer"), prevPage, false);
      } else {
        $("#active-thumb-" + prevPage).tbDisplay("clear");
      }
    }
    if(redoArray[result] && redoArray[result].length) {
      $("#redo-btn").addClass("active-undoredo");
    } else {
      $("#redo-btn").removeClass("active-undoredo");
    }
    if(undoArray[result] && undoArray[result].length) {
      $("#undo-btn").addClass("active-undoredo");
    } else {
      $("#undo-btn").removeClass("active-undoredo");
    }
    // var pageData = documentData.pages;
    // if (!(result in pageData)) {
    //   $("#undo-btn").removeClass("active-undoredo");
    // } else {
    //   if (!Array.isArray(pageData[result].elements) || !pageData[result].elements.length) {
    //     $("#undo-btn").removeClass("active-undoredo");
    //   } else {
    //     $("#undo-btn").addClass("active-undoredo");
    //   }
    // }
    $("#new-surface").activeEditor("clear");
    var related = $("#new-surface").activeEditor("mode");
    if (_.contains(["IMAGE", "SIGNATURE"], related)) {
      $("#new-surface").activeEditor("mode", "TRANSFORM");
    }
    $("#one_page").hide();
    $(".page-number").show();

    if (forms) {
      formsEnabled = true;
    }

    //if ("Editor" == "Editor") {
    $pdfCanvas.PDFViewer("renderPage", result, currentPageScale, true, {x: 0, y: 0}, changeToMode);
    // } else {
    //   $pdfCanvas.PDFViewer("setPageNumber", result);
    //   // var i = $pdfCanvas.PDFViewer("pageNumber");
    //   var r20 = documentData.pages[result] ? documentData.pages[result].elements : [];
    //   $("#new-surface").activeEditor("readJSON", r20);
    //   enablePageNav();
    // }
  }

  function disablePageNav() {
    $viewerToolbar.find(".btn-pdf-nav").attr("disabled", "disabled");
  }

  function enablePageNav() {
    $viewerToolbar.find(".btn-pdf-nav").removeAttr("disabled");
  }

  function showToolbar(type, attributes) {
    $(".editor-toolbar:not(#viewer-toolbar)").hide();
    if($.inArray(type, ["text-field", "check-field", "date-field", "sig-field", "combo-field"]) == -1) {
      if ($("#right-side-panel").hasClass("active")) {
        $("#right-side-panel").hide();
        $("#right-side-panel").removeClass("active");
        setHeightsAndWidths(currentPageWidth, currentPageHeight);
      }
    }
    if($("#progress-block").is(":visible")) {
    } else {
      var tooltip;
      switch(type) {
        case "none":
          tooltip = $("#empty-toolbar");
          break;
        case "delete-pages":
          tooltip = $("#delete-pages-toolbar");
          break;
        // case "merge":
        //   tooltip = $("#merge-toolbar");
        //   break;
        case "rotate":
          tooltip = $("#rotate-toolbar");
          break;
        case "reorder":
          tooltip = $("#reorder-toolbar");
          break;
        case "text":
          tooltip = $("#text-toolbar");
          break;
        case "page-fields":
          if (!$("#right-side-panel").hasClass("active")) {
            $("#right-side-panel").addClass("active");
            $("#right-side-panel").show();
            setHeightsAndWidths(currentPageWidth, currentPageHeight);
          }
          $("#check-field-properties").hide();
          $("#date-field-properties").hide();
          $("#sig-field-properties").hide();
          $("#combo-field-properties").hide();
          $("#text-field-properties").hide();
          $("#page-fields-properties").show();
          break;
        case "text-field":
          tooltip = $("#text-field-toolbar");
          if (!$("#right-side-panel").hasClass("active")) {
            $("#right-side-panel").addClass("active");
            $("#right-side-panel").show();
            setHeightsAndWidths(currentPageWidth, currentPageHeight);
          }
          $("#page-fields-properties").hide();
          $("#check-field-properties").hide();
          $("#date-field-properties").hide();
          $("#sig-field-properties").hide();
          $("#combo-field-properties").hide();
          $("#text-field-properties").show();
          break;
        case "check-field":
          tooltip = $("#check-field-toolbar");
          if (!$("#right-side-panel").hasClass("active")) {
            $("#right-side-panel").addClass("active");
            $("#right-side-panel").show();
            setHeightsAndWidths(currentPageWidth, currentPageHeight);
          }
          $("#page-fields-properties").hide();
          $("#text-field-properties").hide();
          $("#date-field-properties").hide();
          $("#sig-field-properties").hide();
          $("#combo-field-properties").hide();
          $("#check-field-properties").show();
          break;
        case "date-field":
          tooltip = $("#date-field-toolbar");
          $("#right-side-panel").find("#title-field-type").text("Date Field");
          if (!$("#right-side-panel").hasClass("active")) {
            $("#right-side-panel").addClass("active");
            $("#right-side-panel").show();
            setHeightsAndWidths(currentPageWidth, currentPageHeight);
          }
          $("#page-fields-properties").hide();
          $("#text-field-properties").hide();
          $("#check-field-properties").hide();
          $("#sig-field-properties").hide();
          $("#combo-field-properties").hide();
          $("#date-field-properties").show();
          break;
        case "sig-field":
          if (formsEnabled) {
            tooltip = $("#empty-toolbar");
            if (!$("#right-side-panel").hasClass("active")) {
              $("#right-side-panel").addClass("active");
              $("#right-side-panel").show();
              setHeightsAndWidths(currentPageWidth, currentPageHeight);
            }
            $("#page-fields-properties").hide();
            $("#text-field-properties").hide();
            $("#check-field-properties").hide();
            $("#date-field-properties").hide();
            $("#combo-field-properties").hide();
            $("#sig-field-properties").show();
          }
          break;
        case "combo-field":
          tooltip = $("#combo-field-toolbar");
          if (!$("#right-side-panel").hasClass("active")) {
            $("#right-side-panel").addClass("active");
            $("#right-side-panel").show();
            setHeightsAndWidths(currentPageWidth, currentPageHeight);
          }
          $("#page-fields-properties").hide();
          $("#check-field-properties").hide();
          $("#date-field-properties").hide();
          $("#sig-field-properties").hide();
          $("#text-field-properties").hide();
          $("#combo-field-properties").show();
          break;
        case "path":
          tooltip = $("#path-toolbar");
          break;
        case "hyperlink":
          tooltip = $("#hyperlink-toolbar");
          break;
        case "erase":
          tooltip = $("#erase-toolbar");
          break;
        case "highlight":
          tooltip = $("#highlight-toolbar");
          break;
        case "shape":
          tooltip = $("#shape-toolbar");
          break;
        case "signature":
          tooltip = $("#signature-toolbar");
          break;
        case "symbol":
          tooltip = $("#symbol-toolbar");
          break;
        case "multiple":
          tooltip = $("#multiple-toolbar");
          if (!$("#right-side-panel").hasClass("active")) {
            $("#right-side-panel").addClass("active");
            $("#right-side-panel").show();
            setHeightsAndWidths(currentPageWidth, currentPageHeight);
          }
          $("#check-field-properties").hide();
          $("#date-field-properties").hide();
          $("#sig-field-properties").hide();
          $("#combo-field-properties").hide();
          $("#text-field-properties").hide();
          $("#page-fields-properties").show();
      }
      if (tooltip) {
        tooltip.show();
        tooltip.find(".btn-group").show();
        tooltip.find(".btn-group").removeClass("first-child");
        if (0 == _.isUndefined(attributes)) {
          $.each(attributes, function(dataAndEvents, index) {
            tooltip.find("." + index).hide();
            tooltip.find(".toolbar-btn-group:visible:first").addClass("first-child");
          });
        } else {
          $.each(tooltip.find(".toolbar-option"), function(index) {
            $(this).show();
          });
        }
      }
    }
  }

  function onPageRender() {
    // if (null != renderTimer) {
    //   clearTimeout(renderTimer);
    //   /** @@type {null} */
    //   renderTimer = null;
    // }
    $("#progress-block").hide();
    $("#editor-navbar").hide();
    $(".loaded-pdf-element").show();
    $("#new-surface").show();
    enablePageNav();
    checkAutosize();
    renderingPage = false;
    if(!saving) {$('.document-button').removeClass('disabled');}
  }

  function onPageGet(InkElement) {
    $("#new-surface").hide();
    $newFields = $("form#document-form").find(".new-fields");
    // if ($newFields.exists()) {
    //   $newFields.find('input[name="document[page_width]"]').val(InkElement.pageWidth);
    //   $newFields.find('input[name="document[page_height]"]').val(InkElement.pageHeight);
    // }
    currentPageWidth = InkElement.pageWidth;
    currentPageHeight = InkElement.pageHeight;
    // currentPageScale = InkElement.pageScale;
    var udataCur = $pdfCanvas.PDFViewer("pageNumbers").indexOf($pdfCanvas.PDFViewer("pageNumber")) + 1;
    $(".page-number").val(udataCur);
    readJSON();
    if (InkElement.changeToMode) {
      $("#new-surface").activeEditor("mode", InkElement.changeToMode);
    }
  }

  function pagePrevious() {
    var expectationResult = $pdfCanvas.PDFViewer("pageNumbers").indexOf($pdfCanvas.PDFViewer("pageNumber")) + 1;
    if (expectationResult > 1) {
      // expectationResult--;
      goToPage($pdfCanvas.PDFViewer("pageNumbers")[expectationResult - 2], $pdfCanvas.PDFViewer("pageNumber"), "TRANSFORM", false);
    }
  }
  /**
   * @@return {undefined}
   */
  function pageNext() {
    var expectationResult = $pdfCanvas.PDFViewer("pageNumbers").indexOf($pdfCanvas.PDFViewer("pageNumber")) + 1;
    var end = $pdfCanvas.PDFViewer("pageCount");
    if (!(expectationResult >= end)) {
      // expectationResult++;
      goToPage($pdfCanvas.PDFViewer("pageNumbers")[expectationResult], $pdfCanvas.PDFViewer("pageNumber"), "TRANSFORM", false);
    }
  }

  function updateTextSettings() {
    var p = $("#text-toolbar");
   //  if (newColor) {
    //   var str = p.find("#text-colorpicker").colorpicker("value", newColor);
    // }  else {
      var str = p.find("#text-colorpicker").spectrum("get").toHexString();
    // }
    // var str = p.find("#text-colorpicker").val();
    // var isFunction = p.find("#text-bg-colorpicker").colorpicker("value");
    /** @@type {number} */
    var size = parseInt(p.find("#text-size").val());
    var font = p.find("#text-font").text();
    var bold = p.find("#text-bold").hasClass("active");
    var italic = p.find("#text-italic").hasClass("active");
    var underlined = p.find("#text-underlined").hasClass("active");
    p.find("#text-align-left").hasClass("active");
    var align;
    var isX = p.find("#text-align-center").hasClass("active");
    var active = p.find("#text-align-right").hasClass("active");
    /** @@type {string} */
    align = active ? "right" : isX ? "center" : "left";
    $("#new-surface").activeEditor("tool_settings", {
      text : {
        color : str,
        // bg_color : isFunction,
        size : size,
        font : font,
        bold : bold,
        italic : italic,
        align : align,
        underlined: underlined
      }
    });
  }

  function updateTextFieldSettings() {
    var p = $("#text-field-toolbar");
    var q = $("#text-field-properties");
    var str = p.find("#text-field-colorpicker").spectrum("get").toHexString();
    var hf = q.find("#text-field-back-colorpicker").spectrum("get");
    if (hf)
      hf = q.find("#text-field-back-colorpicker").spectrum("get").toHexString();
    else {
      hf = "NONE";
    }
    var boo = q.find("#text-field-border-colorpicker").spectrum("get");
    if (boo)
      boo = q.find("#text-field-border-colorpicker").spectrum("get").toHexString();
    else {
      boo = "NONE";
    }
    var chup = $("#text-field-size").val();
    if (chup == "auto") {
      var size = 0;
      var autosized = true;
    } else {
      var size = parseInt(chup);
      var autosized = false;
    }
    var comb = q.find("#text-field-comb").is(':checked');
    var required = q.find("#text-field-required").is(':checked');
    var maxlen = q.find("#text-field-maxlength").val();
    var font = p.find("#text-field-font").text();
    var bold = p.find("#text-field-bold").hasClass("active");
    var italic = p.find("#text-field-italic").hasClass("active");
    // var underlined = p.find("#text-field-underlined").hasClass("active");
    var borderWidth = parseInt(q.find("#text-field-border-width").val());
    var fieldName = q.find("#text-field-name").val();
    var placeholder = q.find("#text-field-placeholder").val();
    var align;
    var isX = p.find("#text-field-align-center").hasClass("active");
    var active = p.find("#text-field-align-right").hasClass("active");
    align = active ? "right" : isX ? "center" : "left";
    $("#new-surface").activeEditor("tool_settings", {
      text_field : {
        color : str,
        back_color: hf,
        border_color: boo,
        border_width : borderWidth,
        size : size,
        font : font,
        bold : bold,
        italic : italic,
        align : align,
        // underlined: underlined,
        autosize: autosized,
        comb: comb,
        required: required,
        max_len: maxlen,
        default: placeholder,
        field_name: fieldName
      }
    });
  }

  function updateDateFieldSettings() {
    var p = $("#date-field-toolbar");
    var q = $("#date-field-properties");
    var str = p.find("#date-field-colorpicker").spectrum("get").toHexString();
    var hf = q.find("#date-field-back-colorpicker").spectrum("get");
    if (hf)
      hf = q.find("#date-field-back-colorpicker").spectrum("get").toHexString();
    else {
      hf = "NONE";
    }
    var boo = q.find("#date-field-border-colorpicker").spectrum("get");
    if (boo)
      boo = q.find("#date-field-border-colorpicker").spectrum("get").toHexString();
    else {
      boo = "NONE";
    }
    var chup = $("#date-field-size").val();
    if (chup == "auto") {
      var size = 0;
      var autosized = true;
    } else {
      var size = parseInt(chup);
      var autosized = false;
    }
    var required = q.find("#date-field-required").is(':checked');
    var font = p.find("#date-field-font").text();
    var bold = p.find("#date-field-bold").hasClass("active");
    var italic = p.find("#date-field-italic").hasClass("active");
    var borderWidth = parseInt(q.find("#date-field-border-width").val());
    var fieldName = q.find("#date-field-name").val();
    var align;
    var isX = p.find("#date-field-align-center").hasClass("active");
    var active = p.find("#date-field-align-right").hasClass("active");
    align = active ? "right" : isX ? "center" : "left";
    var format = q.find("#date-field-format").val();
    $("#new-surface").activeEditor("tool_settings", {
      date_field : {
        color : str,
        back_color: hf,
        border_color: boo,
        border_width : borderWidth,
        size : size,
        font : font,
        bold : bold,
        italic : italic,
        align : align,
        autosize: autosized,
        required: required,
        field_name: fieldName,
        format: format
      }
    });
  }

  function updateCheckFieldSettings() {
    var p = $("#check-field-toolbar");
    var q = $("#check-field-properties");
    var str = p.find("#check-field-colorpicker").spectrum("get").toHexString();
    var hf = q.find("#check-field-back-colorpicker").spectrum("get");
    if (hf)
      hf = q.find("#check-field-back-colorpicker").spectrum("get").toHexString();
    else {
      hf = "NONE";
    }
    var boo = q.find("#check-field-border-colorpicker").spectrum("get");
    if (boo)
      boo = q.find("#check-field-border-colorpicker").spectrum("get").toHexString();
    else {
      boo = "NONE";
    }
    var chup = $("#check-field-size").val();
    if (chup == "auto") {
      var size = 0;
      var autosized = true;
    } else {
      var size = parseInt(chup);
      var autosized = false;
    }
    var required = q.find("#check-field-required").is(':checked');
    var char = p.find("#check-field-char").text();
    var borderWidth = parseInt(q.find("#check-field-border-width").val());
    var fieldName = q.find("#check-field-name").val();
    var exportVal = q.find("#check-field-export").val();
    $("#new-surface").activeEditor("tool_settings", {
      check_field : {
        color : str,
        back_color: hf,
        border_color: boo,
        border_width : borderWidth,
        size : size,
        char : char,
        required: required,
        field_name: fieldName,
        export: exportVal,
        autosize: autosized
      }
    });
  }

  function updateSigFieldSettings() {
    // var p = $("#sig-field-toolbar");
    var q = $("#sig-field-properties");
    // var size = parseInt(p.find("#sig-field-size").val());
    // var str = p.find("#sig-field-colorpicker").spectrum("get").toHexString();
    var hf = q.find("#sig-field-back-colorpicker").spectrum("get");
    if (hf)
      hf = q.find("#sig-field-back-colorpicker").spectrum("get").toHexString();
    else {
      hf = "NONE";
    }
    var boo = q.find("#sig-field-border-colorpicker").spectrum("get");
    if (boo)
      boo = q.find("#sig-field-border-colorpicker").spectrum("get").toHexString();
    else {
      boo = "NONE";
    }
    var required = q.find("#sig-field-required").is(':checked');
    var borderWidth = parseInt(q.find("#sig-field-border-width").val());
    var fieldName = q.find("#sig-field-name").val();
    $("#new-surface").activeEditor("tool_settings", {
      sig_field : {
        // color : str,
        // size : size,
        back_color: hf,
        border_color: boo,
        border_width : borderWidth,
        align : "left",
        required: required,
        field_name: fieldName
      }
    });
  }

  function updateComboFieldSettings() {
    var p = $("#combo-field-toolbar");
    var q = $("#combo-field-properties");
    var str = p.find("#combo-field-colorpicker").spectrum("get").toHexString();
    var hf = q.find("#combo-field-back-colorpicker").spectrum("get");
    if (hf)
      hf = q.find("#combo-field-back-colorpicker").spectrum("get").toHexString();
    else {
      hf = "NONE";
    }
    var boo = q.find("#combo-field-border-colorpicker").spectrum("get");
    if (boo)
      boo = q.find("#combo-field-border-colorpicker").spectrum("get").toHexString();
    else {
      boo = "NONE";
    }
    var chup = $("#combo-field-size").val();
    if (chup == "auto") {
      var size = 0;
      var autosized = true;
    } else {
      var size = parseInt(chup);
      var autosized = false;
    }
    var required = q.find("#combo-field-required").is(':checked');
    // var allowEmpty = q.find("#combo-field-empty").is(':checked');
    // var multiSelect = q.find("#combo-field-multiple").is(':checked');
    // var sortedChoices = q.find("#combo-field-sort").is(':checked');
    // var allowEdit = q.find("#combo-field-edit").is(':checked');
    var font = p.find("#combo-field-font").text();
    var bold = p.find("#combo-field-bold").hasClass("active");
    var italic = p.find("#combo-field-italic").hasClass("active");
    var borderWidth = parseInt(q.find("#combo-field-border-width").val());
    var fieldName = q.find("#combo-field-name").val();
    var align;
    var isX = p.find("#combo-field-align-center").hasClass("active");
    var active = p.find("#combo-field-align-right").hasClass("active");
    align = active ? "right" : isX ? "center" : "left";
    $("#new-surface").activeEditor("tool_settings", {
      combo_field : {
        color : str,
        back_color: hf,
        border_color: boo,
        border_width : borderWidth,
        size : size,
        font : font,
        bold : bold,
        italic : italic,
        align : align,
        autosize: autosized,
        required: required,
        field_name: fieldName,
        // allow_edit : allowEdit,
        // multi_select : multiSelect,
        // sorted : sortedChoices,
        // allow_empty : allowEmpty
      }
    });
  }

  function updateComboChoices() {
    var q = $("#combo-field-properties");
    var allowEmpty = q.find("#combo-field-empty").is(':checked');
    var multiSelect = q.find("#combo-field-multiple").is(':checked');
    var sortedChoices = q.find("#combo-field-sort").is(':checked');
    var allowEdit = q.find("#combo-field-edit").is(':checked');
    $("#new-surface").activeEditor("updateComboChoices", {
      allow_edit : allowEdit,
      multi_select : multiSelect,
      sorted : sortedChoices,
      allow_empty : allowEmpty
    });
  }

  function updateSignatureSettings() {
    var p = $("#signature-toolbar");
    var str = p.find("#signature-colorpicker").spectrum("get").toHexString();
    /** @@type {number} */
    var size = parseInt(p.find("#signature-size").val());
    /** @@type {string} */
    $("#new-surface").activeEditor("tool_settings", {
      signature : {
        color : str,
        size : size,
        align : "left"
      }
    });
  }
  /**
   * @@return {undefined}
   */
  function updatePathSettings() {
    var isFunction = $("#path-toolbar").find("#path-colorpicker").spectrum("get").toHexString();
    /** @@type {number} */
    var strokeWidth = parseInt($("#path-toolbar").find("#path-width").val());
    $("#new-surface").activeEditor("tool_settings", {
      path : {
        stroke_color : isFunction,
        stroke_width : strokeWidth
      }
    });
  }
  /**
   * @@return {undefined}
   */
  function updateShapeSettings() {
    var isFunction = $("#shape-toolbar").find("#shape-fill-colorpicker").spectrum("get");
    if (isFunction)
      isFunction = $("#shape-toolbar").find("#shape-fill-colorpicker").spectrum("get").toHexString();
    else {
      isFunction = "NONE";
    }
    var mArr = $("#shape-toolbar").find("#shape-stroke-colorpicker").spectrum("get");
    if (mArr)
      mArr = $("#shape-toolbar").find("#shape-stroke-colorpicker").spectrum("get").toHexString();
    else {
      mArr = "NONE";
    }
    /** @@type {number} */
    var strokeWidth = parseInt($("#shape-toolbar").find("#shape-stroke-width").val());
    $("#new-surface").activeEditor("tool_settings", {
      shape : {
        fill_color : isFunction,
        stroke_color : mArr,
        stroke_width : strokeWidth
      }
    });
  }

  function updateHyperlinkSettings() {
    var mArr = $("#hyperlink-toolbar").find("#hyperlink-colorpicker").spectrum("get");
    if (mArr)
      mArr = $("#hyperlink-toolbar").find("#hyperlink-colorpicker").spectrum("get").toHexString();
    else {
      mArr = "NONE";
    }
    /** @@type {number} */
    var strokeWidth = parseInt($("#hyperlink-toolbar").find("#hyperlink-stroke-width").val());
    $("#new-surface").activeEditor("tool_settings", {
      hyperlink : {
        stroke_color : mArr,
        stroke_width : strokeWidth
      }
    });
  }

  function updateEraseSettings() {
    var isFunction = $("#erase-toolbar").find("#erase-colorpicker").spectrum("get").toHexString();
    /** @@type {number} */
    $("#new-surface").activeEditor("tool_settings", {
      erase: {
        fill_color : isFunction
      }
    });
  }

  function updateHighlightSettings() {
    var isFunction = $("#highlight-toolbar").find("#highlight-colorpicker").spectrum("get").toHexString();
    /** @@type {number} */
    $("#new-surface").activeEditor("tool_settings", {
      highlight: {
        fill_color : isFunction
      }
    });
  }
  /**
   * @@return {undefined}
   */
  function updateSymbolSettings() {
    var str = $("#symbol-toolbar").find("#symbol-colorpicker").spectrum("get").toHexString();
    /** @@type {number} */
    var charCodeToReplace = parseInt($("#symbol-toolbar").find("#symbol-size-select").val());
    /** @@type {number} */
    var size = 24;
    switch(charCodeToReplace) {
      case 1:
        /** @@type {number} */
        size = 14;
        break;
      case 2:
        /** @@type {number} */
        size = 18;
        break;
      case 3:
        /** @@type {number} */
        size = 24;
        break;
      case 4:
        /** @@type {number} */
        size = 32;
        break;
      case 5:
        /** @@type {number} */
        size = 40;
        break;
      case 6:
        /** @@type {number} */
        size = 48;
        break;
      case 7:
        /** @@type {number} */
        size = 64;
        break;
      case 8:
        /** @@type {number} */
        size = 96;
    }
    $("#new-surface").activeEditor("tool_settings", {
      symbol : {
        color : str,
        size : size
      }
    });
  }
  /**
   * @@return {undefined}
   */
  function updateToolbars() {
    var item = $("#new-surface").activeEditor("tool_settings");
    var p = $("#text-toolbar");
    switch(
      p.find("#text-colorpicker").spectrum("set", item.text.color),
      // p.find("#text-colorpicker").colorpicker("value", item.text.color),
      // p.find("#text-bg-colorpicker").colorpicker("value", item.text.bg_color),
      $("#text-size").val(item.text.size).trigger('change.select2'),
      p.find("#text-font").removeClass(p.find("#text-font").text().replace(/\s+/g, '-').toLowerCase() + "-font"),
      p.find("#text-font").text(item.text.font),
      p.find("#text-font").addClass(item.text.font.replace(/\s+/g, '-').toLowerCase() + "-font"),
      item.text.bold ? p.find("#text-bold").addClass("active") : p.find("#text-bold").removeClass("active"),
      item.text.italic ? p.find("#text-italic").addClass("active") : p.find("#text-italic").removeClass("active"),
      item.text.underlined ? p.find("#text-underlined").addClass("active") : p.find("#text-underlined").removeClass("active"),
      p.find("#text-align-left, #text-align-center, #text-align-right").removeClass("active"),
    item.text.align) {
      case "left":
        p.find("#text-align-left").addClass("active");
        break;
      case "center":
        p.find("#text-align-center").addClass("active");
        break;
      case "right":
        p.find("#text-align-right").addClass("active");
    }
    if(item.text.size) {
      var thisTextSize = parseFloat(item.text.size);
      if (_.contains(fontSizes, thisTextSize)) {} else {
        fontSizes.splice(sortedIndex(fontSizes, thisTextSize), 0, thisTextSize);
        $('#text-size').refreshDataSelect2(fontSizes, 14);
        $('#text-size').find("option[value='" + thisTextSize + "']").prop("selected", "selected");
      }
    }
    var tf = $("#text-field-toolbar");
    var fs = $("#text-field-properties");
    tf.find("#text-field-colorpicker").spectrum("set", item.text_field.color);
    if(item.text_field.back_color == "NONE") {
      fs.find("#text-field-back-colorpicker").spectrum("set", "");
    } else {
      fs.find("#text-field-back-colorpicker").spectrum("set", item.text_field.back_color);
    }
    if(item.text_field.border_color== "NONE") {
      fs.find("#text-field-border-colorpicker").spectrum("set", "");
    } else {
      fs.find("#text-field-border-colorpicker").spectrum("set", item.text_field.border_color);
    }
    if(item.text_field.size) {
      var thisFontSize = parseFloat(item.text_field.size);
      if (parseInt(thisFontSize) == 0) {
        thisFontSize = "auto";
      }
      $("#text-field-size").val(thisFontSize).trigger('change.select2');
      if (_.contains(textFieldFontSizes, thisFontSize)) {} else {
        textFieldFontSizes.splice(sortedIndex(textFieldFontSizes, thisFontSize), 0, thisFontSize);
        $('#text-field-size').refreshDataSelect2(textFieldFontSizes, 14);
        $('#text-field-size').find("option[value='" + thisFontSize + "']").prop("selected", "selected");
      }
    } else {
      $("#text-field-size").val("auto").trigger('change.select2');
    }
    tf.find("#text-field-font").removeClass(tf.find("#text-field-font").text().replace(/\s+/g, '-').toLowerCase() + "-font");
    tf.find("#text-field-font").text(item.text_field.font);
    tf.find("#text-field-font").addClass(item.text_field.font.replace(/\s+/g, '-').toLowerCase() + "-font");
    item.text_field.bold ? tf.find("#text-field-bold").addClass("active") : tf.find("#text-field-bold").removeClass("active");
    item.text_field.italic ? tf.find("#text-field-italic").addClass("active") : tf.find("#text-field-italic").removeClass("active");
    // item.text_field.underlined ? tf.find("#text-field-underlined").addClass("active") : tf.find("#text-field-underlined").removeClass("active");
    tf.find("#text-field-align-left, #text-field-align-center, #text-field-align-right").removeClass("active");
    switch (item.text_field.align) {
      case "left":
        tf.find("#text-field-align-left").addClass("active");
        break;
      case "center":
        tf.find("#text-field-align-center").addClass("active");
        break;
      case "right":
        tf.find("#text-field-align-right").addClass("active");
    }
    fs.find("#text-field-border-width").val(item.text_field.border_width);
    fs.find("#text-field-required").prop('checked', item.text_field.required);
    fs.find("#text-field-comb").prop('checked', item.text_field.comb);
    if(parseInt(item.text_field.max_len) != 0) {
      fs.find("#text-field-maxlength").val(item.text_field.max_len);
    } else{
      fs.find("#text-field-maxlength").val("");
    }
    fs.find("#text-field-placeholder").val(item.text_field.default);
    fs.find("#text-field-name").val(item.text_field.field_name);
    var df = $("#date-field-toolbar");
    var ds = $("#date-field-properties");
    df.find("#date-field-colorpicker").spectrum("set", item.date_field.color);
    if(item.date_field.back_color == "NONE") {
      ds.find("#date-field-back-colorpicker").spectrum("set", "");
    } else {
      ds.find("#date-field-back-colorpicker").spectrum("set", item.date_field.back_color);
    }
    if(item.date_field.border_color== "NONE") {
      ds.find("#date-field-border-colorpicker").spectrum("set", "");
    } else {
      ds.find("#date-field-border-colorpicker").spectrum("set", item.date_field.border_color);
    }
    if(item.date_field.size) {
      var thisFontSize = parseFloat(item.date_field.size);
      if (parseInt(thisFontSize) == 0) {
        thisFontSize = "auto";
      }
      $("#date-field-size").val(thisFontSize).trigger('change.select2');
      if (_.contains(dateFieldFontSizes, thisFontSize)) {} else {
        dateFieldFontSizes.splice(sortedIndex(dateFieldFontSizes, thisFontSize), 0, thisFontSize);
        $('#date-field-size').refreshDataSelect2(dateFieldFontSizes, 14);
        $('#date-field-size').find("option[value='" + thisFontSize + "']").prop("selected", "selected");
      }
    } else {
      $("#date-field-size").val("auto").trigger('change.select2');
    }
    df.find("#date-field-font").removeClass(df.find("#date-field-font").text().replace(/\s+/g, '-').toLowerCase() + "-font");
    df.find("#date-field-font").text(item.date_field.font);
    df.find("#date-field-font").addClass(item.date_field.font.replace(/\s+/g, '-').toLowerCase() + "-font");
    item.date_field.bold ? df.find("#date-field-bold").addClass("active") : df.find("#date-field-bold").removeClass("active");
    item.date_field.italic ? df.find("#date-field-italic").addClass("active") : df.find("#date-field-italic").removeClass("active");
    df.find("#date-field-align-left, #date-field-align-center, #date-field-align-right").removeClass("active");
    switch (item.date_field.align) {
      case "left":
        df.find("#date-field-align-left").addClass("active");
        break;
      case "center":
        df.find("#date-field-align-center").addClass("active");
        break;
      case "right":
        df.find("#date-field-align-right").addClass("active");
    }
    ds.find("#date-field-border-width").val(item.date_field.border_width);
    ds.find("#date-field-required").prop('checked', item.date_field.required);
    ds.find("#date-field-name").val(item.date_field.field_name);
    var dateFormat = item.date_field.format;
    if(dateFormat){
      $("#date-field-format").val(dateFormat).trigger('change.select2');
      if (_.contains(dateFieldFormats, dateFormat)) {} else {
        dateFieldFormats.push(dateFormat);
        $('#date-field-format').refreshDataSelect2(dateFieldFormats, "M/D/YY");
        $('#date-field-format').find("option[value='" + dateFormat + "']").prop("selected", "selected");
      }
      $("#today-format").text(moment().format(dateFormat));
    } else {
      $("#date-field-format").val("M/D/YY").trigger('change.select2');
      $("#today-format").text(moment().format("M/D/YY"));
    }
    // var sf = $("#sig-field-toolbar");
    var sfp = $("#sig-field-properties");
    // sf.find("#sig-field-colorpicker").spectrum("set", item.sig_field.color);
    // sf.find("#sig-field-size").val(item.sig_field.size).trigger('change.select2');
    sfp.find("#sig-field-required").prop('checked', item.sig_field.required);
    sfp.find("#sig-field-name").val(item.sig_field.field_name);
    if(item.sig_field.back_color == "NONE") {
      sfp.find("#sig-field-back-colorpicker").spectrum("set", "");
    } else {
      sfp.find("#sig-field-back-colorpicker").spectrum("set", item.sig_field.back_color);
    }
    if(item.sig_field.border_color == "NONE") {
      sfp.find("#sig-field-border-colorpicker").spectrum("set", "");
    } else {
      sfp.find("#sig-field-border-colorpicker").spectrum("set", item.sig_field.border_color);
    }
    sfp.find("#sig-field-border-width").val(item.sig_field.border_width);
    if (_.contains(["text", "drawing", "image", "path"], item.sig_field.content_type)) {
      sfp.find("#sig-field-clear").show();
    } else {
      sfp.find("#sig-field-clear").hide();
    }
    var cf = $("#check-field-toolbar");
    var cfp = $("#check-field-properties");
    cf.find("#check-field-colorpicker").spectrum("set", item.check_field.color);
    if(item.check_field.back_color == "NONE") {
      cfp.find("#check-field-back-colorpicker").spectrum("set", "");
    } else {
      cfp.find("#check-field-back-colorpicker").spectrum("set", item.check_field.back_color);
    }
    if(item.check_field.border_color == "NONE") {
      cfp.find("#check-field-border-colorpicker").spectrum("set", "");
    } else {
      cfp.find("#check-field-border-colorpicker").spectrum("set", item.check_field.border_color);
    }
    cf.find("#check-field-char").text(item.check_field.char);
    if(item.check_field.size) {
      var thisFontSize = parseFloat(item.check_field.size);
      if (parseInt(thisFontSize) == 0) {
        thisFontSize = "auto";
      }
      $("#check-field-size").val(thisFontSize).trigger('change.select2');
      if (_.contains(checkFieldFontSizes, thisFontSize)) {} else {
        checkFieldFontSizes.splice(sortedIndex(checkFieldFontSizes, thisFontSize), 0, thisFontSize);
        $('#check-field-size').refreshDataSelect2(checkFieldFontSizes, 14);
        $('#check-field-size').find("option[value='" + thisFontSize + "']").prop("selected", "selected");
      }
    } else {
      $("#check-field-size").val("auto").trigger('change.select2');
    }
    cfp.find("#check-field-border-width").val(item.check_field.border_width);
    cfp.find("#check-field-required").prop('checked', item.check_field.required);
    cfp.find("#check-field-export").val(item.check_field.export);
    cfp.find("#check-field-group").val(item.check_field.field_group);
    cfp.find("#radio-field-export").val(item.check_field.export);
    cfp.find("#check-field-name").val(item.check_field.field_name);
    var cbf = $("#combo-field-toolbar");
    var cbs = $("#combo-field-properties");
    tf.find("#combo-field-colorpicker").spectrum("set", item.combo_field.color);
    if(item.combo_field.back_color == "NONE") {
      fs.find("#combo-field-back-colorpicker").spectrum("set", "");
    } else {
      fs.find("#combo-field-back-colorpicker").spectrum("set", item.combo_field.back_color);
    }
    if(item.combo_field.border_color== "NONE") {
      fs.find("#combo-field-border-colorpicker").spectrum("set", "");
    } else {
      fs.find("#combo-field-border-colorpicker").spectrum("set", item.combo_field.border_color);
    }
    if(item.combo_field.size) {
      var thisFontSize = parseFloat(item.combo_field.size);
      if (parseInt(thisFontSize) == 0) {
        thisFontSize = "auto";
      }
      $("#combo-field-size").val(thisFontSize).trigger('change.select2');
      if (_.contains(comboFieldFontSizes, thisFontSize)) {} else {
        comboFieldFontSizes.splice(sortedIndex(comboFieldFontSizes, thisFontSize), 0, thisFontSize);
        $('#combo-field-size').refreshDataSelect2(comboFieldFontSizes, 14);
        $('#combo-field-size').find("option[value='" + thisFontSize + "']").prop("selected", "selected");
      }
    } else {
      $("#combo-field-size").val("auto").trigger('change.select2');
    }
    tf.find("#combo-field-font").removeClass(tf.find("#combo-field-font").text().replace(/\s+/g, '-').toLowerCase() + "-font");
    tf.find("#combo-field-font").text(item.combo_field.font);
    tf.find("#combo-field-font").addClass(item.combo_field.font.replace(/\s+/g, '-').toLowerCase() + "-font");
    item.combo_field.bold ? tf.find("#combo-field-bold").addClass("active") : tf.find("#combo-field-bold").removeClass("active");
    item.combo_field.italic ? tf.find("#combo-field-italic").addClass("active") : tf.find("#combo-field-italic").removeClass("active");
    tf.find("#combo-field-align-left, #combo-field-align-center, #combo-field-align-right").removeClass("active");
    switch (item.combo_field.align) {
      case "left":
        tf.find("#combo-field-align-left").addClass("active");
        break;
      case "center":
        tf.find("#combo-field-align-center").addClass("active");
        break;
      case "right":
        tf.find("#combo-field-align-right").addClass("active");
    }
    fs.find("#combo-field-border-width").val(item.combo_field.border_width);
    fs.find("#combo-field-required").prop('checked', item.combo_field.required);
    fs.find("#combo-field-name").val(item.combo_field.field_name);
    if (item.combo_field.pro) {
      $("#new-surface").activeEditor("refreshChoices");
      fs.find("#combo-field-edit").prop('checked', item.combo_field.allow_edit);
      fs.find("#combo-field-multiple").prop('checked', item.combo_field.multi_select);
      fs.find("#combo-field-sort").prop('checked', item.combo_field.sorted);
      fs.find("#combo-field-empty").prop('checked', item.combo_field.allow_empty);
      // item.combo_field.allow_empty ? fs.find("#combo-field-reset").show() : fs.find("#combo-field-reset").hide();
    }
    var collection = $("#path-toolbar");
    // collection.find("#path-colorpicker").colorpicker("value", item.path.stroke_color);
    collection.find("#path-colorpicker").spectrum("set", item.path.stroke_color);
    collection.find("#path-width").val(item.path.stroke_width);
    var $eraseTool = $("#erase-toolbar");
    $eraseTool.find("#erase-colorpicker").spectrum("set", item.erase.fill_color);
    var $highlightTool = $("#highlight-toolbar");
    $highlightTool.find("#highlight-colorpicker").spectrum("set", item.highlight.fill_color);
    var $linkTool = $("#hyperlink-toolbar");
    if(item.hyperlink.stroke_color == "NONE") {
      $linkTool.find("#hyperlink-colorpicker").spectrum("set", "");
    } else {
      $linkTool.find("#hyperlink-colorpicker").spectrum("set", item.hyperlink.stroke_color);
    }
    $linkTool.find("#hyperlink-stroke-width").val(item.hyperlink.stroke_width);
    var $sigTool = $("#signature-toolbar");
    $sigTool.find("#signature-colorpicker").spectrum("set", item.signature.color);
    $("#signature-size").val(item.signature.size).trigger('change.select2');
    var $e = $("#shape-toolbar");
    // $e.find("#shape-fill-colorpicker").colorpicker("value", item.shape.fill_color);
    if(item.shape.fill_color == "NONE") {
      $e.find("#shape-fill-colorpicker").spectrum("set", "");
    } else {
      $e.find("#shape-fill-colorpicker").spectrum("set", item.shape.fill_color);
    }
    if(item.shape.stroke_color == "NONE") {
      $e.find("#shape-stroke-colorpicker").spectrum("set", "");
    } else {
      $e.find("#shape-stroke-colorpicker").spectrum("set", item.shape.stroke_color);
    }
    $e.find("#shape-stroke-width").val(item.shape.stroke_width);
    var $page = $("#symbol-toolbar");
    // $page.find("#symbol-colorpicker").colorpicker("value", item.symbol.color);
    $page.find("#symbol-colorpicker").spectrum("set", item.symbol.color);
    var fileSize = item.symbol.size;
    switch(fileSize) {
      case 14:
        /** @@type {number} */
        size = 1;
        break;
      case 18:
        /** @@type {number} */
        size = 2;
        break;
      case 24:
        /** @@type {number} */
        size = 3;
        break;
      case 32:
        /** @@type {number} */
        size = 4;
        break;
      case 40:
        /** @@type {number} */
        size = 5;
        break;
      case 48:
        /** @@type {number} */
        size = 6;
        break;
      case 64:
        /** @@type {number} */
        size = 7;
        break;
      case 96:
        /** @@type {number} */
        size = 8;
    }
    $page.find("#symbol-size-select").val(size);
  }

  function updateToolbar(result) {
    var item = result.tool_settings;
    var toolType = result.tool_type;
    switch(toolType) {
      case "TEXT":
        var p = $("#text-toolbar");
        switch(
          p.find("#text-colorpicker").spectrum("set", item.text.color),
          // p.find("#text-colorpicker").colorpicker("value", item.text.color),
          // p.find("#text-bg-colorpicker").colorpicker("value", item.text.bg_color),
          $("#text-size").val(item.text.size).trigger('change.select2'),
          p.find("#text-font").removeClass(p.find("#text-font").text().replace(/\s+/g, '-').toLowerCase() + "-font"),
          p.find("#text-font").text(item.text.font),
          p.find("#text-font").addClass(item.text.font.replace(/\s+/g, '-').toLowerCase() + "-font"),
          item.text.bold ? p.find("#text-bold").addClass("active") : p.find("#text-bold").removeClass("active"),
          item.text.italic ? p.find("#text-italic").addClass("active") : p.find("#text-italic").removeClass("active"),
          item.text.underlined ? p.find("#text-underlined").addClass("active") : p.find("#text-underlined").removeClass("active"),
          p.find("#text-align-left, #text-align-center, #text-align-right").removeClass("active"),
        item.text.align) {
          case "left":
            p.find("#text-align-left").addClass("active");
            break;
          case "center":
            p.find("#text-align-center").addClass("active");
            break;
          case "right":
            p.find("#text-align-right").addClass("active");
        }
        if(item.text.size) {
          var thisTextSize = parseFloat(item.text.size);
          if (_.contains(fontSizes, thisTextSize)) {} else {
            fontSizes.splice(sortedIndex(fontSizes, thisTextSize), 0, thisTextSize);
            $('#text-size').refreshDataSelect2(fontSizes, 14);
            $('#text-size').find("option[value='" + thisTextSize + "']").prop("selected", "selected");
          }
        }
        break;
      case "TEXT_FIELD":
      case "PARAGRAPH_FIELD":
        var fs = $("#text-field-properties");
        $("#text-field-prop").show();
        $("#check-field-prop").hide();
        $("#sig-field-prop").hide();
        $("#date-field-prop").hide();
        $("#combo-field-prop").hide();
        var tf = $("#text-field-toolbar");
        tf.find("#text-field-colorpicker").spectrum("set", item.text_field.color);
        if(item.text_field.back_color == "NONE") {
          fs.find("#text-field-back-colorpicker").spectrum("set", "");
        } else {
          fs.find("#text-field-back-colorpicker").spectrum("set", item.text_field.back_color);
        }
        if(item.text_field.border_color== "NONE") {
          fs.find("#text-field-border-colorpicker").spectrum("set", "");
        } else {
          fs.find("#text-field-border-colorpicker").spectrum("set", item.text_field.border_color);
        }
        if(item.text_field.size) {
          var thisFontSize = parseFloat(item.text_field.size);
          if (parseInt(thisFontSize) == 0) {
            thisFontSize = "auto";
          }
          $("#text-field-size").val(thisFontSize).trigger('change.select2');
          if (_.contains(textFieldFontSizes, thisFontSize)) {} else {
            textFieldFontSizes.splice(sortedIndex(textFieldFontSizes, thisFontSize), 0, thisFontSize);
            $('#text-field-size').refreshDataSelect2(textFieldFontSizes, 14);
            $('#text-field-size').find("option[value='" + thisFontSize + "']").prop("selected", "selected");
          }
        } else {
          $("#text-field-size").val("auto").trigger('change.select2');
        }
        tf.find("#text-field-font").removeClass(tf.find("#text-field-font").text().replace(/\s+/g, '-').toLowerCase() + "-font");
        tf.find("#text-field-font").text(item.text_field.font);
        tf.find("#text-field-font").addClass(item.text_field.font.replace(/\s+/g, '-').toLowerCase() + "-font");
        item.text_field.bold ? tf.find("#text-field-bold").addClass("active") : tf.find("#text-field-bold").removeClass("active");
        item.text_field.italic ? tf.find("#text-field-italic").addClass("active") : tf.find("#text-field-italic").removeClass("active");
        tf.find("#text-field-align-left, #text-field-align-center, #text-field-align-right").removeClass("active");
        switch (item.text_field.align) {
          case "left":
            tf.find("#text-field-align-left").addClass("active");
            break;
          case "center":
            tf.find("#text-field-align-center").addClass("active");
            break;
          case "right":
            tf.find("#text-field-align-right").addClass("active");
        }
        fs.find("#text-field-border-width").val(item.text_field.border_width);
        fs.find("#text-field-required").prop('checked', item.text_field.required);
        fs.find("#text-field-comb").prop('checked', item.text_field.comb);
        if(parseInt(item.text_field.max_len) != 0) {
          fs.find("#text-field-maxlength").val(item.text_field.max_len);
        } else{
          fs.find("#text-field-maxlength").val("");
        }
        fs.find("#text-field-placeholder").val(item.text_field.default);
        fs.find("#text-field-name").val(item.text_field.field_name);
        if (item.text_field.pro) {
          fs.find("#text-field-name").prop("disabled", false);
        } else {
          fs.find("#text-field-name").prop("disabled", true);
        }
        break;
      case "SIG_FIELD":
      case "INITIALS_FIELD":
        // var sf = $("#sig-field-toolbar");
        var fs = $("#sig-field-properties");
        $("#text-field-prop").hide();
        $("#check-field-prop").hide();
        $("#date-field-prop").hide();
        $("#sig-field-prop").show();
        $("#combo-field-prop").hide();
        fs.find("#sig-field-required").prop('checked', item.sig_field.required);
        fs.find("#sig-field-name").val(item.sig_field.field_name);
        if (item.sig_field.pro) {
          fs.find("#sig-field-name").prop("disabled", false);
          // if (!["image", "path"].includes(item.sig_field.content_type)) {
          //   sf.find("#sig-field-size").val(item.sig_field.size).trigger('change.select2');
          // }
        } else {
          fs.find("#sig-field-name").prop("disabled", true);
        }
        // sf.find("#sig-field-colorpicker").spectrum("set", item.sig_field.color);
        if(item.sig_field.back_color == "NONE") {
          fs.find("#sig-field-back-colorpicker").spectrum("set", "");
        } else {
          fs.find("#sig-field-back-colorpicker").spectrum("set", item.sig_field.back_color);
        }
        if(item.sig_field.border_color== "NONE") {
          fs.find("#sig-field-border-colorpicker").spectrum("set", "");
        } else {
          fs.find("#sig-field-border-colorpicker").spectrum("set", item.sig_field.border_color);
        }
        fs.find("#sig-field-border-width").val(item.sig_field.border_width);
        if (_.contains(["text", "drawing", "image", "path"], item.sig_field.content_type)) {
          fs.find("#sig-field-clear").show();
        } else {
          fs.find("#sig-field-clear").hide();
        }
        break;
      case "DATE_FIELD":
        var fs = $("#date-field-properties");
        $("#text-field-prop").hide();
        $("#check-field-prop").hide();
        $("#sig-field-prop").hide();
        $("#date-field-prop").show();
        $("#combo-field-prop").hide();
        var tf = $("#date-field-toolbar");
        tf.find("#date-field-colorpicker").spectrum("set", item.date_field.color);
        if(item.date_field.back_color == "NONE") {
          fs.find("#date-field-back-colorpicker").spectrum("set", "");
        } else {
          fs.find("#date-field-back-colorpicker").spectrum("set", item.date_field.back_color);
        }
        if(item.date_field.border_color== "NONE") {
          fs.find("#date-field-border-colorpicker").spectrum("set", "");
        } else {
          fs.find("#date-field-border-colorpicker").spectrum("set", item.date_field.border_color);
        }
        if(item.date_field.size) {
          var thisFontSize = parseFloat(item.date_field.size);
          if (parseInt(thisFontSize) == 0) {
            thisFontSize = "auto";
          }
          $("#date-field-size").val(thisFontSize).trigger('change.select2');
          if (_.contains(dateFieldFontSizes, thisFontSize)) {} else {
            dateFieldFontSizes.splice(sortedIndex(dateFieldFontSizes, thisFontSize), 0, thisFontSize);
            $('#date-field-size').refreshDataSelect2(dateFieldFontSizes, 14);
            $('#date-field-size').find("option[value='" + thisFontSize + "']").prop("selected", "selected");
          }
        } else {
          $("#date-field-size").val("auto").trigger('change.select2');
        }
        tf.find("#date-field-font").removeClass(tf.find("#date-field-font").text().replace(/\s+/g, '-').toLowerCase() + "-font");
        tf.find("#date-field-font").text(item.date_field.font);
        tf.find("#date-field-font").addClass(item.date_field.font.replace(/\s+/g, '-').toLowerCase() + "-font");
        item.date_field.bold ? tf.find("#date-field-bold").addClass("active") : tf.find("#date-field-bold").removeClass("active");
        item.date_field.italic ? tf.find("#date-field-italic").addClass("active") : tf.find("#date-field-italic").removeClass("active");
        tf.find("#date-field-align-left, #date-field-align-center, #date-field-align-right").removeClass("active");
        switch (item.date_field.align) {
          case "left":
            tf.find("#date-field-align-left").addClass("active");
            break;
          case "center":
            tf.find("#date-field-align-center").addClass("active");
            break;
          case "right":
            tf.find("#date-field-align-right").addClass("active");
        }
        fs.find("#date-field-border-width").val(item.date_field.border_width);
        fs.find("#date-field-required").prop('checked', item.date_field.required);
        fs.find("#date-field-name").val(item.date_field.field_name);
        var dateFormat = item.date_field.format;
        if(dateFormat){
          $("#date-field-format").val(dateFormat).trigger('change.select2');
          if (_.contains(dateFieldFormats, dateFormat)) {} else {
            dateFieldFormats.push(dateFormat);
            $('#date-field-format').refreshDataSelect2(dateFieldFormats, "M/D/YY");
            $('#date-field-format').find("option[value='" + dateFormat + "']").prop("selected", "selected");
          }
          $("#today-format").text(moment().format(dateFormat));
        } else {
          $("#date-field-format").val("M/D/YY").trigger('change.select2');
          $("#today-format").text(moment().format("M/D/YY"));
        }
        if (item.date_field.pro) {
          fs.find("#date-field-name").prop("disabled", false);
        } else {
          fs.find("#date-field-name").prop("disabled", true);
        }
        break;
      case "CHECK_FIELD":
      case "RADIO_FIELD":
        var fs = $("#check-field-properties");
        $("#check-field-prop").show();
        $("#text-field-prop").hide();
        $("#date-field-prop").hide();
        $("#sig-field-prop").hide();
        $("#combo-field-prop").hide();
        var tf = $("#check-field-toolbar");
        tf.find("#check-field-colorpicker").spectrum("set", item.check_field.color);
        if(item.check_field.back_color == "NONE") {
          fs.find("#check-field-back-colorpicker").spectrum("set", "");
        } else {
          fs.find("#check-field-back-colorpicker").spectrum("set", item.check_field.back_color);
        }
        if(item.check_field.border_color== "NONE") {
          fs.find("#check-field-border-colorpicker").spectrum("set", "");
        } else {
          fs.find("#check-field-border-colorpicker").spectrum("set", item.check_field.border_color);
        }
        if(item.check_field.size) {
          var thisFontSize = parseFloat(item.check_field.size);
          if (parseInt(thisFontSize) == 0) {
            thisFontSize = "auto";
          }
          $("#check-field-size").val(thisFontSize).trigger('change.select2');
          if (_.contains(checkFieldFontSizes, thisFontSize)) {} else {
            checkFieldFontSizes.splice(sortedIndex(checkFieldFontSizes, thisFontSize), 0, thisFontSize);
            $('#check-field-size').refreshDataSelect2(checkFieldFontSizes, 14);
            $('#check-field-size').find("option[value='" + thisFontSize + "']").prop("selected", "selected");
          }
        } else {
          $("#check-field-size").val("auto").trigger('change.select2');
        }
        tf.find("#check-field-char").text(item.check_field.char);
        fs.find("#check-field-border-width").val(item.check_field.border_width);
        fs.find("#check-field-required").prop('checked', item.check_field.required);
        fs.find("#check-field-export").val(item.check_field.export);
        fs.find("#check-field-group").val(item.check_field.field_group);
        fs.find("#radio-field-export").val(item.check_field.export);
        fs.find("#check-field-name").val(item.check_field.field_name);
        if (item.check_field.pro) {
          fs.find("#check-field-name").prop("disabled", false);
          fs.find("#check-field-group").prop("disabled", false);
          fs.find("#check-field-export").prop("disabled", false);
        } else {
          fs.find("#check-field-name").prop("disabled", true);
          fs.find("#check-field-group").prop("disabled", true);
          fs.find("#check-field-export").prop("disabled", true);
        }
        break;
      case "COMBO_FIELD":
      case "LIST_FIELD":
        var fs = $("#combo-field-properties");
        $("#combo-field-prop").show();
        $("#text-field-prop").hide();
        $("#check-field-prop").hide();
        $("#sig-field-prop").hide();
        $("#date-field-prop").hide();
        var tf = $("#combo-field-toolbar");
        tf.find("#combo-field-colorpicker").spectrum("set", item.combo_field.color);
        if(item.combo_field.back_color == "NONE") {
          fs.find("#combo-field-back-colorpicker").spectrum("set", "");
        } else {
          fs.find("#combo-field-back-colorpicker").spectrum("set", item.combo_field.back_color);
        }
        if(item.combo_field.border_color== "NONE") {
          fs.find("#combo-field-border-colorpicker").spectrum("set", "");
        } else {
          fs.find("#combo-field-border-colorpicker").spectrum("set", item.combo_field.border_color);
        }
        if(item.combo_field.size) {
          var thisFontSize = parseFloat(item.combo_field.size);
          if (parseInt(thisFontSize) == 0) {
            thisFontSize = "auto";
          }
          $("#combo-field-size").val(thisFontSize).trigger('change.select2');
          if (_.contains(comboFieldFontSizes, thisFontSize)) {} else {
            comboFieldFontSizes.splice(sortedIndex(comboFieldFontSizes, thisFontSize), 0, thisFontSize);
            $('#combo-field-size').refreshDataSelect2(comboFieldFontSizes, 14);
            $('#combo-field-size').find("option[value='" + thisFontSize + "']").prop("selected", "selected");
          }
        } else {
          $("#combo-field-size").val("auto").trigger('change.select2');
        }
        tf.find("#combo-field-font").removeClass(tf.find("#combo-field-font").text().replace(/\s+/g, '-').toLowerCase() + "-font");
        tf.find("#combo-field-font").text(item.combo_field.font);
        tf.find("#combo-field-font").addClass(item.combo_field.font.replace(/\s+/g, '-').toLowerCase() + "-font");
        item.combo_field.bold ? tf.find("#combo-field-bold").addClass("active") : tf.find("#combo-field-bold").removeClass("active");
        item.combo_field.italic ? tf.find("#combo-field-italic").addClass("active") : tf.find("#combo-field-italic").removeClass("active");
        tf.find("#combo-field-align-left, #combo-field-align-center, #combo-field-align-right").removeClass("active");
        switch (item.combo_field.align) {
          case "left":
            tf.find("#combo-field-align-left").addClass("active");
            break;
          case "center":
            tf.find("#combo-field-align-center").addClass("active");
            break;
          case "right":
            tf.find("#combo-field-align-right").addClass("active");
        }
        fs.find("#combo-field-border-width").val(item.combo_field.border_width);
        fs.find("#combo-field-required").prop('checked', item.combo_field.required);
        fs.find("#combo-field-name").val(item.combo_field.field_name);
        if (item.combo_field.pro) {
          fs.find("#combo-field-name").prop("disabled", false);
          $("#new-surface").activeEditor("refreshChoices");
          fs.find("#combo-field-edit").prop('checked', item.combo_field.allow_edit);
          fs.find("#combo-field-multiple").prop('checked', item.combo_field.multi_select);
          fs.find("#combo-field-sort").prop('checked', item.combo_field.sorted);
          fs.find("#combo-field-empty").prop('checked', item.combo_field.allow_empty);
          // item.combo_field.allow_empty ? fs.find("#combo-field-reset").show() : fs.find("#combo-field-reset").hide();
        } else {
          fs.find("#combo-field-name").prop("disabled", true);
        }
        break;
      case "PATH":
        var collection = $("#path-toolbar");
        collection.find("#path-colorpicker").spectrum("set", item.path.stroke_color);
        collection.find("#path-width").val(item.path.stroke_width);
        break;
      case "WHITEOUT_BLOCK":
        var $eraseTool = $("#erase-toolbar");
        $eraseTool.find("#erase-colorpicker").spectrum("set", item.erase.fill_color);
        break;
      case "HIGHLIGHT_BLOCK":
        var $highlightTool = $("#highlight-toolbar");
        $highlightTool.find("#highlight-colorpicker").spectrum("set", item.highlight.fill_color);
        break;
      case "HYPERLINK":
        var $linkTool = $("#hyperlink-toolbar");
        if(item.hyperlink.stroke_color == "NONE") {
          $linkTool.find("#hyperlink-colorpicker").spectrum("set", "");
        } else {
          $linkTool.find("#hyperlink-colorpicker").spectrum("set", item.hyperlink.stroke_color);
        }
        $linkTool.find("#hyperlink-stroke-width").val(item.hyperlink.stroke_width);
        break;
      case "SIGNATURE":
        var $sigTool = $("#signature-toolbar");
        $sigTool.find("#signature-colorpicker").spectrum("set", item.signature.color);
        $("#signature-size").val(item.signature.size).trigger('change.select2');
        break;
      case "HORI_LINE":
      case "VERT_LINE":
      case "RECTANGLE":
      case "ELLIPSE":
      case "LINE":
        var $e = $("#shape-toolbar");
        if(item.shape.fill_color == "NONE") {
          $e.find("#shape-fill-colorpicker").spectrum("set", "");
        } else {
          $e.find("#shape-fill-colorpicker").spectrum("set", item.shape.fill_color);
        }
        if(item.shape.stroke_color == "NONE") {
          $e.find("#shape-stroke-colorpicker").spectrum("set", "");
        } else {
          $e.find("#shape-stroke-colorpicker").spectrum("set", item.shape.stroke_color);
        }
        $e.find("#shape-stroke-width").val(item.shape.stroke_width);
        break;
      case "SYMBOL_CHECKMARK":
      case "SYMBOL_REMOVE":
      case "SYMBOL_ARROW_LEFT":
      case "SYMBOL_ARROW_RIGHT":
      case "SYMBOL_ARROW_UP":
      case "SYMBOL_ARROW_DOWN":
      case "SYMBOL_THUMBS_UP":
      case "SYMBOL_THUMBS_DOWN":
      case "SYMBOL_QUESTION":
      case "SYMBOL_EXCLAMATION":
        var $page = $("#symbol-toolbar");
        $page.find("#symbol-colorpicker").spectrum("set", item.symbol.color);
        var fileSize = item.symbol.size;
        switch(fileSize) {
          case 14:
            size = 1;
            break;
          case 18:
            size = 2;
            break;
          case 24:
            size = 3;
            break;
          case 32:
            size = 4;
            break;
          case 40:
            size = 5;
            break;
          case 48:
            size = 6;
            break;
          case 64:
            size = 7;
            break;
          case 96:
            size = 8;
        }
        $page.find("#symbol-size-select").val(size);
        break;
    }
  }

  function onModeChange(time) {
    switch($(".switch-mode").removeClass("active"), time.mode) {
      case "TRANSFORM":
        $(".switch-mode-transform").addClass("active");
        if(formsEnabled){
          $("#right-side-panel").find("#title-field-type").text("Form Field Order");
          $("#new-surface").activeEditor("refreshPageFields");
          showToolbar("page-fields");
        } else {
          showToolbar("none");
        }
        break;
      case "MULTIPLE":
        $(".switch-mode-multiple").addClass("active");
        $("#right-side-panel").find("#title-field-type").text("Form Field Order");
        $("#new-surface").activeEditor("refreshPageFields");
        showToolbar("multiple");
        break;
      case "DELETE-PAGES":
        $(".switch-mode-delete-pages").addClass("active");
        showToolbar("delete-pages");
        break;
      case "ROTATE":
        $(".switch-mode-rotate").addClass("active");
        showToolbar("rotate");
        break;
      case "REORDER":
        $(".switch-mode-reorder").addClass("active");
        showToolbar("reorder");
        break;
      case "MERGE":
        $(".switch-mode-merge").addClass("active");
        showToolbar("none");
        $("#merge-master").html("<div class=\"col-sm-12 checkout-padding\" id=\"upload-form\">\n  <br>\n  <div style=\"text-align:center;margin:0px 40px 20px;\">\n    <div class=\"drop-box\" style=\"margin: 10px auto 20px;padding: 80px 20px;border: 5px #ccc dashed;max-width: 950px;background-color:#fff;min-height: 300px;\">\n      <div class=\"uploader-div\">\n        <div style=\"font-size:18px;\">Drag &amp; drop your file here to upload<\/div>\n        <div style=\"margin:5px auto 10px;font-style:italic;font-size: 16px;\">or<\/div>\n        <form id=\"s3-uploader\" data-callback-url=\"/input_files\" data-callback-method=\"POST\" data-callback-param=\"file\" enctype=\"multipart/form-data\" action=\"https://s3-eu-west-1.amazonaws.com/create-pdf/\" accept-charset=\"UTF-8\" method=\"post\"><input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" /><input type=\"hidden\" name=\"key\" id=\"key\" value=\"inputs/{unique_id}-fad3c36d/\${filename}\" /><input type=\"hidden\" name=\"acl\" id=\"acl\" value=\"public-read\" /><input type=\"hidden\" name=\"AWSAccessKeyId\" id=\"AWSAccessKeyId\" value=\"AKIAJBG24RZNZSPKQRPA\" /><input type=\"hidden\" name=\"policy\" id=\"policy\" value=\"eyJleHBpcmF0aW9uIjoiMjAyMC0xMC0wMVQyMTowNDo0N1oiLCJjb25kaXRpb25zIjpbWyJzdGFydHMtd2l0aCIsIiR1dGY4IiwiIl0sWyJzdGFydHMtd2l0aCIsIiRrZXkiLCJpbnB1dHMvIl0sWyJzdGFydHMtd2l0aCIsIiR4LXJlcXVlc3RlZC13aXRoIiwiIl0sWyJjb250ZW50LWxlbmd0aC1yYW5nZSIsMCwxMDQ4NTc2MDBdLFsic3RhcnRzLXdpdGgiLCIkY29udGVudC10eXBlIiwiIl0seyJidWNrZXQiOiJjcmVhdGUtcGRmIn0seyJhY2wiOiJwdWJsaWMtcmVhZCJ9LHsic3VjY2Vzc19hY3Rpb25fc3RhdHVzIjoiMjAxIn1dfQ==\" /><input type=\"hidden\" name=\"signature\" id=\"signature\" value=\"FuEmxNUPSBeWR3uYZOyt7em3FZQ=\" /><input type=\"hidden\" name=\"success_action_status\" id=\"success_action_status\" value=\"201\" /><input type=\"hidden\" name=\"X-Requested-With\" id=\"X-Requested-With\" value=\"xhr\" />\n          <div class=\"fileUpload btn btn-success btn-modal\">\n            <span class=\"fas fa-cloud-upload-alt\"><\/span>  <span id=\"upload-file-text\">Upload PDF<\/span>\n            <input type=\"file\" name=\"file\" id=\"uploadBtn\" multiple=\"multiple\" class=\"upload\" />\n          <\/div>\n<\/form>      <\/div>\n      <div id=\"dropbox-div\" style=\"display:none;width: 100%;height: 100px;padding-top: 35px;\">\n        <div class=\"btn btn-modal\" id=\"dropbox-chooser\" style=\"background-color:#7fbf4d;padding: 12px 24px;border-radius: 0px;border: none;color:#fff;\">\n          <i class=\"fab fa-dropbox\" style=\"padding-right:10px;\"><\/i><span id=\"upload-file-text\">Upload from Dropbox<\/span>\n        <\/div>\n      <\/div>\n      <div id=\"gdrive-div\" style=\"display:none;width: 100%;height: 100px;padding-top: 35px;\">\n        <div class=\"btn btn-modal\" id=\"gdrive-chooser\" style=\"background-color:#7fbf4d;padding: 12px 24px;border-radius: 0px;border: none;color:#fff;\">\n          <i class=\"fab fa-google-drive\" style=\"padding-right:10px;\"><\/i><span id=\"upload-file-text\">Upload from Google Drive<\/span>\n        <\/div>\n      <\/div>\n    <\/div>\n    <div id=\"upload-option-btns\" style=\"margin-bottom: 30px;\">\n      <div class=\"btn active upload-option-btn\" id=\"computer-btn\" style=\"margin-right:10px;font-size:26px;\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Upload from computer\">\n        <i class=\"fas fa-upload\"><\/i>\n      <\/div>\n      <div class=\"btn upload-option-btn\" id=\"dropbox-btn\" style=\"margin-right:10px;font-size:26px;\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Upload from Dropbox\">\n        <i class=\"fab fa-dropbox\"><\/i>\n      <\/div>\n      <div class=\"btn upload-option-btn\" id=\"gdrive-btn\" style=\"font-size:26px;\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Upload from Google Drive\">\n        <i class=\"fab fa-google-drive\"><\/i>\n      <\/div>\n    <\/div>\n    <div id=\"cancel-uploader\" class=\"btn btn-default btn-modal\" style=\"color:darkgrey\">Cancel<\/div>\n  <\/div>\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"pdf-upload-process\" style=\"display: none;\">\n  <h4 id=\"upload-progress-status\" style=\"text-align: center;padding-top: 20px;\">Uploading....<\/h4>\n  <div class=\"row\">\n    <div class=\"upload js-progress-bars\" id=\"progress-bar\" class=\"col-md-10 col-md-offset-1\" style=\"border:none;margin: 10px auto;\">\n      <div class=\"progress active\" style=\"height: 20px;border:none;\">\n        <div id=\"upload-job-progress\" class=\"bar progress-bar\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 0%;\"><\/div>\n      <\/div>\n    <\/div>\n  <\/div>\n  <form id=\"merge-info-form\" style=\"text-align:center;\">\n    <div style=\"padding-top: 10px;padding-bottom: 30px;\">\n      <span style=\"font-size:16px;\">Merge this file(s)<\/em><\/span>\n      <select id=\"before-after-select\" name=\"before-after\" style=\"margin-bottom: 0px;vertical-align: initial;\">\n        <option value=\"0\">before<\/option>\n        <option value=\"1\" selected>after<\/option>\n      <\/select>\n      <span style=\"font-size:16px;margin-left:5px;\">page <select id=\"page-number-select\" name=\"page-number\" style=\"margin-bottom: 0px;vertical-align: initial;\"><\/select><\/span>\n    <\/div>\n    <div class=\'btn btn-default\' href=\'#\' id=\"cancel-s3-upload\">Cancel<\/div>\n    <div id=\"confirm-merge-btn\" class=\"btn btn-green\" style=\"display:none;margin-left:20px;font-size:20px;border-radius:4px;\">Merge<\/div>\n  <\/form>\n  <div class=\"row\">\n    <div class=\"col-md-12\" style=\"margin-bottom:1px;\">\n    <\/div>\n  <\/div>\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"merge-loading\" style=\"display: none;\">\n  <div style=\'text-align:center;padding: 35px;\'>\n    <div style=\"font-size:20px;margin-bottom:10px;\"><b>Merging<\/b><\/div>\n    <div><span class=\"fas fa-sync fa-spin fa-4x fa-fw\" style=\"display:inline-block;\"><\/span><\/div>\n  <\/div>\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"upload-error-message\" style=\"display: none;\">\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"merge-error-message\" style=\"display: none;\">\n  <div style=\'text-align:center;padding: 35px;\'>\n    <p>Your files failed to merge. Please try again.<\/p>\n    <div id=\'merge-error-cancel\' class=\'btn btn-default\'>Close<\/div>\n  <\/div>\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"merge-password-error-message\" style=\"display: none;\">\n  <div style=\'text-align:center;padding: 35px;\'>\n    <p>One of your files is password protected. Please remove the password before merging this file.<\/p>\n    <div id=\'merge-password-error-cancel\' class=\'btn btn-default\'>Close<\/div>\n  <\/div>\n<\/div>\n\n<script type=\"text/javascript\">\n  var uploadCancelled = false;\n  var allFilesFinished = {};\n  var uploadPercentage = 0;\n  \$(\'#pdf-upload-process\').hide();\n  \$(\'#upload-error-message\').hide();\n  \$(\'#merge-error-message\').hide();\n  \$(\'#merge-password-error-message\').hide();\n  \$(\'#merge-loading\').hide();\n  var originalProFileId = \"422c78d3265340780c2f\";\n  var inputFileHash;\n  var allowedChars = /^[A-Za-z0-9.\\-+\\(\\)\\_\\[\\]\\s]+\$/;\n  var multiselect = true;\n  var filetypes = [\'.pdf\'];\n\n  \$(\"#computer-btn\").on(\'click\', function() {\n    \$(\".upload-option-btn\").removeClass(\"active\");\n    \$(\"#computer-btn\").addClass(\"active\");\n    \$(\"#dropbox-div\").hide();\n    \$(\"#gdrive-div\").hide();\n    \$(\".uploader-div\").show();\n  });\n\n  \$(\"#dropbox-btn\").on(\'click\', function() {\n    \$(\".upload-option-btn\").removeClass(\"active\");\n    \$(\"#dropbox-btn\").addClass(\"active\");\n    \$(\".uploader-div\").hide();\n    \$(\"#gdrive-div\").hide();\n    \$(\"#dropbox-div\").show();\n  });\n\n  \$(\"#gdrive-btn\").on(\'click\', function() {\n    \$(\".upload-option-btn\").removeClass(\"active\");\n    \$(\"#gdrive-btn\").addClass(\"active\");\n    \$(\".uploader-div\").hide();\n    \$(\"#dropbox-div\").hide();\n    \$(\"#gdrive-div\").show();\n  });\n\n  \$(function () {\n    \$(\'.upload-option-btn\').tooltip();\n  });\n\n  queryForUpload = function(job_id, random_id) {\n    \$.ajax({\n      url: \"/input_files/\" + job_id + \"/upload_percentage\",\n      type: \"GET\",\n      dataType: \"json\"\n    }).success(function(data) {\n      if (data[\'percentage_done\'] == 100) {\n        allFilesFinished[random_id] = true;\n        var allTrue = true;\n        for(var fileId in allFilesFinished) {\n          if(!allFilesFinished[fileId])  {\n            allTrue = false;\n            break;\n          }\n        }\n        var input_job_id = data[\'unique_id\'];\n        var input_job_url = data[\'url\'];\n        if (allTrue) {\n          \$(\'.bar\').attr(\'style\', \'width: 100%;\');\n          inputFileHash[input_job_id] = input_job_url;\n          \$(\"#confirm-merge-btn\").show();\n        } else {\n          inputFileHash[input_job_id] = input_job_url;\n          uploadPercentage = uploadPercentage + ((100 - uploadPercentage)/2);\n          var thisStyle = \'width: \' + uploadPercentage + \'%;\';\n          \$(\'.bar\').attr(\'style\', thisStyle);\n        }\n      } else if (data[\'percentage_done\'] == 0) {\n        allFilesFinished[random_id] = true;\n        if (uploadCancelled) {\n          uploadCancelled = false;\n        } else {\n          \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>Your file failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n          \$(\'#pdf-upload-process\').hide();\n          \$(\'#upload-form\').hide();\n          \$(\'#upload-error-message\').show();\n          \$(\'#upload-error-cancel\').on(\'click\', function() {\n            \$(\'#upload-error-message\').hide();\n            \$(\"#confirm-merge-btn\").hide();\n            \$(\'.uploader-div\').show();\n            \$(\".upload-option-btn\").removeClass(\"active\");\n            \$(\"#computer-btn\").addClass(\"active\");\n            \$(\'#upload-form\').show();\n          });\n        };\n      } else {\n        if (uploadCancelled) {\n          allFilesFinished[random_id] = true;\n          uploadCancelled = false;\n        } else {\n          setTimeout(function(){queryForUpload(job_id, random_id)}, 1000);\n        }\n      }\n    }).error(function(data) {\n      allFilesFinished[random_id] = true;\n      if (uploadCancelled) {\n        uploadCancelled = false;\n      } else {\n        \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>Your file failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n        \$(\'#pdf-upload-process\').hide();\n        \$(\'#upload-form\').hide();\n        \$(\'#upload-error-message\').show();\n        \$(\'#upload-error-cancel\').on(\'click\', function() {\n          \$(\'#upload-error-message\').hide();\n          \$(\"#confirm-merge-btn\").hide();\n          \$(\'.uploader-div\').show();\n          \$(\".upload-option-btn\").removeClass(\"active\");\n          \$(\"#computer-btn\").addClass(\"active\");\n          \$(\'#upload-form\').show();\n        });\n      };\n    });\n  };\n\n  \$(\"#dropbox-chooser\").on(\'click\', function(e) {\n    e.preventDefault();\n    Dropbox.choose({\n      success: function(files) {\n        uploadCancelled = false;\n        \$(\"#upload-progress-status\").html(\"Uploading....\");\n        var pageNumberOptions;\n        for (i= 0; i < \$pdfCanvas.PDFViewer(\"pageNumbers\").length; i++) {\n          if (i == (\$pdfCanvas.PDFViewer(\"pageNumbers\").length - 1)) {\n            pageNumberOptions += \"<option value=\" + (i+1) + \" selected>\" + (i+1) + \"<\/option>\"\n          } else {\n            pageNumberOptions += \"<option value=\" + (i+1) + \">\" + (i+1) + \"<\/option>\"\n          }\n        }\n        \$(\"#page-number-select\").html(pageNumberOptions);\n        inputFileHash = {};\n        \$(\'#upload-form\').hide();\n        \$(\'#dropbox-div\').hide();\n        \$(\'#upload-job-progress\').attr(\'style\', \"width: 0%;\");\n        \$(\'#pdf-upload-process\').show();\n        \$.each(files, function(idx, elem){\n          var randomId = Math.uuid(8).toLowerCase();\n          allFilesFinished[randomId] = false;\n          elem[\"randomId\"] = randomId;\n        });\n        \$.each(files, function(idx, elem){\n          \$.ajax({\n            url: \"/input_files/create_from_dropbox\",\n            dataType: \"json\",\n            type: \"POST\",\n            data: {file: elem, pro_file_id: originalProFileId}\n          }).success(function(data) {\n            queryForUpload(data[\'unique_id\'], data[\"random_id\"])\n          }).error(function(data) {\n            allFilesFinished[data[\"unique_id\"]] = true;\n\n            if (uploadCancelled) {\n              uploadCancelled = false;\n            } else {\n              \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>\" + elem[\'name\'] + \" failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n              \$(\'#pdf-upload-process\').hide();\n              \$(\'#upload-form\').hide();\n              \$(\'#upload-error-message\').show();\n              \$(\'#upload-error-cancel\').on(\'click\', function() {\n                \$(\'#upload-error-message\').hide();\n                \$(\"#confirm-merge-btn\").hide();\n                \$(\'#dropbox-div\').show();\n                \$(\'#upload-form\').show();\n              });\n            };\n          });\n        });\n      },\n      linkType: \"direct\",\n      multiselect: multiselect,\n      extensions: filetypes,\n      folderselect: false,\n      sizeLimit: 104900000\n    });\n  });\n\n  var developerKey = \'AIzaSyDJRX64VXFMR4u1mKnzXAYKo52utTQ8co4\';\n  var clientId = \"975217039210-vapghe3a6kiutikrjspehs1579be5vl3.apps.googleusercontent.com\"\n  var pickerApiLoaded = false;\n  var oauthToken;\n  var gdClientInit = false;\n\n  function loadPicker() {\n    gapi.load(\'auth2\');\n    gapi.load(\'picker\');\n    gapi.load(\'client:auth2\');\n  }\n\n  function onAuthApiLoad() {\n    oauthToken = getCookie(\"gdOauthToken\");\n    if (oauthToken) {\n      createPicker();\n    } else {\n      window.gapi.auth2.authorize(\n      {\n        \'client_id\': clientId,\n        \'scope\': \'https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/drive.file\'\n      },\n      handleAuthResult);\n    }\n  }\n\n  function onPickerApiLoad() {\n    pickerApiLoaded = true;\n    createPicker();\n  }\n\n  function handleAuthResult(authResult) {\n    if (authResult && !authResult.error) {\n      var cookieDate = new Date();\n      cookieDate.setTime(cookieDate.getTime() + (2640000));\n      var cookieExpires = \"; expires=\" + cookieDate.toUTCString();\n      document.cookie = \"gdOauthToken=\" + (authResult.access_token || \"\")  + cookieExpires + \"; SameSite=None; path=/;secure\";\n      oauthToken = authResult.access_token;\n      createPicker();\n    }\n  }\n\n  function createPicker() {\n    if (pickerApiLoaded && oauthToken) {\n      var view = new google.picker.View(google.picker.ViewId.DOCS);\n      var picker;\n      if (multiselect) {\n        picker = new google.picker.PickerBuilder().enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setAppId(\"975217039210\").setOAuthToken(oauthToken).addView(view).addView(new google.picker.DocsUploadView()).setDeveloperKey(developerKey).setCallback(pickerCallback).build();\n      } else {\n        picker = new google.picker.PickerBuilder().setAppId(\"975217039210\").setOAuthToken(oauthToken).addView(view).addView(new google.picker.DocsUploadView()).setDeveloperKey(developerKey).setCallback(pickerCallback).build();\n      }\n      picker.setVisible(true);\n    }\n  }\n\n  function gdriveUpload(data, idx, elem) {\n    gdClientInit = true;\n    var request = gapi.client.drive.files.get({\n      \'fileId\': data.docs[idx].id,\n      \'fields\': \'size\'\n    });\n    request.then(function(resp) {\n      if (resp.result.size > 104900000) {\n        postFailedUpload(elem[\'name\'], resp.result.size, \'over filesize limit\');\n        swal({   \n          title: \"Error with \" + elem[\'name\'] + \": maximum file size is 100MB\", \n          type: \"error\",\n          confirmButtonColor: \"#4cae4c\"\n        });\n        allFilesFinished[elem[\'randomId\']] = true;\n        if (uploadCancelled) {\n          uploadCancelled = false;\n        } else {\n          \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>\" + elem[\'name\'] + \" failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n          \$(\'#pdf-upload-process\').hide();\n          \$(\'#upload-form\').hide();\n          \$(\'#upload-error-message\').show();\n          \$(\'#upload-error-cancel\').on(\'click\', function() {\n            \$(\'#upload-error-message\').hide();\n            \$(\"#confirm-merge-btn\").hide();\n            \$(\'#gdrive-div\').show();\n            \$(\'#upload-form\').show();\n          });\n        };\n      } else {\n        \$.ajax({\n          url: \"/input_files/create_from_gdrive\",\n          dataType: \"json\",\n          type: \"POST\",\n          data: {file: data.docs[idx], url: \"\", token: oauthToken, pro_file_id: originalProFileId}\n        }).success(function(data) {\n          queryForUpload(data[\'unique_id\'], data[\"random_id\"])\n        }).error(function(data) {\n          allFilesFinished[data[\"unique_id\"]] = true;\n\n          if (uploadCancelled) {\n            uploadCancelled = false;\n          } else {\n            \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>Your file failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n            \$(\'#pdf-upload-process\').hide();\n            \$(\'#upload-form\').hide();\n            \$(\'#upload-error-message\').show();\n            \$(\'#upload-error-cancel\').on(\'click\', function() {\n              \$(\'#upload-error-message\').hide();\n              \$(\"#confirm-merge-btn\").hide();\n              \$(\'#gdrive-div\').show();\n              \$(\'#upload-form\').show();\n            });\n          };\n          return false;\n        });\n      }\n    });\n  }\n\n  function pickerCallback(data) {\n    if (data.action == google.picker.Action.PICKED) {\n      uploadCancelled = false;\n      \$(\"#upload-progress-status\").html(\"Uploading....\");\n      var pageNumberOptions;\n      for (i= 0; i < \$pdfCanvas.PDFViewer(\"pageNumbers\").length; i++) {\n        if (i == (\$pdfCanvas.PDFViewer(\"pageNumbers\").length - 1)) {\n          pageNumberOptions += \"<option value=\" + (i+1) + \" selected>\" + (i+1) + \"<\/option>\"\n        } else {\n          pageNumberOptions += \"<option value=\" + (i+1) + \">\" + (i+1) + \"<\/option>\"\n        }\n      }\n      \$(\"#page-number-select\").html(pageNumberOptions);\n      inputFileHash = {};\n      \$(\'#upload-form\').hide();\n      \$(\'#gdrive-div\').hide();\n      \$(\'#upload-job-progress\').attr(\'style\', \"width: 0%;\");\n      \$(\'#pdf-upload-process\').show();\n      \$.each(data.docs, function(idx, elem){\n        var randomId = Math.uuid(8).toLowerCase();\n        allFilesFinished[randomId] = false;\n        elem[\"randomId\"] = randomId;\n      });\n      \$.each(data.docs, function(idx, elem){ \n        if (checkWhiteList(elem[\'name\'], filetypes)) {\n          if (gdClientInit) {\n            gdriveUpload(data, idx, elem);\n          } else {\n            gapi.client.init({\n              apiKey: developerKey,\n              clientId: clientId,\n              discoveryDocs: [\"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest\"],\n              scope: \'https://www.googleapis.com/auth/drive.readonly\'\n            }).then(function() {\n              gdriveUpload(data, idx, elem);\n            });\n          }\n        } else {\n          postFailedUpload(elem[\'name\'], 0, \'unsupported filetype\');\n          swal({   \n            title: elem[\'name\'] + \": file type is not supported.\",\n            type: \"error\",\n            confirmButtonColor: \"#4cae4c\"\n          });\n          allFilesFinished[elem[\'randomId\']] = true;\n          if (uploadCancelled) {\n            uploadCancelled = false;\n          } else {\n            \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>\" + elem[\'name\'] + \" failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n            \$(\'#pdf-upload-process\').hide();\n            \$(\'#upload-form\').hide();\n            \$(\'#upload-error-message\').show();\n            \$(\'#upload-error-cancel\').on(\'click\', function() {\n              \$(\'#upload-error-message\').hide();\n              \$(\"#confirm-merge-btn\").hide();\n              \$(\'#gdrive-div\').show();\n              \$(\'#upload-form\').show();\n            });\n          };\n        }\n      });\n    }\n  }\n\n  \$(\"#gdrive-chooser\").on(\'click\', function(e) {\n    e.preventDefault();\n    onAuthApiLoad();\n    onPickerApiLoad();\n  });\n\n  \$(\"#s3-uploader\").S3Uploader({\n    allow_multiple_files: true,\n    progress_bar_target: \$(\'.js-progress-bars\'),\n    remove_completed_progress_bar: false,\n    before_add: function(file) {\n      if (file.size > 104900000) {\n        postFailedUpload(file.name, file.size, \'over pdf filesize limit\');\n        \$(\"#confirm-merge-btn\").hide();\n        \$(\'#upload-form\').show();\n        \$(\'#pdf-upload-process\').hide();\n        swal({   \n          title: \"Maximum file size is 100MB\", \n          type: \"error\",\n          confirmButtonColor: \"#4cae4c\"\n        });\n        return false;\n      } else if (file.name.match(/^[0-9a-zA-Z\\s\\\$\\-\\_\\.\\+\\!\\*\\\'\\(\\)]{1,}\$/)){ \n        if (checkWhiteList(file.name, [\'.pdf\'])) {\n          if (file.size > 2000000) {\n            \$(\"#upload-progress-status\").append(\"<div id=\'upload-size-warning\'><br><h5><em>The pdf you uploaded is greater than 2MB, this can take longer to upload.<br>Please be patient.<\/em><\/h5><\/div>\");\n          } else {\n            \$(\"#upload-progress-status\").html(\"Uploading....\");\n          }\n          \n          var pageNumberOptions;\n          for (i= 0; i < \$pdfCanvas.PDFViewer(\"pageNumbers\").length; i++) {\n            if (i == (\$pdfCanvas.PDFViewer(\"pageNumbers\").length - 1)) {\n              pageNumberOptions += \"<option value=\" + (i+1) + \" selected>\" + (i+1) + \"<\/option>\"\n            } else {\n              pageNumberOptions += \"<option value=\" + (i+1) + \">\" + (i+1) + \"<\/option>\"\n            }\n          }\n          \$(\"#page-number-select\").html(pageNumberOptions);\n          inputFileHash = {};\n          \$(\'#upload-form\').hide();\n          \$(\'#upload-job-progress\').attr(\'style\', \"width: 0%;\");\n          \$(\'#pdf-upload-process\').show();\n          allFilesFinished[file.unique_id] = false;\n          return true;\n        } else {\n          postFailedUpload(file.name, file.size, \'not pdf filetype\');\n          swal({   \n            title: \"The file you uploaded is not a pdf.\", \n            type: \"error\",\n            confirmButtonColor: \"#4cae4c\"\n          });\n          return false;\n        }\n      } else {\n        swal({   \n          title: \"This filename is not allowed - please remove characters that are not standard numbers 0-9, latin alphabet A-Z, or characters: \$, -, _, ., +, !, *, \', (, )\", \n          type: \"error\",\n          confirmButtonColor: \"#4cae4c\"\n        });\n        return false;\n      } \n    },\n    additional_data: {pro_file_id: originalProFileId}\n  });\n\n  \$(\'#s3-uploader\').bind(\"s3_upload_failed\", function (e, content) {\n    allFilesFinished[content.unique_id] = true;\n    if (uploadCancelled) {\n      uploadCancelled = false;\n    } else {\n      postFailedUpload(content.filename, content.filesize, \"error uploading to s3: \" + content.error_thrown);\n      \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>\" + content.filename + \" failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n      \$(\'#pdf-upload-process\').hide();\n      \$(\'#upload-form\').hide();\n      \$(\'#upload-error-message\').show();\n      \$(\'#upload-error-cancel\').on(\'click\', function() {\n        \$(\'#upload-error-message\').hide();\n        \$(\"#confirm-merge-btn\").hide();\n        \$(\".upload-option-btn\").removeClass(\"active\");\n        \$(\"#computer-btn\").addClass(\"active\");\n        \$(\'.uploader-div\').show();\n        \$(\'#upload-form\').show();\n      });\n    };\n  });\n\n  \$(\'#s3-uploader\').bind(\"s3_uploads_complete\", function (e, content) {\n    allFilesFinished = { \"all\": true };\n  });\n\n  \$(\'#s3-uploader\').bind(\"s3_upload_complete\", function (e, content) {\n    allFilesFinished[content.unique_id] = true;\n  });\n\n  \$(\"#cancel-s3-upload\").on(\'click\', function() {\n    uploadCancelled = true;\n    window.stop();\n    \$(\'#pdf-upload-process\').hide();\n    if (\$(\'#upload-size-warning\').length) {\n      \$(\'#upload-size-warning\').remove();\n    };\n    \$(\"#confirm-merge-btn\").hide();\n    \$(\".upload-option-btn\").removeClass(\"active\");\n    \$(\"#computer-btn\").addClass(\"active\");\n    \$(\'.uploader-div\').show();\n    \$(\'#upload-form\').show();\n  });\n\n  checkWhiteList = function(name, exts) {\n    var lowercaseName = name.toLowerCase();\n    return (new RegExp(\'(\' + exts.join(\'|\').replace(/\\./g, \'\\\\.\') + \')\$\')).test(lowercaseName);\n  };\n\n  function postFailedUpload(name, size, errorMessage) {\n    extension = name.split(\'.\').pop();\n    \$.ajax({\n      url: \"/failed_uploads\",\n      type: \"POST\",\n      data: { failed_upload: {name: name, extension: extension, size: size, error: errorMessage}},\n      dataType: \"json\"\n    });\n  };\n\n  \$(\"#confirm-merge-btn\").on(\"click\", function() {\n    var mergeFormData = \$(\"#merge-info-form\").serializeArray();\n    var mergeData = {};\n    for (var i in mergeFormData) {\n      if (mergeFormData[i].name) {\n        mergeData[mergeFormData[i].name] = mergeFormData[i].value;\n      }\n    }\n    \$(\"#pdf-upload-process\").hide();\n    \$(\"#merge-loading\").show();\n    \$pdfCanvas.PDFViewer(\"addMergeFiles\", inputFileHash, mergeData[\"before-after\"], mergeData[\"page-number\"]);\n  });\n  \n  \$(\"#cancel-uploader\").on(\'click\', function() {\n    \$(\'#new-surface\').activeEditor(\'mode\',\'TRANSFORM\');\n  });\n\n  \$(\"#merge-error-cancel\").on(\'click\', function() {\n    \$(\"#merge-error-message\").hide();\n    \$(\"#sortable-parent\").show();\n  });\n\n  \$(\"#merge-password-error-cancel\").on(\'click\', function() {\n    \$(\"#merge-password-error-message\").hide();\n    \$(\"#sortable-parent\").show();\n  });\n<\/script>\n<script type=\"text/javascript\" src=\"https://apis.google.com/js/api.js?onload=loadPicker\"><\/script>");
        $("#sortable-parent").hide();
        $("#merge-master").show();
        break;
      case "PROTECT":
        $(".switch-mode-protect").addClass("active");
        showToolbar("none");
        $("#sortable-parent").hide();
        $("#protect-form").show();
        break;
      case "TEXT":
        $(".switch-mode-text").addClass("active");
        showToolbar("text");
        break;
      case "TEXT_FIELD":
        if(formsEnabled){
          $(".switch-mode-textfield").addClass("active");
          $("#right-side-panel").find("#title-field-type").text("Text Field");
          showToolbar("text-field");
          $(".text-field-only").show();
          $("#text-field-toolbar").find("#text-field-colorpicker").colorpicker("allowNone", false);
          $("#text-field-properties").find("#text-field-back-colorpicker").colorpicker("allowNone", true);
          $("#text-field-properties").find("#text-field-border-colorpicker").colorpicker("allowNone", true);
        }
        break;
      case "PARAGRAPH_FIELD":
        if(formsEnabled){
          $(".switch-mode-parafield").addClass("active");
          $("#right-side-panel").find("#title-field-type").text("Paragraph Field");
          showToolbar("text-field");
          $(".text-field-only").hide();
          $("#text-field-toolbar").find("#text-field-colorpicker").colorpicker("allowNone", false);
          $("#text-field-properties").find("#text-field-back-colorpicker").colorpicker("allowNone", true);
          $("#text-field-properties").find("#text-field-border-colorpicker").colorpicker("allowNone", true);
        }
        break;
      case "DATE_FIELD":
        if(formsEnabled){
          $(".switch-mode-datefield").addClass("active");
          showToolbar("date-field");
          $("#date-field-toolbar").find("#date-field-colorpicker").colorpicker("allowNone", false);
          $("#date-field-properties").find("#date-field-back-colorpicker").colorpicker("allowNone", true);
          $("#date-field-properties").find("#date-field-border-colorpicker").colorpicker("allowNone", true);
        }
        break;
      case "INITIALS_FIELD":
        if(formsEnabled){
          $(".switch-mode-initialsfield").addClass("active");
          $("#right-side-panel").find("#title-field-type").text("Initials Field");
          showToolbar("sig-field");
          $(".sig-field-only").hide();
          $(".initials-field-only").show();
          // $("#sig-field-toolbar").find("#sig-field-colorpicker").colorpicker("allowNone", false);
          $("#sig-field-properties").find("#sig-field-back-colorpicker").colorpicker("allowNone", true);
          $("#sig-field-properties").find("#sig-field-border-colorpicker").colorpicker("allowNone", true);
        }
        break;
      case "SIG_FIELD":
        if(formsEnabled){
          $(".switch-mode-sigfield").addClass("active");
          $("#right-side-panel").find("#title-field-type").text("Signature Field");
          showToolbar("sig-field");
          $(".sig-field-only").show();
          $(".initials-field-only").hide();
          // $("#sig-field-toolbar").find("#sig-field-colorpicker").colorpicker("allowNone", false);
          $("#sig-field-properties").find("#sig-field-back-colorpicker").colorpicker("allowNone", true);
          $("#sig-field-properties").find("#sig-field-border-colorpicker").colorpicker("allowNone", true);
        }
        break;
      case "CHECK_FIELD":
        if(formsEnabled){
          $(".switch-mode-checkfield").addClass("active");
          $("#right-side-panel").find("#title-field-type").text("Checkbox Field");
          showToolbar("check-field");
          $(".check-field-only").show();
          $(".radio-field-only").hide();
          $("#check-field-toolbar").find("#check-field-colorpicker").colorpicker("allowNone", false);
          $("#check-field-properties").find("#check-field-back-colorpicker").colorpicker("allowNone", true);
          $("#check-field-properties").find("#check-field-border-colorpicker").colorpicker("allowNone", true);
        }
        break;
      case "RADIO_FIELD":
        if(formsEnabled){
          $(".switch-mode-radiofield").addClass("active");
        //   $("#right-side-panel").find("#title-field-type").text("Radio Button Field");
        //   showToolbar("check-field");
        //   $(".check-field-only").hide();
        //   $(".radio-field-only").show();
        //   $("#check-field-toolbar").find("#check-field-colorpicker").colorpicker("allowNone", false);
        //   $("#check-field-properties").find("#check-field-back-colorpicker").colorpicker("allowNone", true);
        //   $("#check-field-properties").find("#check-field-border-colorpicker").colorpicker("allowNone", true);
        }
        break;
      case "COMBO_FIELD":
        if(formsEnabled){
          $(".switch-mode-dropfield").addClass("active");
          $("#right-side-panel").find("#title-field-type").text("Dropdown Field");
          $(".combo-pro-only").show();
          $(".list-pro-only").hide();
          $(".dd-pro-only").show();
          showToolbar("combo-field");
          $("#combo-field-toolbar").find("#combo-field-colorpicker").colorpicker("allowNone", false);
          $("#combo-field-properties").find("#combo-field-back-colorpicker").colorpicker("allowNone", true);
          $("#combo-field-properties").find("#combo-field-border-colorpicker").colorpicker("allowNone", true);
        }
        break;
      case "LIST_FIELD":
        if(formsEnabled){
          $(".switch-mode-listfield").addClass("active");
          $("#right-side-panel").find("#title-field-type").text("List Field");
          $(".combo-pro-only").show();
          $(".list-pro-only").show();
          $(".dd-pro-only").hide();
          showToolbar("combo-field");
          $("#combo-field-toolbar").find("#combo-field-colorpicker").colorpicker("allowNone", false);
          $("#combo-field-properties").find("#combo-field-back-colorpicker").colorpicker("allowNone", true);
          $("#combo-field-properties").find("#combo-field-border-colorpicker").colorpicker("allowNone", true);
        }
        break;
      case "HYPERLINK":
        $(".switch-mode-hyperlink").addClass("active");
        showToolbar("hyperlink");
        $("#hyperlink-toolbar").find("#hyperlink-colorpicker").colorpicker("allowNone", true);
        break;
      case "PEN":
        $(".switch-mode-pen").addClass("active");
        showToolbar("path");
        break;
      case "WHITEOUT_BLOCK":
        $(".switch-mode-whiteoutblock").addClass("active");
        showToolbar("erase");
        $("#erase-toolbar").find("#erase-colorpicker").colorpicker("allowNone", false);
        break;
      case "HIGHLIGHT_BLOCK":
        $(".switch-mode-highlightblock").addClass("active");
        showToolbar("highlight");
        $("#highlight-toolbar").find("#highlight-colorpicker").colorpicker("allowNone", false);
        break;
      case "REDACT_BLOCK":
        $(".switch-mode-redactblock").addClass("active");
        showToolbar("none");
        break;
      case "IMAGE":
        $(".switch-mode-image").addClass("active");
        showToolbar("none");
        break;
      case "SIGNATURE":
        $(".switch-mode-signature").addClass("active");
        showToolbar("none");
        break;
      case "RECTANGLE":
        $(".switch-mode-rectangle").addClass("active");
        showToolbar("shape");
        $("#shape-toolbar").find("#shape-stroke-colorpicker").colorpicker("allowNone", true);
        break;
      case "ELLIPSE":
        $(".switch-mode-ellipse").addClass("active");
        showToolbar("shape");
        $("#shape-toolbar").find("#shape-stroke-colorpicker").colorpicker("allowNone", true);
        break;
      case "LINE":
        $(".switch-mode-line").addClass("active");
        showToolbar("shape", ["fill-group"]);
        $("#shape-toolbar").find("#shape-stroke-colorpicker").colorpicker("allowNone", false);
        break;
      case "HORI_LINE":
        $(".switch-mode-hori-line").addClass("active");
        showToolbar("shape", ["fill-group"]);
        $("#shape-toolbar").find("#shape-stroke-colorpicker").colorpicker("allowNone", false);
        break;
      case "VERT_LINE":
        $(".switch-mode-vert-line").addClass("active");
        showToolbar("shape", ["fill-group"]);
        $("#shape-toolbar").find("#shape-stroke-colorpicker").colorpicker("allowNone", false);
        break;
      case "RANDOM_SVG":
        $(".switch-mode-svg").addClass("active");
        showToolbar("none");
        break;
      case "SYMBOL_PERSON":
        $(".switch-mode-person").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_CHECKMARK":
        $(".switch-mode-checkmark").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_REMOVE":
        $(".switch-mode-remove").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_ARROW_LEFT":
        $(".switch-mode-arrow-left").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_ARROW_RIGHT":
        $(".switch-mode-arrow-right").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_ARROW_UP":
        $(".switch-mode-arrow-up").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_ARROW_DOWN":
        $(".switch-mode-arrow-down").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_THUMBS_UP":
        $(".switch-mode-thumbs-up").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_THUMBS_DOWN":
        $(".switch-mode-thumbs-down").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_QUESTION":
        $(".switch-mode-question").addClass("active");
        showToolbar("symbol");
        break;
      case "SYMBOL_EXCLAMATION":
        $(".switch-mode-exclamation").addClass("active");
        showToolbar("symbol");
    }
  }

  function onEditorSelectElement(doc) {
    var t;
    switch(t = null == doc.activeElement ? null : doc.activeElement.data("type")) {
      case "TEXT":
        showToolbar("text");
        break;
      case "TEXT_FIELD":
        if(formsEnabled){
          $("#right-side-panel").find("#title-field-type").text("Text Field");
          showToolbar("text-field");
          $(".text-field-only").show();
        } else {
          showToolbar("none");
        }
        break;
      case "PARAGRAPH_FIELD":
        if(formsEnabled){
          $("#right-side-panel").find("#title-field-type").text("Paragraph Field");
          showToolbar("text-field");
          $(".text-field-only").hide();
        } else {
          showToolbar("none");
        }
        break;
      case "DATE_FIELD":
        if(formsEnabled){
          showToolbar("date-field");
        } else {
          showToolbar("none");
        }
        break;
      case "INITIALS_FIELD":
        if(formsEnabled){
          $("#right-side-panel").find("#title-field-type").text("Initials Field");
          showToolbar("sig-field");
          $(".sig-field-only").hide();
          $(".initials-field-only").show();
        } else {
          showToolbar("none");
        }
        break;
      case "SIG_FIELD":
        if(formsEnabled){
          $("#right-side-panel").find("#title-field-type").text("Signature Field");
          showToolbar("sig-field");
          $(".sig-field-only").show();
          $(".initials-field-only").hide();
        } else {
          showToolbar("none");
        }
        break;
      case "CHECK_FIELD":
        if(formsEnabled){
          $("#right-side-panel").find("#title-field-type").text("Checkbox Field");
          showToolbar("check-field");
          $(".check-field-only").show();
          $(".radio-field-only").hide();
          if (doc.activeElement.activeElement("pro")) {
            $(".check-field-pro").show();
          } else {
            $(".check-field-pro").hide();
          }
        } else {
          showToolbar("none");
        }
        break;
      case "RADIO_FIELD":
        if(formsEnabled){
          $("#right-side-panel").find("#title-field-type").text("Radio Button Field");
          showToolbar("check-field");
          $(".check-field-only").hide();
          $(".radio-field-only").show();
          if (doc.activeElement.activeElement("pro")) {
            $(".check-field-pro").show();
            $(".radio-field-pro").show();
          } else {
            $(".check-field-pro").hide();
            $(".radio-field-pro").hide();
          }
        } else {
          showToolbar("none");
        }
        break;
      case "COMBO_FIELD":
        if(formsEnabled){
          $("#right-side-panel").find("#title-field-type").text("Dropdown Field");
          if (doc.activeElement.activeElement("pro")) {
            $(".combo-pro-only").show();
            $(".list-pro-only").hide();
            $(".dd-pro-only").show();
          } else {
            $(".combo-pro-only").hide();
            $(".list-pro-only").hide();
            $(".dd-pro-only").hide();
          }
          showToolbar("combo-field");
        } else {
          showToolbar("none");
        }
        break;
      case "LIST_FIELD":
        if(formsEnabled){
          $("#right-side-panel").find("#title-field-type").text("List Field");
          if (doc.activeElement.activeElement("pro")) {
            $(".combo-pro-only").show();
            $(".list-pro-only").show();
            $(".dd-pro-only").hide();
          } else {
            $(".combo-pro-only").hide();
            $(".list-pro-only").hide();
            $(".dd-pro-only").hide();
          }
          showToolbar("combo-field");
        } else {
          showToolbar("none");
        }
        break;
      case "HYPERLINK":
        var point = doc.activeElement.activeElement("svgProperties");
        showLinkForm(doc.activeElement, point);
        showToolbar("hyperlink");
        break;
      case "PATH":
        showToolbar("path");
        break;
      case "WHITEOUT_BLOCK":
        showToolbar("erase");
        break;
      case "HIGHLIGHT_BLOCK":
        showToolbar("highlight");
        break;
      case "RECTANGLE":
      ;
      case "ELLIPSE":
        showToolbar("shape");
        break;
      case "LINE":
        showToolbar("shape", ["fill-group"]);
        break;
      case "HORI_LINE":
        showToolbar("shape", ["fill-group"]);
        break;
      case "VERT_LINE":
        showToolbar("shape", ["fill-group"]);
        break;
      case "SIGNATURE":
        if (doc.activeElement.is("p")) {
          showToolbar("signature");
        } else {
          showToolbar("none");
        }
        break;
      case "SYMBOL_CHECKMARK":
      ;
      case "SYMBOL_REMOVE":
      ;
      case "SYMBOL_ARROW_LEFT":
      ;
      case "SYMBOL_ARROW_RIGHT":
      ;
      case "SYMBOL_ARROW_UP":
      ;
      case "SYMBOL_ARROW_DOWN":
      ;
      case "SYMBOL_THUMBS_UP":
      ;
      case "SYMBOL_THUMBS_DOWN":
      ;
      case "SYMBOL_QUESTION":
      ;
      case "SYMBOL_EXCLAMATION":
        showToolbar("symbol");
        break;
      default:
        showToolbar("none");
    }
  }
  function showLinkForm(element, position) {
    position = position || element.activeElement("svgProperties");
    if (parseFloat(position.translate.y) > 220) {
      $("#linkForm").css({
        "left": parseFloat(position.translate.x) + "px",
        "top": (parseFloat(position.translate.y) - 216) + "px"
      });
    } else {
      $("#linkForm").css({
        "left": parseFloat(position.translate.x) + "px",
        "top": (parseFloat(position.translate.y) + ((parseFloat(position.height) * parseFloat(position.scale.y)) + 5)) + "px"
      });
    }
    var linkForm = $("#linkForm form");
    var thisRect = element.find("rect");
    linkForm.find("#elementId").val(element.data("id"));
    if (thisRect.data("kind") == "uri") {
      linkForm.find("input[name=kind][value='uri']").prop("checked", true);
      linkForm.find('input[name=linkUrl]').val(thisRect.data("url"));
      linkForm.find('#link-prefix').val(thisRect.data("prefix"));
    } else {
      linkForm.find("input[name=kind][value='page']").prop("checked", true);
      linkForm.find('input[name=linkPage]').val(thisRect.data("page"));
    }
    $("#linkForm").show();
  }
  function hideLinkForm() {
    var linkForm = $("#linkForm form");
    var elementId = linkForm.find("#elementId").val();
    var thisElement = $("#element-layer").find('[data-id="' + elementId + '"]').find("rect");
    var linkType = linkForm.find('input[name=kind]:checked').val();
    thisElement.data("kind", linkType);
    if (linkType == "uri") {
      var linkUrl = linkForm.find('input[name=linkUrl]').val();
      thisElement.data("url", linkUrl);
      var linkPrefix = linkForm.find('#link-prefix').val();
      thisElement.data("prefix", linkPrefix);
    } else {
      var linkPage = linkForm.find('input[name=linkPage]').val();
      thisElement.data("page", linkPage);
    }
    $("#linkForm").hide();
  }
  function isUserInitiated(statement) {
    var t;
    return t = statement.hasOwnProperty("originalEvent") ? true : statement.hasOwnProperty("userInitiated") ? statement.userInitiated : "slide" == statement.type ? true : false;
  }
  function onEditorFocusElement(waypoint) {
    null != waypoint.element;
  }

  $viewerToolbar = $('#viewer-toolbar');
  $pdfCanvas.bind('getPage',onPageGet);
  $pdfCanvas.bind('renderPage',onPageRender);
  $pdfCanvas.bind('loadPDF',onLoadPDF);
  $pdfCanvas.bind('loadError',onLoadError);

  $viewerToolbar.find('.btn-page-previous').click(pagePrevious);
  $viewerToolbar.find('.btn-page-next').click(pageNext);
  $viewerToolbar.find('.page-number').change(function(e){
    pageNumber = $pdfCanvas.PDFViewer("pageNumbers")[parseInt($(this).val()) - 1];
    goToPage(pageNumber, $pdfCanvas.PDFViewer("pageNumber"), "TRANSFORM", false);
  });

  var $textToolbar = $('#text-toolbar');

  // Initialize color pickers:
  $textToolbar.find('#text-colorpicker').colorpicker({value:'#000000',allow_none:false});

  // Handle toolbar changes:
  $textToolbar.find('#text-font').bind('change',function(e){
    if (isUserInitiated(e)) updateTextSettings();
  });
  $textToolbar.find('#text-bold').click(function(e){
    var $this = $(this);
    if ($this.hasClass('active'))
      $this.removeClass('active');
    else
      $this.addClass('active');

    if (isUserInitiated(e)) updateTextSettings();
  });
  $textToolbar.find('#text-italic').click(function(e){
    var $this = $(this);
    if ($this.hasClass('active'))
      $this.removeClass('active');
    else
      $this.addClass('active');

    if (isUserInitiated(e)) updateTextSettings();
  });
  $textToolbar.find('#text-underlined').click(function(e){
    var $this = $(this);
    if ($this.hasClass('active'))
      $this.removeClass('active');
    else
      $this.addClass('active');

    if (isUserInitiated(e)) updateTextSettings();
  });
  $textToolbar.find('#text-align-left, #text-align-center, #text-align-right').click(function(e){
    $textToolbar.find('#text-align-left, #text-align-center, #text-align-right').removeClass('active');
    $(this).addClass('active');

    if (isUserInitiated(e)) updateTextSettings();
  });

  var $textFieldToolbar = $('#text-field-toolbar');
  var $textFormStyles = $("#text-field-properties");
  $textFieldToolbar.find('#text-field-colorpicker').colorpicker({value:'#000000',allow_none:false});
  $textFormStyles.find('#text-field-back-colorpicker').colorpicker({value:'NONE', allow_none:true });
  $textFormStyles.find('#text-field-border-colorpicker').colorpicker({value:'NONE', allow_none:true });

  $textFieldToolbar.find('#text-field-font').bind('change',function(e){
    if (isUserInitiated(e)) {updateTextFieldSettings();}
  });
  $textFormStyles.find('#maxlength-reset').on('click', function(e) {
    $textFormStyles.find("#text-field-maxlength").val("");
    updateTextFieldSettings();
  });
  $textFormStyles.find('#text-field-back-reset').on('click', function(e) {
    $textFormStyles.find("#text-field-back-colorpicker").spectrum("set", "");
    $("#text-field-back-colorpicker").colorpicker("value", "NONE");
    updateTextFieldSettings();
  });
  $textFormStyles.find('#text-field-border-reset').on('click', function(e) {
    $textFormStyles.find("#text-field-border-colorpicker").spectrum("set", "");
    $("#text-field-border-colorpicker").colorpicker("value", "NONE");
    updateTextFieldSettings();
  });
  $textFieldToolbar.find('#text-field-bold').click(function(e){
    var $this = $(this);
    if ($this.hasClass('active')) {
      $this.removeClass('active');
    }else{
      $this.addClass('active');
    }

    if (isUserInitiated(e)) {updateTextFieldSettings();}
  });
  $textFieldToolbar.find('#text-field-italic').click(function(e){
    var $this = $(this);
    if ($this.hasClass('active')) {
      $this.removeClass('active');
    }else{
      $this.addClass('active');
    }

    if (isUserInitiated(e)){ updateTextFieldSettings();}
  });
  $textFieldToolbar.find('#text-field-align-left, #text-field-align-center, #text-field-align-right').click(function(e){
    $textFieldToolbar.find('#text-field-align-left, #text-field-align-center, #text-field-align-right').removeClass('active');
    $(this).addClass('active');

    if (isUserInitiated(e)){ updateTextFieldSettings();}
  });
  $textFormStyles.find('#text-field-border-width').bind('change', function(e){
    if (isUserInitiated(e)) updateTextFieldSettings();
  });
  $textFormStyles.find('#text-field-comb').bind('change', function(e){
    if (isUserInitiated(e)) updateTextFieldSettings();
  });
  $textFormStyles.find('#text-field-required').bind('change', function(e){
    if (isUserInitiated(e)) updateTextFieldSettings();
  });
  $textFormStyles.find('#text-field-maxlength').bind('change', function(e){
    if (isUserInitiated(e)) updateTextFieldSettings();
  });
  $textFormStyles.find('#text-field-placeholder').bind('change', function(e){
    if (isUserInitiated(e)) updateTextFieldSettings();
  });
  $textFormStyles.find('#text-field-name').bind('change', function(e){
    if (isUserInitiated(e)) updateTextFieldSettings();
  });

  var $dateFieldToolbar = $('#date-field-toolbar');
  var $dateFormStyles = $("#date-field-properties");
  $dateFieldToolbar.find('#date-field-colorpicker').colorpicker({value:'#000000',allow_none:false});
  $dateFormStyles.find('#date-field-back-colorpicker').colorpicker({value:'NONE', allow_none:true });
  $dateFormStyles.find('#date-field-border-colorpicker').colorpicker({value:'NONE', allow_none:true });

  $dateFieldToolbar.find('#date-field-font').bind('change',function(e){
    if (isUserInitiated(e)) {updateDateFieldSettings();}
  });
  $dateFormStyles.find('#date-field-back-reset').on('click', function(e) {
    $dateFormStyles.find("#date-field-back-colorpicker").spectrum("set", "");
    $("#date-field-back-colorpicker").colorpicker("value", "NONE");
    updateDateFieldSettings();
  });
  $dateFormStyles.find('#date-field-border-reset').on('click', function(e) {
    $dateFormStyles.find("#date-field-border-colorpicker").spectrum("set", "");
    $("#date-field-border-colorpicker").colorpicker("value", "NONE");
    updateDateFieldSettings();
  });
  $dateFieldToolbar.find('#date-field-bold').click(function(e){
    var $this = $(this);
    if ($this.hasClass('active')) {
      $this.removeClass('active');
    }else{
      $this.addClass('active');
    }
    if (isUserInitiated(e)) {updateDateFieldSettings();}
  });
  $dateFieldToolbar.find('#date-field-italic').click(function(e){
    var $this = $(this);
    if ($this.hasClass('active')) {
      $this.removeClass('active');
    }else{
      $this.addClass('active');
    }
    if (isUserInitiated(e)){ updateDateFieldSettings();}
  });
  $dateFieldToolbar.find('#date-field-align-left, #date-field-align-center, #date-field-align-right').click(function(e){
    $dateFieldToolbar.find('#date-field-align-left, #date-field-align-center, #date-field-align-right').removeClass('active');
    $(this).addClass('active');
    if (isUserInitiated(e)){ updateDateFieldSettings();}
  });
  $dateFormStyles.find('#date-field-border-width').bind('change', function(e){
    if (isUserInitiated(e)) updateDateFieldSettings();
  });
  $dateFormStyles.find('#date-field-required').bind('change', function(e){
    if (isUserInitiated(e)) updateDateFieldSettings();
  });
  $dateFormStyles.find('#date-field-name').bind('change', function(e){
    if (isUserInitiated(e)) updateDateFieldSettings();
  });
  $dateFormStyles.find('#date-field-fill-btn').click(function(e){
    var activeElement = $("#new-surface").activeEditor("selectedElement").activeElement;
    if (activeElement) {
      activeElement.activeElement("fillDateField");
    }
  });

  // var $sigFieldToolbar = $('#sig-field-toolbar');
  var $sigFormStyles = $("#sig-field-properties");
  // $sigFieldToolbar.find('#sig-field-colorpicker').colorpicker({value:'#000000',allow_none:false});
  $sigFormStyles.find('#sig-field-back-colorpicker').colorpicker({value:'NONE', allow_none:true });
  $sigFormStyles.find('#sig-field-border-colorpicker').colorpicker({value:'NONE', allow_none:true });

  $sigFormStyles.find('#sig-field-back-reset').on('click', function(e) {
    $sigFormStyles.find("#sig-field-back-colorpicker").spectrum("set", "");
    $("#sig-field-back-colorpicker").colorpicker("value", "NONE");
    updateSigFieldSettings();
  });
  $sigFormStyles.find('#sig-field-border-reset').on('click', function(e) {
    $sigFormStyles.find("#sig-field-border-colorpicker").spectrum("set", "");
    $("#sig-field-border-colorpicker").colorpicker("value", "NONE");
    updateSigFieldSettings();
  });
  $sigFormStyles.find('#sig-field-border-width').bind('change', function(e){
    if (isUserInitiated(e)) updateSigFieldSettings();
  });
  $sigFormStyles.find('#sig-field-required').bind('change', function(e){
    if (isUserInitiated(e)) updateSigFieldSettings();
  });
  $sigFormStyles.find('#sig-field-name').bind('change', function(e){
    if (isUserInitiated(e)) updateSigFieldSettings();
  });

  var $checkFieldToolbar = $('#check-field-toolbar');
  var $checkFormStyles = $("#check-field-properties");
  $checkFieldToolbar.find('#check-field-colorpicker').colorpicker({value:'#000000',allow_none:false});
  $checkFormStyles.find('#check-field-back-colorpicker').colorpicker({value:'NONE', allow_none:true });
  $checkFormStyles.find('#check-field-border-colorpicker').colorpicker({value:'NONE', allow_none:true });
  $checkFieldToolbar.find('#check-field-char').bind('change',function(e){
    if (isUserInitiated(e)) {updateCheckFieldSettings();}
  });
  $checkFormStyles.find('#check-field-back-reset').on('click', function(e) {
    $checkFormStyles.find("#check-field-back-colorpicker").spectrum("set", "");
    $("#check-field-back-colorpicker").colorpicker("value", "NONE");
    updateCheckFieldSettings();
  });
  $checkFormStyles.find('#check-field-border-reset').on('click', function(e) {
    $checkFormStyles.find("#check-field-border-colorpicker").spectrum("set", "");
    $("#check-field-border-colorpicker").colorpicker("value", "NONE");
    updateCheckFieldSettings();
  });
  $checkFormStyles.find('#check-field-border-width').bind('change', function(e){
    if (isUserInitiated(e)) updateCheckFieldSettings();
  });
  $checkFormStyles.find('#check-field-required').bind('change', function(e){
    if (isUserInitiated(e)) updateCheckFieldSettings();
  });
  $checkFormStyles.find('#check-field-export').bind('change', function(e){
    if (isUserInitiated(e)) updateCheckFieldSettings();
  });
  $checkFormStyles.find('#check-field-name').bind('change', function(e){
    if (isUserInitiated(e)) updateCheckFieldSettings();
  });

  var $comboFieldToolbar = $('#combo-field-toolbar');
  var $comboFormStyles = $("#combo-field-properties");
  $comboFieldToolbar.find('#combo-field-colorpicker').colorpicker({value:'#000000',allow_none:false});
  $comboFormStyles.find('#combo-field-back-colorpicker').colorpicker({value:'NONE', allow_none:true });
  $comboFormStyles.find('#combo-field-border-colorpicker').colorpicker({value:'NONE', allow_none:true });

  $comboFieldToolbar.find('#combo-field-font').bind('change',function(e){
    if (isUserInitiated(e)) {updateComboFieldSettings();}
  });
  $comboFormStyles.find('#combo-field-back-reset').on('click', function(e) {
    $comboFormStyles.find("#combo-field-back-colorpicker").spectrum("set", "");
    $("#combo-field-back-colorpicker").colorpicker("value", "NONE");
    updateComboFieldSettings();
  });
  $comboFormStyles.find('#combo-field-border-reset').on('click', function(e) {
    $comboFormStyles.find("#combo-field-border-colorpicker").spectrum("set", "");
    $("#combo-field-border-colorpicker").colorpicker("value", "NONE");
    updateComboFieldSettings();
  });
  $comboFieldToolbar.find('#combo-field-bold').click(function(e){
    var $this = $(this);
    if ($this.hasClass('active')) {
      $this.removeClass('active');
    }else{
      $this.addClass('active');
    }

    if (isUserInitiated(e)) {updateComboFieldSettings();}
  });
  $comboFieldToolbar.find('#combo-field-italic').click(function(e){
    var $this = $(this);
    if ($this.hasClass('active')) {
      $this.removeClass('active');
    }else{
      $this.addClass('active');
    }

    if (isUserInitiated(e)){ updateComboFieldSettings();}
  });
  $comboFieldToolbar.find('#combo-field-align-left, #combo-field-align-center, #combo-field-align-right').click(function(e){
    $comboFieldToolbar.find('#combo-field-align-left, #combo-field-align-center, #combo-field-align-right').removeClass('active');
    $(this).addClass('active');

    if (isUserInitiated(e)){ updateComboFieldSettings();}
  });
  $comboFormStyles.find('#combo-field-border-width').bind('change', function(e){
    if (isUserInitiated(e)) updateComboFieldSettings();
  });
  $comboFormStyles.find('#combo-field-required').bind('change', function(e){
    if (isUserInitiated(e)) updateComboFieldSettings();
  });
  $comboFormStyles.find('#combo-field-name').bind('change', function(e){
    if (isUserInitiated(e)) updateComboFieldSettings();
  });
  $comboFormStyles.find('#dd-choice-btn').on('click', function(e) {
    var choiceText =  $.trim($comboFormStyles.find('#dd-item').val());
    if (choiceText.length > 0) {
      $("#new-surface").activeEditor("addComboFieldChoice", choiceText);
      $comboFormStyles.find('#dd-item').val("");
    }
  });
  $comboFormStyles.find('#dd-item').on('keypress', function (e) {
    if(e.which === 13){
      var choiceText =  $.trim($comboFormStyles.find('#dd-item').val());
      if (choiceText.length > 0) {
        $("#new-surface").activeEditor("addComboFieldChoice", choiceText);
        $comboFormStyles.find('#dd-item').val("");
      }
    }
  });
  $comboFormStyles.find('#combo-field-edit').bind('change', function(e){
    if (isUserInitiated(e)) updateComboChoices();
  });
  $comboFormStyles.find('#combo-field-multiple').bind('change', function(e){
    if (isUserInitiated(e)) updateComboChoices();
  });
  $comboFormStyles.find('#combo-field-sort').bind('change', function(e){
    if (isUserInitiated(e)) updateComboChoices();
  });
  $comboFormStyles.find('#combo-field-empty').bind('change', function(e){
    // if (this.checked) {
    //   $("#combo-field-reset").show();
    // } else {
    //   $("#combo-field-reset").hide();
    // }
    if (isUserInitiated(e)) updateComboChoices();
  });
  // $comboFormStyles.find('#combo-field-reset').on('click', function(e) {
  //   $('#new-surface').activeEditor('clearComboSelected');
  // });

  // ========= Multiple toolbar =========
  var $multipleToolbar = $('#multiple-toolbar');
  $multipleToolbar.find('#align-left').on('click', function(e) {
    $("#new-surface").activeEditor("updateFields", "left");
  });
  $multipleToolbar.find('#align-right').on('click', function(e) {
    $("#new-surface").activeEditor("updateFields", "right");
  });
  $multipleToolbar.find('#align-top').on('click', function(e) {
    $("#new-surface").activeEditor("updateFields", "top");
  });
  $multipleToolbar.find('#align-bottom').on('click', function(e) {
    $("#new-surface").activeEditor("updateFields", "bottom");
  });
  $multipleToolbar.find('#align-hori').on('click', function(e) {
    $("#new-surface").activeEditor("updateFields", "hori");
  });
  $multipleToolbar.find('#align-vert').on('click', function(e) {
    $("#new-surface").activeEditor("updateFields", "vert");
  });
  $multipleToolbar.find('#match-width').on('click', function(e) {
    $("#new-surface").activeEditor("updateFields", "width");
  });
  $multipleToolbar.find('#match-height').on('click', function(e) {
    $("#new-surface").activeEditor("updateFields", "height");
  });
  $multipleToolbar.find('#match-both').on('click', function(e) {
    $("#new-surface").activeEditor("updateFields", "both");
  });
  $multipleToolbar.find('#spacing-hori').on('click', function(e) {
    $("#new-surface").activeEditor("updateSpacing", "space-hori");
  });
  $multipleToolbar.find('#spacing-vert').on('click', function(e) {
    $("#new-surface").activeEditor("updateSpacing", "space-vert");
  });

  // ========= Signature toolbar =========

  var $sigToolbar = $('#signature-toolbar');

  // Initialize color pickers:
  $sigToolbar.find('#signature-colorpicker').colorpicker({value:'#000000',allow_none:false})

  // ========= Path toolbar =========

  var $pathToolbar = $('#path-toolbar');

  // Initialize color pickers:
  $pathToolbar.find('#path-colorpicker').colorpicker({value:'#000000',allow_none:false});

  // Handle changes:
  $('#path-width').bind('change', function(e){
    if (isUserInitiated(e)) updatePathSettings();
  });

  // ========= Shape toolbar =========
  var $eraseToolbar = $('#erase-toolbar');

  // Initialize color pickers:
  $eraseToolbar.find('#erase-colorpicker').colorpicker({value:'#ffffff'});

  // ========= Shape toolbar =========
  var $highlightToolbar = $('#highlight-toolbar');

  // Initialize color pickers:
  $highlightToolbar.find('#highlight-colorpicker').colorpicker({value:'#ffff00'});

  // ========= Link toolbar =========
  var $linkToolbar = $('#hyperlink-toolbar');

  // Initialize color pickers:
  $linkToolbar.find('#hyperlink-colorpicker').colorpicker({value:'NONE', allow_none:true });

  $linkToolbar.find('#hyperlink-stroke-width').bind('change', function(e){
    if (isUserInitiated(e)) updateHyperlinkSettings();
  });

  var $shapeToolbar = $('#shape-toolbar');

  // Initialize color pickers:
  $shapeToolbar.find('#shape-stroke-colorpicker').colorpicker({value:'#000000'});
  $shapeToolbar.find('#shape-fill-colorpicker').colorpicker({value:'NONE'});

  /// Handle changes:
  $shapeToolbar.find('#shape-stroke-width').bind('change', function(e){
    if (isUserInitiated(e)) updateShapeSettings();
  });

  // ========= Symbol toolbar =========
  var $symbolToolbar = $('#symbol-toolbar');

  // Initialize color pickers:
  $symbolToolbar.find('#symbol-colorpicker').colorpicker({value:'#000000',allow_none:false});

  /// Handle changes:
  $('#symbol-size-select').bind('change', function(e){
    if (isUserInitiated(e)) updateSymbolSettings();
  });

  $('.switch-mode-transform').click(function(e){
    $('#new-surface').activeEditor('mode','TRANSFORM');
  });
  $('.switch-mode-text').click(function(e){
    $('#new-surface').activeEditor('mode','TEXT');
  });
  $('.switch-mode-multiple').click(function(e){
    $('#new-surface').activeEditor('mode','MULTIPLE');
  });
  $('.switch-mode-textfield').click(function(e){
    $('#new-surface').activeEditor('mode','TEXT_FIELD');
  });
  $('.switch-mode-parafield').click(function(e){
    $('#new-surface').activeEditor('mode','PARAGRAPH_FIELD');
  });
  $('.switch-mode-datefield').click(function(e){
    $('#new-surface').activeEditor('mode','DATE_FIELD');
  });
  $('.switch-mode-sigfield').click(function(e){
    $('#new-surface').activeEditor('mode','SIG_FIELD');
  });
  $('.switch-mode-initialsfield').click(function(e){
    $('#new-surface').activeEditor('mode','INITIALS_FIELD');
  });
  $('.switch-mode-checkfield').click(function(e){
    $('#new-surface').activeEditor('mode','CHECK_FIELD');
  });
  $('.switch-mode-radiofield').click(function(e){
    $("#new-surface").activeEditor("showManageRadioButtons");
    // $('#new-surface').activeEditor('mode','RADIO_FIELD');
  });
  $('.switch-mode-dropfield').click(function(e){
    $('#new-surface').activeEditor('mode','COMBO_FIELD');
  });
  $('.switch-mode-listfield').click(function(e){
    $('#new-surface').activeEditor('mode','LIST_FIELD');
  });
  $('.switch-mode-hyperlink').click(function(e){
    $('#new-surface').activeEditor('mode','HYPERLINK');
  });
  $('.switch-mode-pen').click(function(e){
    $('#new-surface').activeEditor('mode','PEN');
  });
  $('.switch-mode-whiteoutblock').click(function(e){
    $('#new-surface').activeEditor('mode','WHITEOUT_BLOCK');
  });
  $('.switch-mode-highlightblock').click(function(e){
    $('#new-surface').activeEditor('mode','HIGHLIGHT_BLOCK');
  });
  $('.switch-mode-redactblock').click(function(e){
    $('#new-surface').activeEditor('mode','REDACT_BLOCK');
  });
  $('.switch-mode-delete-pages').click(function(e){
    $('#new-surface').activeEditor('mode','DELETE-PAGES');
  });
  $('.switch-mode-rotate').click(function(e){
    $('#new-surface').activeEditor('mode','ROTATE');
  });
  $('.switch-mode-reorder').click(function(e){
    $('#new-surface').activeEditor('mode','REORDER');
  });
  $('.switch-mode-merge').click(function(e){
    $('#new-surface').activeEditor('mode','MERGE');
  });
    $('.switch-mode-protect').click(function(e){
    $('#new-surface').activeEditor('mode','PROTECT');
  });

  $(document.body).on('click',".switch-mode-rectangle",function () {
    $('#new-surface').activeEditor('mode','RECTANGLE');
  });
  $(document.body).on('click',".switch-mode-ellipse",function () {
    $('#new-surface').activeEditor('mode','ELLIPSE');
  });
  $(document.body).on('click',".switch-mode-line",function () {
    $('#new-surface').activeEditor('mode','LINE');
  });
  $(document.body).on('click',".switch-mode-hori-line",function () {
    $('#new-surface').activeEditor('mode','HORI_LINE');
  });
  $(document.body).on('click',".switch-mode-vert-line",function () {
    $('#new-surface').activeEditor('mode','VERT_LINE');
  });
  $(document.body).on('click',".switch-mode-checkmark",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_CHECKMARK');
  });
  $(document.body).on('click',".switch-mode-remove",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_REMOVE');
  });
  $(document.body).on('click',".switch-mode-arrow-left",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_ARROW_LEFT');
  });
  $(document.body).on('click',".switch-mode-arrow-right",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_ARROW_RIGHT');
  });
  $(document.body).on('click',".switch-mode-arrow-up",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_ARROW_UP');
  });
  $(document.body).on('click',".switch-mode-arrow-down",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_ARROW_DOWN');
  });
  $(document.body).on('click',".switch-mode-thumbs-up",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_THUMBS_UP');
  });
  $(document.body).on('click',".switch-mode-thumbs-down",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_THUMBS_DOWN');
  });
  $(document.body).on('click',".switch-mode-question",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_QUESTION');
  });
  $(document.body).on('click',".switch-mode-exclamation",function () {
    $('#new-surface').activeEditor('mode','SYMBOL_EXCLAMATION');
  });
  $('.switch-mode-image').click(function(e){
    $('#new-surface').activeEditor('mode','IMAGE');
  });
  $('.switch-mode-signature').click(function(e){
    $('#new-surface').activeEditor('mode','SIGNATURE');
  });
  $(document.body).on('click',"#merge-upload-btn",function () {
    $("#merge-master").html("<div class=\"col-sm-12 checkout-padding\" id=\"upload-form\">\n  <br>\n  <div style=\"text-align:center;margin:0px 40px 20px;\">\n    <div class=\"drop-box\" style=\"margin: 10px auto 20px;padding: 80px 20px;border: 5px #ccc dashed;max-width: 950px;background-color:#fff;min-height: 300px;\">\n      <div class=\"uploader-div\">\n        <div style=\"font-size:18px;\">Drag &amp; drop your file here to upload<\/div>\n        <div style=\"margin:5px auto 10px;font-style:italic;font-size: 16px;\">or<\/div>\n        <form id=\"s3-uploader\" data-callback-url=\"/input_files\" data-callback-method=\"POST\" data-callback-param=\"file\" enctype=\"multipart/form-data\" action=\"https://s3-eu-west-1.amazonaws.com/create-pdf/\" accept-charset=\"UTF-8\" method=\"post\"><input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" /><input type=\"hidden\" name=\"key\" id=\"key\" value=\"inputs/{unique_id}-e94e70ab/\${filename}\" /><input type=\"hidden\" name=\"acl\" id=\"acl\" value=\"public-read\" /><input type=\"hidden\" name=\"AWSAccessKeyId\" id=\"AWSAccessKeyId\" value=\"AKIAJBG24RZNZSPKQRPA\" /><input type=\"hidden\" name=\"policy\" id=\"policy\" value=\"eyJleHBpcmF0aW9uIjoiMjAyMC0xMC0wMVQyMTowNDo0N1oiLCJjb25kaXRpb25zIjpbWyJzdGFydHMtd2l0aCIsIiR1dGY4IiwiIl0sWyJzdGFydHMtd2l0aCIsIiRrZXkiLCJpbnB1dHMvIl0sWyJzdGFydHMtd2l0aCIsIiR4LXJlcXVlc3RlZC13aXRoIiwiIl0sWyJjb250ZW50LWxlbmd0aC1yYW5nZSIsMCwxMDQ4NTc2MDBdLFsic3RhcnRzLXdpdGgiLCIkY29udGVudC10eXBlIiwiIl0seyJidWNrZXQiOiJjcmVhdGUtcGRmIn0seyJhY2wiOiJwdWJsaWMtcmVhZCJ9LHsic3VjY2Vzc19hY3Rpb25fc3RhdHVzIjoiMjAxIn1dfQ==\" /><input type=\"hidden\" name=\"signature\" id=\"signature\" value=\"FuEmxNUPSBeWR3uYZOyt7em3FZQ=\" /><input type=\"hidden\" name=\"success_action_status\" id=\"success_action_status\" value=\"201\" /><input type=\"hidden\" name=\"X-Requested-With\" id=\"X-Requested-With\" value=\"xhr\" />\n          <div class=\"fileUpload btn btn-success btn-modal\">\n            <span class=\"fas fa-cloud-upload-alt\"><\/span>  <span id=\"upload-file-text\">Upload PDF<\/span>\n            <input type=\"file\" name=\"file\" id=\"uploadBtn\" multiple=\"multiple\" class=\"upload\" />\n          <\/div>\n<\/form>      <\/div>\n      <div id=\"dropbox-div\" style=\"display:none;width: 100%;height: 100px;padding-top: 35px;\">\n        <div class=\"btn btn-modal\" id=\"dropbox-chooser\" style=\"background-color:#7fbf4d;padding: 12px 24px;border-radius: 0px;border: none;color:#fff;\">\n          <i class=\"fab fa-dropbox\" style=\"padding-right:10px;\"><\/i><span id=\"upload-file-text\">Upload from Dropbox<\/span>\n        <\/div>\n      <\/div>\n      <div id=\"gdrive-div\" style=\"display:none;width: 100%;height: 100px;padding-top: 35px;\">\n        <div class=\"btn btn-modal\" id=\"gdrive-chooser\" style=\"background-color:#7fbf4d;padding: 12px 24px;border-radius: 0px;border: none;color:#fff;\">\n          <i class=\"fab fa-google-drive\" style=\"padding-right:10px;\"><\/i><span id=\"upload-file-text\">Upload from Google Drive<\/span>\n        <\/div>\n      <\/div>\n    <\/div>\n    <div id=\"upload-option-btns\" style=\"margin-bottom: 30px;\">\n      <div class=\"btn active upload-option-btn\" id=\"computer-btn\" style=\"margin-right:10px;font-size:26px;\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Upload from computer\">\n        <i class=\"fas fa-upload\"><\/i>\n      <\/div>\n      <div class=\"btn upload-option-btn\" id=\"dropbox-btn\" style=\"margin-right:10px;font-size:26px;\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Upload from Dropbox\">\n        <i class=\"fab fa-dropbox\"><\/i>\n      <\/div>\n      <div class=\"btn upload-option-btn\" id=\"gdrive-btn\" style=\"font-size:26px;\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Upload from Google Drive\">\n        <i class=\"fab fa-google-drive\"><\/i>\n      <\/div>\n    <\/div>\n    <div id=\"cancel-uploader\" class=\"btn btn-default btn-modal\" style=\"color:darkgrey\">Cancel<\/div>\n  <\/div>\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"pdf-upload-process\" style=\"display: none;\">\n  <h4 id=\"upload-progress-status\" style=\"text-align: center;padding-top: 20px;\">Uploading....<\/h4>\n  <div class=\"row\">\n    <div class=\"upload js-progress-bars\" id=\"progress-bar\" class=\"col-md-10 col-md-offset-1\" style=\"border:none;margin: 10px auto;\">\n      <div class=\"progress active\" style=\"height: 20px;border:none;\">\n        <div id=\"upload-job-progress\" class=\"bar progress-bar\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 0%;\"><\/div>\n      <\/div>\n    <\/div>\n  <\/div>\n  <form id=\"merge-info-form\" style=\"text-align:center;\">\n    <div style=\"padding-top: 10px;padding-bottom: 30px;\">\n      <span style=\"font-size:16px;\">Merge this file(s)<\/em><\/span>\n      <select id=\"before-after-select\" name=\"before-after\" style=\"margin-bottom: 0px;vertical-align: initial;\">\n        <option value=\"0\">before<\/option>\n        <option value=\"1\" selected>after<\/option>\n      <\/select>\n      <span style=\"font-size:16px;margin-left:5px;\">page <select id=\"page-number-select\" name=\"page-number\" style=\"margin-bottom: 0px;vertical-align: initial;\"><\/select><\/span>\n    <\/div>\n    <div class=\'btn btn-default\' href=\'#\' id=\"cancel-s3-upload\">Cancel<\/div>\n    <div id=\"confirm-merge-btn\" class=\"btn btn-green\" style=\"display:none;margin-left:20px;font-size:20px;border-radius:4px;\">Merge<\/div>\n  <\/form>\n  <div class=\"row\">\n    <div class=\"col-md-12\" style=\"margin-bottom:1px;\">\n    <\/div>\n  <\/div>\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"merge-loading\" style=\"display: none;\">\n  <div style=\'text-align:center;padding: 35px;\'>\n    <div style=\"font-size:20px;margin-bottom:10px;\"><b>Merging<\/b><\/div>\n    <div><span class=\"fas fa-sync fa-spin fa-4x fa-fw\" style=\"display:inline-block;\"><\/span><\/div>\n  <\/div>\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"upload-error-message\" style=\"display: none;\">\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"merge-error-message\" style=\"display: none;\">\n  <div style=\'text-align:center;padding: 35px;\'>\n    <p>Your files failed to merge. Please try again.<\/p>\n    <div id=\'merge-error-cancel\' class=\'btn btn-default\'>Close<\/div>\n  <\/div>\n<\/div>\n<div class=\"col-sm-12 checkout-padding\" id=\"merge-password-error-message\" style=\"display: none;\">\n  <div style=\'text-align:center;padding: 35px;\'>\n    <p>One of your files is password protected. Please remove the password before merging this file.<\/p>\n    <div id=\'merge-password-error-cancel\' class=\'btn btn-default\'>Close<\/div>\n  <\/div>\n<\/div>\n\n<script type=\"text/javascript\">\n  var uploadCancelled = false;\n  var allFilesFinished = {};\n  var uploadPercentage = 0;\n  \$(\'#pdf-upload-process\').hide();\n  \$(\'#upload-error-message\').hide();\n  \$(\'#merge-error-message\').hide();\n  \$(\'#merge-password-error-message\').hide();\n  \$(\'#merge-loading\').hide();\n  var originalProFileId = \"422c78d3265340780c2f\";\n  var inputFileHash;\n  var allowedChars = /^[A-Za-z0-9.\\-+\\(\\)\\_\\[\\]\\s]+\$/;\n  var multiselect = true;\n  var filetypes = [\'.pdf\'];\n\n  \$(\"#computer-btn\").on(\'click\', function() {\n    \$(\".upload-option-btn\").removeClass(\"active\");\n    \$(\"#computer-btn\").addClass(\"active\");\n    \$(\"#dropbox-div\").hide();\n    \$(\"#gdrive-div\").hide();\n    \$(\".uploader-div\").show();\n  });\n\n  \$(\"#dropbox-btn\").on(\'click\', function() {\n    \$(\".upload-option-btn\").removeClass(\"active\");\n    \$(\"#dropbox-btn\").addClass(\"active\");\n    \$(\".uploader-div\").hide();\n    \$(\"#gdrive-div\").hide();\n    \$(\"#dropbox-div\").show();\n  });\n\n  \$(\"#gdrive-btn\").on(\'click\', function() {\n    \$(\".upload-option-btn\").removeClass(\"active\");\n    \$(\"#gdrive-btn\").addClass(\"active\");\n    \$(\".uploader-div\").hide();\n    \$(\"#dropbox-div\").hide();\n    \$(\"#gdrive-div\").show();\n  });\n\n  \$(function () {\n    \$(\'.upload-option-btn\').tooltip();\n  });\n\n  queryForUpload = function(job_id, random_id) {\n    \$.ajax({\n      url: \"/input_files/\" + job_id + \"/upload_percentage\",\n      type: \"GET\",\n      dataType: \"json\"\n    }).success(function(data) {\n      if (data[\'percentage_done\'] == 100) {\n        allFilesFinished[random_id] = true;\n        var allTrue = true;\n        for(var fileId in allFilesFinished) {\n          if(!allFilesFinished[fileId])  {\n            allTrue = false;\n            break;\n          }\n        }\n        var input_job_id = data[\'unique_id\'];\n        var input_job_url = data[\'url\'];\n        if (allTrue) {\n          \$(\'.bar\').attr(\'style\', \'width: 100%;\');\n          inputFileHash[input_job_id] = input_job_url;\n          \$(\"#confirm-merge-btn\").show();\n        } else {\n          inputFileHash[input_job_id] = input_job_url;\n          uploadPercentage = uploadPercentage + ((100 - uploadPercentage)/2);\n          var thisStyle = \'width: \' + uploadPercentage + \'%;\';\n          \$(\'.bar\').attr(\'style\', thisStyle);\n        }\n      } else if (data[\'percentage_done\'] == 0) {\n        allFilesFinished[random_id] = true;\n        if (uploadCancelled) {\n          uploadCancelled = false;\n        } else {\n          \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>Your file failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n          \$(\'#pdf-upload-process\').hide();\n          \$(\'#upload-form\').hide();\n          \$(\'#upload-error-message\').show();\n          \$(\'#upload-error-cancel\').on(\'click\', function() {\n            \$(\'#upload-error-message\').hide();\n            \$(\"#confirm-merge-btn\").hide();\n            \$(\'.uploader-div\').show();\n            \$(\".upload-option-btn\").removeClass(\"active\");\n            \$(\"#computer-btn\").addClass(\"active\");\n            \$(\'#upload-form\').show();\n          });\n        };\n      } else {\n        if (uploadCancelled) {\n          allFilesFinished[random_id] = true;\n          uploadCancelled = false;\n        } else {\n          setTimeout(function(){queryForUpload(job_id, random_id)}, 1000);\n        }\n      }\n    }).error(function(data) {\n      allFilesFinished[random_id] = true;\n      if (uploadCancelled) {\n        uploadCancelled = false;\n      } else {\n        \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>Your file failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n        \$(\'#pdf-upload-process\').hide();\n        \$(\'#upload-form\').hide();\n        \$(\'#upload-error-message\').show();\n        \$(\'#upload-error-cancel\').on(\'click\', function() {\n          \$(\'#upload-error-message\').hide();\n          \$(\"#confirm-merge-btn\").hide();\n          \$(\'.uploader-div\').show();\n          \$(\".upload-option-btn\").removeClass(\"active\");\n          \$(\"#computer-btn\").addClass(\"active\");\n          \$(\'#upload-form\').show();\n        });\n      };\n    });\n  };\n\n  \$(\"#dropbox-chooser\").on(\'click\', function(e) {\n    e.preventDefault();\n    Dropbox.choose({\n      success: function(files) {\n        uploadCancelled = false;\n        \$(\"#upload-progress-status\").html(\"Uploading....\");\n        var pageNumberOptions;\n        for (i= 0; i < \$pdfCanvas.PDFViewer(\"pageNumbers\").length; i++) {\n          if (i == (\$pdfCanvas.PDFViewer(\"pageNumbers\").length - 1)) {\n            pageNumberOptions += \"<option value=\" + (i+1) + \" selected>\" + (i+1) + \"<\/option>\"\n          } else {\n            pageNumberOptions += \"<option value=\" + (i+1) + \">\" + (i+1) + \"<\/option>\"\n          }\n        }\n        \$(\"#page-number-select\").html(pageNumberOptions);\n        inputFileHash = {};\n        \$(\'#upload-form\').hide();\n        \$(\'#dropbox-div\').hide();\n        \$(\'#upload-job-progress\').attr(\'style\', \"width: 0%;\");\n        \$(\'#pdf-upload-process\').show();\n        \$.each(files, function(idx, elem){\n          var randomId = Math.uuid(8).toLowerCase();\n          allFilesFinished[randomId] = false;\n          elem[\"randomId\"] = randomId;\n        });\n        \$.each(files, function(idx, elem){\n          \$.ajax({\n            url: \"/input_files/create_from_dropbox\",\n            dataType: \"json\",\n            type: \"POST\",\n            data: {file: elem, pro_file_id: originalProFileId}\n          }).success(function(data) {\n            queryForUpload(data[\'unique_id\'], data[\"random_id\"])\n          }).error(function(data) {\n            allFilesFinished[data[\"unique_id\"]] = true;\n\n            if (uploadCancelled) {\n              uploadCancelled = false;\n            } else {\n              \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>\" + elem[\'name\'] + \" failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n              \$(\'#pdf-upload-process\').hide();\n              \$(\'#upload-form\').hide();\n              \$(\'#upload-error-message\').show();\n              \$(\'#upload-error-cancel\').on(\'click\', function() {\n                \$(\'#upload-error-message\').hide();\n                \$(\"#confirm-merge-btn\").hide();\n                \$(\'#dropbox-div\').show();\n                \$(\'#upload-form\').show();\n              });\n            };\n          });\n        });\n      },\n      linkType: \"direct\",\n      multiselect: multiselect,\n      extensions: filetypes,\n      folderselect: false,\n      sizeLimit: 104900000\n    });\n  });\n\n  var developerKey = \'AIzaSyDJRX64VXFMR4u1mKnzXAYKo52utTQ8co4\';\n  var clientId = \"975217039210-vapghe3a6kiutikrjspehs1579be5vl3.apps.googleusercontent.com\"\n  var pickerApiLoaded = false;\n  var oauthToken;\n  var gdClientInit = false;\n\n  function loadPicker() {\n    gapi.load(\'auth2\');\n    gapi.load(\'picker\');\n    gapi.load(\'client:auth2\');\n  }\n\n  function onAuthApiLoad() {\n    oauthToken = getCookie(\"gdOauthToken\");\n    if (oauthToken) {\n      createPicker();\n    } else {\n      window.gapi.auth2.authorize(\n      {\n        \'client_id\': clientId,\n        \'scope\': \'https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/drive.file\'\n      },\n      handleAuthResult);\n    }\n  }\n\n  function onPickerApiLoad() {\n    pickerApiLoaded = true;\n    createPicker();\n  }\n\n  function handleAuthResult(authResult) {\n    if (authResult && !authResult.error) {\n      var cookieDate = new Date();\n      cookieDate.setTime(cookieDate.getTime() + (2640000));\n      var cookieExpires = \"; expires=\" + cookieDate.toUTCString();\n      document.cookie = \"gdOauthToken=\" + (authResult.access_token || \"\")  + cookieExpires + \"; SameSite=None; path=/;secure\";\n      oauthToken = authResult.access_token;\n      createPicker();\n    }\n  }\n\n  function createPicker() {\n    if (pickerApiLoaded && oauthToken) {\n      var view = new google.picker.View(google.picker.ViewId.DOCS);\n      var picker;\n      if (multiselect) {\n        picker = new google.picker.PickerBuilder().enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setAppId(\"975217039210\").setOAuthToken(oauthToken).addView(view).addView(new google.picker.DocsUploadView()).setDeveloperKey(developerKey).setCallback(pickerCallback).build();\n      } else {\n        picker = new google.picker.PickerBuilder().setAppId(\"975217039210\").setOAuthToken(oauthToken).addView(view).addView(new google.picker.DocsUploadView()).setDeveloperKey(developerKey).setCallback(pickerCallback).build();\n      }\n      picker.setVisible(true);\n    }\n  }\n\n  function gdriveUpload(data, idx, elem) {\n    gdClientInit = true;\n    var request = gapi.client.drive.files.get({\n      \'fileId\': data.docs[idx].id,\n      \'fields\': \'size\'\n    });\n    request.then(function(resp) {\n      if (resp.result.size > 104900000) {\n        postFailedUpload(elem[\'name\'], resp.result.size, \'over filesize limit\');\n        swal({   \n          title: \"Error with \" + elem[\'name\'] + \": maximum file size is 100MB\", \n          type: \"error\",\n          confirmButtonColor: \"#4cae4c\"\n        });\n        allFilesFinished[elem[\'randomId\']] = true;\n        if (uploadCancelled) {\n          uploadCancelled = false;\n        } else {\n          \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>\" + elem[\'name\'] + \" failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n          \$(\'#pdf-upload-process\').hide();\n          \$(\'#upload-form\').hide();\n          \$(\'#upload-error-message\').show();\n          \$(\'#upload-error-cancel\').on(\'click\', function() {\n            \$(\'#upload-error-message\').hide();\n            \$(\"#confirm-merge-btn\").hide();\n            \$(\'#gdrive-div\').show();\n            \$(\'#upload-form\').show();\n          });\n        };\n      } else {\n        \$.ajax({\n          url: \"/input_files/create_from_gdrive\",\n          dataType: \"json\",\n          type: \"POST\",\n          data: {file: data.docs[idx], url: \"\", token: oauthToken, pro_file_id: originalProFileId}\n        }).success(function(data) {\n          queryForUpload(data[\'unique_id\'], data[\"random_id\"])\n        }).error(function(data) {\n          allFilesFinished[data[\"unique_id\"]] = true;\n\n          if (uploadCancelled) {\n            uploadCancelled = false;\n          } else {\n            \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>Your file failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n            \$(\'#pdf-upload-process\').hide();\n            \$(\'#upload-form\').hide();\n            \$(\'#upload-error-message\').show();\n            \$(\'#upload-error-cancel\').on(\'click\', function() {\n              \$(\'#upload-error-message\').hide();\n              \$(\"#confirm-merge-btn\").hide();\n              \$(\'#gdrive-div\').show();\n              \$(\'#upload-form\').show();\n            });\n          };\n          return false;\n        });\n      }\n    });\n  }\n\n  function pickerCallback(data) {\n    if (data.action == google.picker.Action.PICKED) {\n      uploadCancelled = false;\n      \$(\"#upload-progress-status\").html(\"Uploading....\");\n      var pageNumberOptions;\n      for (i= 0; i < \$pdfCanvas.PDFViewer(\"pageNumbers\").length; i++) {\n        if (i == (\$pdfCanvas.PDFViewer(\"pageNumbers\").length - 1)) {\n          pageNumberOptions += \"<option value=\" + (i+1) + \" selected>\" + (i+1) + \"<\/option>\"\n        } else {\n          pageNumberOptions += \"<option value=\" + (i+1) + \">\" + (i+1) + \"<\/option>\"\n        }\n      }\n      \$(\"#page-number-select\").html(pageNumberOptions);\n      inputFileHash = {};\n      \$(\'#upload-form\').hide();\n      \$(\'#gdrive-div\').hide();\n      \$(\'#upload-job-progress\').attr(\'style\', \"width: 0%;\");\n      \$(\'#pdf-upload-process\').show();\n      \$.each(data.docs, function(idx, elem){\n        var randomId = Math.uuid(8).toLowerCase();\n        allFilesFinished[randomId] = false;\n        elem[\"randomId\"] = randomId;\n      });\n      \$.each(data.docs, function(idx, elem){ \n        if (checkWhiteList(elem[\'name\'], filetypes)) {\n          if (gdClientInit) {\n            gdriveUpload(data, idx, elem);\n          } else {\n            gapi.client.init({\n              apiKey: developerKey,\n              clientId: clientId,\n              discoveryDocs: [\"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest\"],\n              scope: \'https://www.googleapis.com/auth/drive.readonly\'\n            }).then(function() {\n              gdriveUpload(data, idx, elem);\n            });\n          }\n        } else {\n          postFailedUpload(elem[\'name\'], 0, \'unsupported filetype\');\n          swal({   \n            title: elem[\'name\'] + \": file type is not supported.\",\n            type: \"error\",\n            confirmButtonColor: \"#4cae4c\"\n          });\n          allFilesFinished[elem[\'randomId\']] = true;\n          if (uploadCancelled) {\n            uploadCancelled = false;\n          } else {\n            \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>\" + elem[\'name\'] + \" failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n            \$(\'#pdf-upload-process\').hide();\n            \$(\'#upload-form\').hide();\n            \$(\'#upload-error-message\').show();\n            \$(\'#upload-error-cancel\').on(\'click\', function() {\n              \$(\'#upload-error-message\').hide();\n              \$(\"#confirm-merge-btn\").hide();\n              \$(\'#gdrive-div\').show();\n              \$(\'#upload-form\').show();\n            });\n          };\n        }\n      });\n    }\n  }\n\n  \$(\"#gdrive-chooser\").on(\'click\', function(e) {\n    e.preventDefault();\n    onAuthApiLoad();\n    onPickerApiLoad();\n  });\n\n  \$(\"#s3-uploader\").S3Uploader({\n    allow_multiple_files: true,\n    progress_bar_target: \$(\'.js-progress-bars\'),\n    remove_completed_progress_bar: false,\n    before_add: function(file) {\n      if (file.size > 104900000) {\n        postFailedUpload(file.name, file.size, \'over pdf filesize limit\');\n        \$(\"#confirm-merge-btn\").hide();\n        \$(\'#upload-form\').show();\n        \$(\'#pdf-upload-process\').hide();\n        swal({   \n          title: \"Maximum file size is 100MB\", \n          type: \"error\",\n          confirmButtonColor: \"#4cae4c\"\n        });\n        return false;\n      } else if (file.name.match(/^[0-9a-zA-Z\\s\\\$\\-\\_\\.\\+\\!\\*\\\'\\(\\)]{1,}\$/)){ \n        if (checkWhiteList(file.name, [\'.pdf\'])) {\n          if (file.size > 2000000) {\n            \$(\"#upload-progress-status\").append(\"<div id=\'upload-size-warning\'><br><h5><em>The pdf you uploaded is greater than 2MB, this can take longer to upload.<br>Please be patient.<\/em><\/h5><\/div>\");\n          } else {\n            \$(\"#upload-progress-status\").html(\"Uploading....\");\n          }\n          \n          var pageNumberOptions;\n          for (i= 0; i < \$pdfCanvas.PDFViewer(\"pageNumbers\").length; i++) {\n            if (i == (\$pdfCanvas.PDFViewer(\"pageNumbers\").length - 1)) {\n              pageNumberOptions += \"<option value=\" + (i+1) + \" selected>\" + (i+1) + \"<\/option>\"\n            } else {\n              pageNumberOptions += \"<option value=\" + (i+1) + \">\" + (i+1) + \"<\/option>\"\n            }\n          }\n          \$(\"#page-number-select\").html(pageNumberOptions);\n          inputFileHash = {};\n          \$(\'#upload-form\').hide();\n          \$(\'#upload-job-progress\').attr(\'style\', \"width: 0%;\");\n          \$(\'#pdf-upload-process\').show();\n          allFilesFinished[file.unique_id] = false;\n          return true;\n        } else {\n          postFailedUpload(file.name, file.size, \'not pdf filetype\');\n          swal({   \n            title: \"The file you uploaded is not a pdf.\", \n            type: \"error\",\n            confirmButtonColor: \"#4cae4c\"\n          });\n          return false;\n        }\n      } else {\n        swal({   \n          title: \"This filename is not allowed - please remove characters that are not standard numbers 0-9, latin alphabet A-Z, or characters: \$, -, _, ., +, !, *, \', (, )\", \n          type: \"error\",\n          confirmButtonColor: \"#4cae4c\"\n        });\n        return false;\n      } \n    },\n    additional_data: {pro_file_id: originalProFileId}\n  });\n\n  \$(\'#s3-uploader\').bind(\"s3_upload_failed\", function (e, content) {\n    allFilesFinished[content.unique_id] = true;\n    if (uploadCancelled) {\n      uploadCancelled = false;\n    } else {\n      postFailedUpload(content.filename, content.filesize, \"error uploading to s3: \" + content.error_thrown);\n      \$(\"#upload-error-message\").html(\"<div style=\'text-align:center;padding: 35px;\'><p>\" + content.filename + \" failed to upload. Please try again.<\/p><div id=\'upload-error-cancel\' class=\'btn btn-default\'>Close<\/div><\/div>\");\n      \$(\'#pdf-upload-process\').hide();\n      \$(\'#upload-form\').hide();\n      \$(\'#upload-error-message\').show();\n      \$(\'#upload-error-cancel\').on(\'click\', function() {\n        \$(\'#upload-error-message\').hide();\n        \$(\"#confirm-merge-btn\").hide();\n        \$(\".upload-option-btn\").removeClass(\"active\");\n        \$(\"#computer-btn\").addClass(\"active\");\n        \$(\'.uploader-div\').show();\n        \$(\'#upload-form\').show();\n      });\n    };\n  });\n\n  \$(\'#s3-uploader\').bind(\"s3_uploads_complete\", function (e, content) {\n    allFilesFinished = { \"all\": true };\n  });\n\n  \$(\'#s3-uploader\').bind(\"s3_upload_complete\", function (e, content) {\n    allFilesFinished[content.unique_id] = true;\n  });\n\n  \$(\"#cancel-s3-upload\").on(\'click\', function() {\n    uploadCancelled = true;\n    window.stop();\n    \$(\'#pdf-upload-process\').hide();\n    if (\$(\'#upload-size-warning\').length) {\n      \$(\'#upload-size-warning\').remove();\n    };\n    \$(\"#confirm-merge-btn\").hide();\n    \$(\".upload-option-btn\").removeClass(\"active\");\n    \$(\"#computer-btn\").addClass(\"active\");\n    \$(\'.uploader-div\').show();\n    \$(\'#upload-form\').show();\n  });\n\n  checkWhiteList = function(name, exts) {\n    var lowercaseName = name.toLowerCase();\n    return (new RegExp(\'(\' + exts.join(\'|\').replace(/\\./g, \'\\\\.\') + \')\$\')).test(lowercaseName);\n  };\n\n  function postFailedUpload(name, size, errorMessage) {\n    extension = name.split(\'.\').pop();\n    \$.ajax({\n      url: \"/failed_uploads\",\n      type: \"POST\",\n      data: { failed_upload: {name: name, extension: extension, size: size, error: errorMessage}},\n      dataType: \"json\"\n    });\n  };\n\n  \$(\"#confirm-merge-btn\").on(\"click\", function() {\n    var mergeFormData = \$(\"#merge-info-form\").serializeArray();\n    var mergeData = {};\n    for (var i in mergeFormData) {\n      if (mergeFormData[i].name) {\n        mergeData[mergeFormData[i].name] = mergeFormData[i].value;\n      }\n    }\n    \$(\"#pdf-upload-process\").hide();\n    \$(\"#merge-loading\").show();\n    \$pdfCanvas.PDFViewer(\"addMergeFiles\", inputFileHash, mergeData[\"before-after\"], mergeData[\"page-number\"]);\n  });\n  \n  \$(\"#cancel-uploader\").on(\'click\', function() {\n    \$(\'#new-surface\').activeEditor(\'mode\',\'TRANSFORM\');\n  });\n\n  \$(\"#merge-error-cancel\").on(\'click\', function() {\n    \$(\"#merge-error-message\").hide();\n    \$(\"#sortable-parent\").show();\n  });\n\n  \$(\"#merge-password-error-cancel\").on(\'click\', function() {\n    \$(\"#merge-password-error-message\").hide();\n    \$(\"#sortable-parent\").show();\n  });\n<\/script>\n<script type=\"text/javascript\" src=\"https://apis.google.com/js/api.js?onload=loadPicker\"><\/script>");
    $("#sortable-parent").hide();
    $("#merge-master").show();
  });

  // Add handlers:
  $('#new-surface').bind('changeMode', onModeChange);
  $('#new-surface').bind('selectElement', onEditorSelectElement);
  $('#new-surface').bind('focusElement', onEditorFocusElement);

  $('#new-surface').bind('changeToolSettings', updateToolbars);
  $('#new-surface').bind('changeToolBar', updateToolbar);

  // Initialize active editor:
  $('#new-surface').activeEditor({mode:'TEXT',
                  images:documentImages,
                  signatures:documentSignatures,
                  initials: documentInitials});

  // ========= Image and signature modals =========

  $('#image-modal').on('click', 'div.use:not(.disabled)', function(e) {
    var imageID = $(this).attr('data-id');
    var imageURL = $(this).attr('data-url');
    $('#new-surface').activeEditor('image', {id:imageID, url:imageURL});
    $('#image-modal').modal('hide');
  });

  $('#signature-modal').on('click', 'div.use:not(.disabled)', function(e) {
    var signatureID = $(this).attr('data-id');
    if ($(this).attr('data-url')) {
      var signatureURL = $(this).attr('data-url');
      var signatureWidth = $(this).find("img").css("width");
      var signatureHeight = $(this).find("img").css("height");
      $('#new-surface').activeEditor('signature', {id:signatureID, type:'image', value:signatureURL, width: signatureWidth, height: signatureHeight});
    } else if ($(this).attr('data-text')) {
      var signatureText = $(this).attr('data-text');
      var signatureFont = $(this).attr('data-font');
      var signatureColor = $(this).attr('data-color');
      $('#new-surface').activeEditor('signature', {id:signatureID, type:'text', value:signatureText, font:signatureFont, color: signatureColor});
    } else if ($(this).attr('data-pathimage')) {
      var signatureText = $(this).attr('data-pathimage');
      $('#new-surface').activeEditor('signature', {id:signatureID, type:'path', value:signatureText, width: 600, height: 150});
    } else {
      var signatureData = $(this).attr('data-paths');
      var signatureWidth = $(this).attr('data-width');
      var signatureHeight = $(this).attr('data-height');
      $('#new-surface').activeEditor('signature', {id:signatureID, type:'drawing', value:signatureData, width: signatureWidth, height: signatureHeight});
    }

    $('#signature-modal').modal('hide');
  });

  $('#initials-modal').on('click', 'div.use:not(.disabled)', function(e) {
    var initialsID = $(this).attr('data-id');
    if ($(this).attr('data-url')) {
      var initialsURL = $(this).attr('data-url');
      var initialsWidth = $(this).find("img").css("width");
      var initialsHeight = $(this).find("img").css("height");
      $('#new-surface').activeEditor('initial', {id:initialsID, type:'image', value:initialsURL, width: initialsWidth, height: initialsHeight});
    } else if ($(this).attr('data-text')) {
      var initialsText = $(this).attr('data-text');
      var initialsFont = $(this).attr('data-font');
      var initialsColor = $(this).attr('data-color');
      $('#new-surface').activeEditor('initial', {id:initialsID, type:'text', value:initialsText, font:initialsFont, color: initialsColor});
    } else {
      var initialsText = $(this).attr('data-pathimage');
      $('#new-surface').activeEditor('initial', {id:initialsID, type:'path', value:initialsText, width: 600, height: 150});
    }

    $('#initials-modal').modal('hide');
  });

  $('#image-modal, #signature-modal, #initials-modal').on('click', '.close', function(e) {
    if (!formsEnabled) {
      $('#new-surface').activeEditor('mode','TRANSFORM');
    }
  });

  $('#image-modal, #signature-modal, #initials-modal').on('click', '.cancel-modal', function(e) {
    if (!formsEnabled) {
      $('#new-surface').activeEditor('mode','TRANSFORM');
    }
  });

  $('#sig-field-clear').on('click', function(e) {
    $('#new-surface').activeEditor('clearSigFieldType');
  });

  $('#signature-modal, #initials-modal').on('click', '.clear-field-btn', function(e) {
    $('#new-surface').activeEditor('clearSigFieldType');
  });

  $('.document-save-button').click(function(e){
    saveDocument("showPopup");
  });

  $('#undo-btn').click(function(e){
    undo();
  });

  $('#redo-btn').click(function(e){
    redo();
  });

  $("#document-title-edit-button").on('click', function() {
    $('#document-title-group').hide();
    $('#document-title-edit-group').show();
  });

  $("#add-pages-btn").on('click', function() {
    swal({
      title: "Are you sure you want to add a blank page to this PDF?",
      type: "warning",
      showCancelButton: true,
      confirmButtonColor: "#4cae4c",
      confirmButtonText: "OK",
      cancelButtonText: "Cancel",
      closeOnConfirm: true,
      closeOnCancel: true },
      function(isConfirm){
      if (isConfirm) {
        var currentPageCount =  $pdfCanvas.PDFViewer("pageCount");
        currentPageCount++;
        $pdfCanvas.PDFViewer("setPageCount", currentPageCount);
        lastPageNumber++;
        $pdfCanvas.PDFViewer("pageNumbers").push(lastPageNumber);
        $( "#sortable" ).append("<li class='ui-state-default grabbable reorder-item ui-sortable-handle' id='original_index_" + lastPageNumber + "' data-ordered-page=" + currentPageCount + "' data-original-page='" + lastPageNumber + "'><div class='page-delete' id='delete_" + lastPageNumber + "'><span class='fas fa-times close' style='top:0px;font-size:16px;opacity:0.5px'></span></div><div id='sortable_" + lastPageNumber + "' class='thumb_element' data-page-idx='" + lastPageNumber + "' style='padding: 5px 18px;display: table-cell;vertical-align: middle;'><div style='display: table-cell;vertical-align: middle;position: relative;height:" + tbHeight +"px;'><canvas id='sortable_canvas_" + lastPageNumber + "' style='box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);border: 1px solid #e1e1e;height:" + tbHeight +"px;' class='lozad page-canvas deg-0' data-rotation='0' height='550' width='388'></canvas><div id='active-editor-" + lastPageNumber + "' class='active-editor' style='height: 200px;position: absolute;top: 0px;width: 100%;'><div class='active-layer'></div></div></div><div class='btn-group' role='group' aria-label='rotate' style='margin: 0 auto;display: table;'><button type='button' class='btn'style='border: 1px solid #ccc;' data-degrees='-90'><i class='fas fa-undo'></i></button><button type='button' class='btn' style='border: 1px solid #ccc;' data-degrees='90'><i class='fas fa-redo'></i></button></div><div class='reorder-number' style='float:left;width:100%;font-size:14px;font-weight:bold;padding-top:5px;'>Page " + currentPageCount + "</div></div><input type='hidden' value='" + lastPageNumber + "' class='reorder-index'></li>");
        $("#active-editor-" + lastPageNumber).tbDisplay();
        lozadSort.observe();
        // $pdfCanvas.PDFViewer("renderThumbnail", "sortable_canvas_", currentPageCount, false);
        var thisCanvas = $("#sortable_canvas_" + lastPageNumber);
        tbSizes[lastPageNumber] = "h";
        // thisCanvas.css("height", $('#slider').slider("option", "value"));
        addToUndoArray("blank_page", lastPageNumber, null);
        pageHeights[lastPageNumber] = 842;
        pageWidths[lastPageNumber] = 595;
        $("#delete_" + lastPageNumber).on('click', function() {
          if($("#sortable li").length == 1) {
            //todo delete all pages
          } else {
            var pagePosition = ($(this)[0].id).substring(7);
            addToUndoArray("delete", parseInt(pagePosition), [$("#original_index_" + pagePosition).data('orderedPage'), $("#sortable_canvas_" + pagePosition).data('rotation')]);
            deletePage(pagePosition);
            pageCount = $pdfCanvas.PDFViewer("pageCount");
            $pdfCanvas.PDFViewer("setPageCount", (pageCount - 1));
            correctSortablePageNumbers();
          }
        });
        $("#original_index_" + lastPageNumber + " button").on("click", function(){
          var degreeChange = parseInt($(this).attr('data-degrees'));
          var page = ($(this)[0].closest("li").id).substring(15);
          $(this).closest(".thumb_element").find("canvas").each(function(){
            var newDegrees = (degreeChange % 360 + 360 + parseInt($(this).attr('data-rotation'))) % 360;
            $(this).attr('data-rotation', newDegrees);
            $(this).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + newDegrees);
            rotatedPages[page] = newDegrees;
            if ((newDegrees == 90) || (newDegrees == 270)) {
              $(this).parent().css("width", $("#sortable_canvas_" + page).height());
            } else {
              $(this).parent().css("width", $("#sortable_canvas_" + page).width());
            }
            // $("#thumb_canvas_" + thisPageNumber).removeClass('deg-90').removeClass('deg-180').removeClass('deg-270').removeClass('deg-0').addClass('deg-' + newDegrees);
            if (parseInt(page) in documentData["pages"]) {
              // todo update form fields
              $("#active-editor-" + page).tbDisplay("renderJSON", documentData.pages[parseInt(page)].elements, $("#active-editor-" + page).find(".active-layer"), parseInt(page), true);
            }
          });
          addToUndoArray("rotate", page, degreeChange);
        });
        $('#new-surface').activeEditor('mode','TRANSFORM');
      }
    });
  });

  $('[contenteditable]').on('paste',function(e) {
    setTimeout(function () {
      writeJSON();
      readJSON();
    }, 100);

       //  if ($(".text-transformer-text-element").is(':empty')) {
       //   e.preventDefault();
       //   var text = (e.originalEvent || e).clipboardData.getData('text/html');
        //   // console.log(text);
        //   var $result = $('<div></div>').append($(text));
        //   $result.children('style').remove();
        //   $result.children('meta').remove();
        //   $result.children('link').remove();

        //   var d = $result[0].innerText;
          // if (!d || d.length == 0) {
          //   return false;
          // }
          // var c = d.replace(/\r/g, "");
          // var a = c.split("\n");
          // for (var b = 0; b < a.length; ++b) {
          //    // console.log(a[b]);
          // }
          // // return a.join("\n")

        //   $(this).html(a.join("\n"));
       //  } else {

        //   var text = (e.originalEvent || e).clipboardData.getData('text/html');
        //   // console.log(text);
        //   var $result = $('.text-transformer-text-element').append($(text));
        //   $result.children('style').remove();
        //   $result.children('meta').remove();
        //   $result.children('link').remove();
        //   console.log($result);

        //   var d = $result[0].innerText;
          // if (!d || d.length == 0) {
          //   return false;
          // }
          // var c = d.replace(/\r/g, "");
          // var a = c.split("\n");
          // for (var b = 0; b < a.length; ++b) {
          //    // console.log(a[b]);
          // }
          // // return a.join("\n")

        //   $(this).html($result.html());
        // }

        // $(this).html(text);
        // $(this).children('style').remove();
        // $(this).children('meta').remove();
        // $(this).children('link').remove();
        // console.log($(this).find("*"));
        // // replace all styles except bold and italic
        // $.each($(this).find("*"), function(idx, val) {
        //     var $item = $(val);
        //     // console.log($item);
        //     if ($(this).text() == "" || $(this).text() == " ") {
        //      $item.remove();
        //     } else if ($item.length > 0){
        //        console.log($(this).text());
        //        // var saveStyle = {
        //        //      'font-weight': $item.css('font-weight'),
        //        //      'font-style': $item.css('font-style')
        //        //  };
        //         $item.removeAttr('style').removeClass();
        //            // .css(saveStyle);
        //         // console.log($(this).text());
        //         // console.log($(this).find("*"));
        //         // $.each($(this).html(), function(innerIdx, innerVal) {
        //         //   var $innerItem = $(innerVal);

        //         //   console.log($innerItem);
        //         // });
        //         console.log(idx);
        //        if (idx == 1) {
        //          $item.replaceWith($(this).text());
        //        } else {
         //          $item.replaceWith(function(){
        //             return $("<div />", {html: $(this).text()});
        //         });
         //        }
        //     }
        // });

        // // remove unnecesary tags (if paste from word)
        // $(this).children('style').remove();
        // $(this).children('meta').remove()
        // $(this).children('link').remove();

  });
  $("#help-btn").on('click', function(){
    $("#helpModalTitle").text("PDF Pro editor guide");
    $("#helpModal").modal("show");
  });
    </script>

    <script type="text/javascript">
        var eraserModalShown = false;
        var textModalShown = false;
        var selectModalShown = false;

        var callWelcomeModel = function () {
            $("#helpModal").modal('show');
        };

        $(".switch-mode-whiteoutblock").on('click', function () {
            if (!eraserModalShown) {
                eraserModalShown = true;
                $("#eraserModal").modal("show");
            }
        });
        $("#editor-text-btn").on('click', function () {
            if (!textModalShown) {
                textModalShown = true;
                $("#textModal").modal("show");
            }
        });

        $("#editor-select-btn").on('click', function () {
            if (!selectModalShown && !thumbnailsView) {
                selectModalShown = true;
                $("#selectModal").modal("show");
            }
        });
    </script>
    <script type="text/javascript">
        $("#text-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#000000',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();
                $("#text-colorpicker").colorpicker("value", hexColor);
                updateTextSettings();
            }
        });

        $("#text-field-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#000000',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();
                $("#text-field-colorpicker").colorpicker("value", hexColor);
                updateTextFieldSettings();
            }
        });

        $("#text-field-back-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#text-field-back-colorpicker").colorpicker("value", hexColor);
                updateTextFieldSettings();
            }
        });

        $("#text-field-border-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#text-field-border-colorpicker").colorpicker("value", hexColor);
                updateTextFieldSettings();
            }
        });

        $("#date-field-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#000000',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();
                $("#date-field-colorpicker").colorpicker("value", hexColor);
                updateDateFieldSettings();
            }
        });

        $("#date-field-back-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#date-field-back-colorpicker").colorpicker("value", hexColor);
                updateDateFieldSettings();
            }
        });

        $("#date-field-border-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#date-field-border-colorpicker").colorpicker("value", hexColor);
                updateDateFieldSettings();
            }
        });

        $("#check-field-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#000000',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();
                $("#check-field-colorpicker").colorpicker("value", hexColor);
                updateCheckFieldSettings();
            }
        });

        $("#check-field-back-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#check-field-back-colorpicker").colorpicker("value", hexColor);
                updateCheckFieldSettings();
            }
        });

        $("#check-field-border-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#check-field-border-colorpicker").colorpicker("value", hexColor);
                updateCheckFieldSettings();
            }
        });

        $("#combo-field-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#000000',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();
                $("#combo-field-colorpicker").colorpicker("value", hexColor);
                updateComboFieldSettings();
            }
        });

        $("#combo-field-back-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#combo-field-back-colorpicker").colorpicker("value", hexColor);
                updateComboFieldSettings();
            }
        });

        $("#combo-field-border-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#combo-field-border-colorpicker").colorpicker("value", hexColor);
                updateComboFieldSettings();
            }
        });

        $("#shape-stroke-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            color: '#000000',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;

                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }

                $("#shape-stroke-colorpicker").colorpicker("value", hexColor);
                updateShapeSettings();
            }
        });

        $("#shape-fill-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;

                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }

                $("#shape-fill-colorpicker").colorpicker("value", hexColor);
                updateShapeSettings();
            }
        });

        $("#erase-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#ffffff',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();

                $("#erase-colorpicker").colorpicker("value", hexColor);
                updateEraseSettings();
            }
        });

        $("#highlight-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#ffff00',
            palette: [
                ["#ffff00", "#ff0000", "#00ff00", "#00bfff"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();

                $("#highlight-colorpicker").colorpicker("value", hexColor);
                updateHighlightSettings();
            }
        });

        $("#hyperlink-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;

                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }

                $("#hyperlink-colorpicker").colorpicker("value", hexColor);
                updateHyperlinkSettings();
            }
        });

        $("#symbol-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#000000',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();

                $("#symbol-colorpicker").colorpicker("value", hexColor);
                updateSymbolSettings();
            }
        });

        $("#signature-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#000000',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();

                $("#signature-colorpicker").colorpicker("value", hexColor);
                updateSignatureSettings();
            }
        });

        // $("#sig-field-colorpicker").spectrum({
        //   showPaletteOnly: true,
        //   togglePaletteOnly: true,
        //   togglePaletteMoreText: 'more',
        //   togglePaletteLessText: 'less',
        //   color: '#000000',
        //   palette: [
        //       ["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],
        //       ["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],
        //       ["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],
        //       ["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],
        //       ["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],
        //       ["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],
        //       ["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],
        //       ["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]
        //   ],
        //   change: function(color) {
        //     var hexColor = color.toHexString();

        //     $("#sig-field-colorpicker").colorpicker("value", hexColor);
        //     updateSigFieldSettings();
        //   }
        // });

        $("#sig-field-back-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#sig-field-back-colorpicker").colorpicker("value", hexColor);
                updateSigFieldSettings();
            }
        });

        $("#sig-field-border-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            allowEmpty: true,
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor;
                if (color) {
                    hexColor = color.toHexString();
                } else {
                    hexColor = "NONE";
                }
                $("#sig-field-border-colorpicker").colorpicker("value", hexColor);
                updateSigFieldSettings();
            }
        });

        $("#path-colorpicker").spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            togglePaletteMoreText: 'more',
            togglePaletteLessText: 'less',
            color: '#000000',
            palette: [
                ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
            ],
            change: function (color) {
                var hexColor = color.toHexString();

                $("#path-colorpicker").colorpicker("value", hexColor);
                updatePathSettings();
            }
        });

        $("#desktop-learn-more").on('click', function () {
            ga('send', 'pageview', '/editor-learn-more-btn', {
                'hitCallback': function () {
                    if (platform && platform.os.family == "OS X") {
                        ga('send', 'pageview', '/mac-editor-learn-more', {
                            'hitCallback': function () {
                                window.location.href = "/desktop/pdfexpert";
                            }
                        });
                    } else {
                        ga('send', 'pageview', '/win-editor-learn-more', {
                            'hitCallback': function () {
                                window.location.href = "/desktop/pdfpro";
                            }
                        });
                    }
                }
            });
        });

        $(function () {
            var dd = new DropDown($('#dd'), "TEXT");
            var tfdd = new DropDown($('#tfdd'), "TEXT_FIELD");
            var cfdd = new DropDown($('#cfdd'), "CHECK_FIELD");
            var dfdd = new DropDown($('#dfdd'), "DATE_FIELD");
            var cbdd = new DropDown($('#cbdd'), "COMBO_FIELD");
            $(document).click(function () {
                $('.wrapper-dropdown-3').removeClass('active');
            });
        });

        var checkForSaving = function () {
            if (saving) {
                return false;
            } else {
                writeJSON();
                return (lastSavedJson == JSON.stringify(documentData));
            }
        }

        var checkUserSaved = function (pfId, exportType) {
            if (checkForSaving()) {
                if (exportType == "dropbox") {
                    $.ajax({
                        url: "/files/" + pfId + "/export_dropbox",
                        type: "GET"
                    })
                } else {
                    window.location.href = "/files/" + pfId + "/download";
                }
            } else {
                saveDocument();
                $("#user-export-btn").click();
            }
        }

        $("#delete-locations").on('click', function () {
            var fromField = $("#pro_file_location").val();
            var toField = $("#pro_file_location2").val();

            if ((fromField == parseInt(fromField, 10).toString()) && (toField == parseInt(toField, 10).toString())) {
                if (parseInt(fromField) > 0) {
                    if (parseInt(fromField) <= parseInt(toField)) {
                        if (parseInt(toField) <= $pdfCanvas.PDFViewer("pageCount")) {
                            if ((parseInt(fromField) == 1) && (parseInt(toField) == parseInt($pdfCanvas.PDFViewer("pageCount")))) {
                                swal({ title: "You can not delete all pages of this PDF.", type: "error", confirmButtonColor: "#4cae4c" });
                            } else {
                                var delete_array = [];
                                var rotation_array = [];
                                var delete_range = _.range(parseInt(fromField), (parseInt(toField) + 1));
                                $("#sortable li").each(function (i) {
                                    if (delete_range.includes(parseInt($(this).attr("data-ordered-page")))) {
                                        var realPageNumber = parseInt($(this).attr("data-original-page"));
                                        delete_array.push(realPageNumber);
                                        rotation_array.push($(this).find("canvas").data('rotation'));
                                    }
                                });
                                for (var i = 0; i < delete_array.length; i++) {
                                    var pageNumberIndex = $pdfCanvas.PDFViewer("pageNumbers").indexOf(delete_array[i]);
                                    if (pageNumberIndex > -1) {
                                        $pdfCanvas.PDFViewer("pageNumbers").splice(pageNumberIndex, 1);
                                    }
                                    $('.reorder-item[data-original-page="' + delete_array[i] + '"]').remove();
                                }
                                addToUndoArray("delete_many", delete_array, [delete_range, rotation_array]);
                                $pdfCanvas.PDFViewer("setPageCount", $pdfCanvas.PDFViewer("pageNumbers").length);

                                correctSortablePageNumbers();
                            }
                        } else {
                            swal({ title: "Page to field cannot be more than total page count.", type: "error", confirmButtonColor: "#4cae4c" });
                        }
                    } else {
                        swal({ title: "Page to field can not be less than page from field.", type: "error", confirmButtonColor: "#4cae4c" });
                    }
                } else {
                    swal({ title: "First page number must be greater than 0.", type: "error", confirmButtonColor: "#4cae4c" });
                }
            } else {
                swal({ title: "Please enter two valid page numbers.", type: "error", confirmButtonColor: "#4cae4c" });
            }
        });
    </script>
}

    <link href="~/css/pdfEditor.css" rel="stylesheet" />



    <div class="container loaded-pdf-element" style="height: 100%; display: block;">
        <div id="pro-file-form-container">
            <form class="edit_pro_file" id="document-form" action="/files/422c78d3265340780c2f" accept-charset="UTF-8" data-remote="true" method="post">
                <input name="utf8" type="hidden" value="✓"><input type="hidden" name="_method" value="patch">
                <input type="hidden" name="merge_files" id="merge_files">
                <input id="document_data" value="{&quot;pages&quot;:{&quot;1&quot;:{&quot;elements&quot;:[{&quot;type&quot;:&quot;TEXT_FIELD&quot;,&quot;family&quot;:&quot;FORM_FIELD&quot;,&quot;style&quot;:{&quot;align&quot;:&quot;left&quot;,&quot;back_color&quot;:&quot;NONE&quot;,&quot;bold&quot;:false,&quot;border_color&quot;:&quot;NONE&quot;,&quot;border_style&quot;:&quot;solid&quot;,&quot;border_width&quot;:0,&quot;color&quot;:&quot;#000000&quot;,&quot;font&quot;:&quot;Helvetica&quot;,&quot;italic&quot;:false,&quot;max_len&quot;:0,&quot;multiline&quot;:false,&quot;password&quot;:false,&quot;pro&quot;:true,&quot;size&quot;:14,&quot;tool_tip&quot;:null,&quot;default&quot;:&quot;&quot;,&quot;field_name&quot;:&quot;TexthLg2A&quot;,&quot;tx_width&quot;:100,&quot;tx_height&quot;:25.333333333333332,&quot;para_width&quot;:100,&quot;para_height&quot;:75},&quot;transform&quot;:{&quot;x&quot;:465.3333333333333,&quot;y&quot;:189.0666666666667,&quot;width&quot;:100,&quot;height&quot;:25.333333333333332},&quot;content&quot;:{&quot;text&quot;:&quot;&quot;,&quot;default&quot;:&quot;&quot;,&quot;field_group&quot;:&quot;&quot;,&quot;field_name&quot;:&quot;TexthLg2A&quot;,&quot;full_name&quot;:&quot;TexthLg2A&quot;},&quot;id&quot;:&quot;hYuwcAdGem7tRA1&quot;,&quot;scale&quot;:0.25252525252525254,&quot;fromJson&quot;:true,&quot;rotation&quot;:0,&quot;pageHeight&quot;:792,&quot;pageWidth&quot;:612}],&quot;width&quot;:918,&quot;height&quot;:1188}},&quot;page_order&quot;:[],&quot;deleted_annots&quot;:{},&quot;rotated_pages&quot;:{},&quot;last_page_no&quot;:1,&quot;last_merge_no&quot;:0,&quot;deleted_fields&quot;:{},&quot;last_form_handles&quot;:{&quot;0&quot;:0},&quot;changed_order&quot;:false}" type="hidden" name="pro_file[content]">
                <input id="document_name" type="hidden" value="dummyform.pdf" name="pro_file[filename]">
                <input value="Editor" type="hidden" name="pro_file[process_type]" id="pro_file_process_type">
                <input type="hidden" value="422c78d3265340780c2f" name="pro_file[unique_id]" id="pro_file_unique_id">
                <input value="422c78d3265340780c2f" type="hidden" name="pro_file[id]" id="pro_file_id">
                <input value="36242177" type="hidden" name="pro_file[input_pro_file_id]" id="pro_file_input_pro_file_id">
                <div class="field new-fields">
                    <input type="hidden" name="document[page_count]" value="1">
                    <input type="hidden" name="document_signatures" id="document_signatures">
                    <input type="hidden" name="document_initials" id="document_initials">
                    <input type="hidden" name="document_images" id="document_images">
                    <input type="hidden" name="document[protect_settings]" id="document_protect_settings">
                </div>
            </form>
            <script type="text/javascript">
                var job_id;
            </script>
            <script type="text/javascript">
                job_id = "422c78d3265340780c2f";
                $(document).ready(function () {
                    $("#save-name-button").on('click', function () {
                        var newFilename = $("#document-name-input").val() + ".pdf"
                        if (newFilename != ".pdf") {
                            $.ajax({
                                url: "/files/" + job_id + "/update_filename",
                                type: "PUT",
                                data: { pro_file: { filename: newFilename } }
                            });
                            $('#document-title-edit-group').hide();
                            $("#document-title").text(newFilename);
                            $('#document-title-group').show();
                        } else if (newFilename == ".pdf") {
                            swal({ title: "Please enter a filename.", type: "error", confirmButtonColor: "#4cae4c" });
                        }
                    });
                });
                function sendForm() {
                    var thisData = $("form#document-form").serialize();
                    $.ajax({
                        method: "PUT",
                        url: "/files/" + job_id,
                        data: thisData
                    }).fail(function (jqXHR, textStatus) {
                        Offline.off("confirmed-down", function () { });
                        $("#save-btn").text("Save");
                        $("#save-export-display").hide();
                        $("#export-display").hide();
                        $("#save-failed-display").show();
                        if (savingTimeout) {
                            clearTimeout(savingTimeout);
                            savingTimeout = null;
                        }
                        saving = false;
                        if (!renderingPage) { $('.document-button').removeClass('disabled'); };
                        swal({ title: "Your file could not be saved, please check your internet connection and try again.", type: "error", confirmButtonColor: "#4cae4c" });
                    });
                    Offline.on("confirmed-down", function () {
                        if (saving) {
                            $("#save-btn").text("Save");
                            $("#save-export-display").hide();
                            $("#export-display").hide();
                            $("#save-failed-display").show();
                            if (savingTimeout) {
                                clearTimeout(savingTimeout);
                                savingTimeout = null;
                            }
                            saving = false;
                            if (!renderingPage) { $('.document-button').removeClass('disabled'); };
                            swal({ title: "Your file could not be saved, please check your internet connection and try again.", type: "error", confirmButtonColor: "#4cae4c" });
                        }
                    });
                }
            </script>
        </div>
        <div class="row" style="min-width: 1100px;height:40px;">
            <div id="document-toolbar" class="btn-toolbar top-toolbar clearfix" style="margin-bottom: 0px;padding-top:2px;height: 40px;">
                <div style="width: 105px;height: 38px;float: left;">
                    <img class="main-logo-editor" id="nav-logo-editor" alt="PDF Pro Online PDF Editor" src="/assets/PDF-Pro2-427d0e1dfb995de3014894e6ee218c3d1b3f1577b2275e50f7cabde1ee90c7ea.png">
                    <script type="text/javascript">
                        var saving = false;

                        var modalToMyFiles = function () {
                            swal({
                                title: "Your PDF has unsaved changes",
                                type: "warning",
                                showCancelButton: true,
                                confirmButtonColor: "#4cae4c",
                                confirmButtonText: "Save this PDF",
                                cancelButtonText: "Exit without saving",
                                closeOnConfirm: true,
                                closeOnCancel: true
                            },
                                function (isConfirm) {
                                    if (isConfirm) {
                                        saveDocument();
                                    } else {
                                        window.location.href = ("/files");
                                    }
                                });
                        }

                        $(document).ready(function () {
                            $("#nav-logo-editor").on('click', function () {
                                if (saving) {
                                    swal({
                                        title: "Please wait until your PDF has saved.",
                                        type: "warning",
                                        showCancelButton: true,
                                        confirmButtonColor: "#4cae4c",
                                        confirmButtonText: "Wait for PDF to save",
                                        cancelButtonText: "Exit without saving",
                                        closeOnConfirm: true,
                                        closeOnCancel: true
                                    },
                                        function (isConfirm) {
                                            if (isConfirm) {
                                            } else {
                                                window.location.href = ("/files");
                                            }
                                        });
                                } else {
                                    $('#new-surface').activeEditor('mode', 'TRANSFORM');
                                    writeJSON();
                                    if (lastSavedJson == JSON.stringify(documentData)) {
                                        window.location.href = ("/files");
                                    } else {
                                        modalToMyFiles();
                                    }
                                }
                            });
                        });
                    </script>
                </div>
                <div id="toolbar-tabs" style="text-align: center;">
                    <div class="btn tab-container active-tab" id="edit-tab-container" style="z-index:100;width:115px;float:left;margin-top:0px;border-radius: 0px;height:38px;padding:0px;border-top-left-radius: 10px;border-top-right-radius: 10px;">
                        <div id="edit-tab" class="this-tab border-tab" style="line-height:25px;height:28px;margin-top: 5px;" type="button">
                            <span>Editor</span>
                            <i class="fas fa-caret-down" style="font-size: 20px;vertical-align: text-bottom;margin-left: 3px;" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div id="forms-tab-container" class="btn tab-container" style="z-index:100;width:125px;float:left;margin-top:0px;border-radius: 0px;height:38px;padding:0px;border-top-left-radius: 10px;border-top-right-radius: 10px;">
                        <div id="forms-tab" class="this-tab" style="line-height:25px;height:28px;margin-top: 5px;" type="button">
                            <span>Form Creator</span>
                            <i class="fas fa-caret-down" style="font-size: 20px;vertical-align: text-bottom;margin-left: 3px;" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="btn tab-container" id="file-tab-container" style="z-index:100;width:115px;float:left;margin-top:0px;border-radius: 0px;height:38px;padding:0px;border-top-left-radius: 10px;border-top-right-radius: 10px;">
                        <div id="file-tab" class="this-tab border-tab" style="line-height:25px;height:28px;margin-top: 5px;border-right: 2px solid #d0d0d0;" type="button">
                            <span>Organize</span>
                            <i class="fas fa-caret-down" style="font-size: 20px;vertical-align: text-bottom;margin-left: 3px;" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
                <div id="document-undo-group" class="btn-group pull-left" style="padding-top: 10px;height: 38px;width:75px;">
                    <span style="margin-left: 10px;" data-toggle="tooltip" data-placement="bottom" data-container="body" title="Undo"><i class="fas fa-undo active-undoredo" id="undo-btn" style="font-size:17px;" aria-hidden="true"></i></span>
                    <span style="margin-left: 10px;" data-toggle="tooltip" data-placement="bottom" data-container="body" title="Redo"><i class="fas fa-redo" id="redo-btn" style="font-size:17px;" aria-hidden="true"></i></span>
                </div>
                <div class="btn-group document-btns" style="margin-left: 15px;margin-bottom: 4px;margin-top: 2px;">
                    <a class="btn btn btn-dblue save-btn-blue document-save-button document-button" style="color:white;padding: 4px 12px;height: 32px;">
                        <i class="far fa-save" style="margin-right:8px;font-size: 18px;" aria-hidden="true"></i>
                        <span id="save-btn" style="padding-right: 5px;font-size:16px">Save</span>
                    </a>
                    <div class="btn-group">
                        <a href="/files/422c78d3265340780c2f/export_modal" class="btn btn-green document-download-button document-button dropdown-toggle export-dropdown-btn" data-toggle="modal" data-target="#downloadModal" data-backdrop="static" style="color:#FFF;height: 32px;font-size:16px;padding:4px 12px;" id="guest-export-btn"><i class="fas fa-download" style="margin-right:4px;" aria-hidden="true"></i><span style="font-size:16px"> Export</span></a>
                        <button type="button" id="guest-export-dropdown-caret-btn" class="btn btn-green dropdown-toggle document-button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="border-radius: 4px;border-top-left-radius: 0px;border-bottom-left-radius: 0px;height: 32px;padding: 4px 12px;"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
                        <ul class="dropdown-menu dropdown-menu-right">
                            <li><a id="guest-print-export-dropdown" href="/files/422c78d3265340780c2f/export_modal?export_type=print" data-toggle="modal" data-target="#downloadModal" data-backdrop="static">Print</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a id="guest-download-export-dropdown" href="/files/422c78d3265340780c2f/export_modal?export_type=download" data-toggle="modal" data-target="#downloadModal" data-backdrop="static">Download</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a id="guest-dropbox-export-dropdown" href="/files/422c78d3265340780c2f/export_modal?export_type=dropbox" data-toggle="modal" data-target="#downloadModal" data-backdrop="static">Export to Dropbox</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a id="user-gdrive-export-dropdown" href="/files/422c78d3265340780c2f/export_modal?export_type=gdrive" data-toggle="modal" data-target="#downloadModal" data-backdrop="static">Export to Google Drive</a></li>
                        </ul>
                    </div>
                </div>
                <div style="float: right;">
                    <div id="document-title-group" style="line-height: 38px;height: 38px;">
                        <span id="document-title" style="max-width: 325px;word-wrap: break-word;margin-left:5px;overflow-y: auto;line-height: 23px;padding-right: 5px;font-size: 16px;display: inline-block;vertical-align: middle;max-height: 38px;">dummyform.pdf</span>
                        <a id="document-title-edit-button" data-toggle="tooltip" data-placement="left" data-container="body" title="Rename">
                            <i class="fas fa-pencil-alt" aria-hidden="true"></i>
                        </a>
                    </div>
                    <div id="document-title-edit-group" class="btn-group pull-left" style="display:none;padding-top: 3px;">
                        <input id="document-name-input" type="text" value="dummyform"><span id="document-title-extension">.pdf</span>
                        <span>
                            <div class="btn-dblue btn" style="color:white;float:right;margin-left:5px;margin-top: 2px;cursor:pointer;padding: 3px 8px;font-size: 14px;border-radius: 4px;" id="save-name-button">
                                <i class="fas fa-check" style="margin-right:2px;" aria-hidden="true"></i>
                            </div>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <aside class="loaded-pdf-element" style="height: 60px; display: block;">
            <div id="main-editor-tools" style="width:100%;float:left;height:60px;background-color: #d0d0d0;">
                <div style="float:left;height:60px;width: 100px;background-color: #ffffff;border-bottom: 1px solid rgb(208, 208, 208);" class="tools-edit-tab-btn">
                    <div style="margin: 12px 0px 0px 7px;">
                        <div class="btn btn-default btn-pdf-nav" style="padding: 5px 8px;height: 34px;" id="zo-btn" data-toggle="tooltip" data-placement="bottom" data-container="body" title="Zoom out">
                            <i class="fas fa-search-minus" style="font-size: 22px !important;" aria-hidden="true"></i>
                        </div>
                        <div class="btn btn-default btn-pdf-nav" style="padding: 5px 8px;height: 34px;" id="zi-btn" data-toggle="tooltip" data-placement="bottom" data-container="body" title="Zoom in">
                            <i class="fas fa-search-plus" style="font-size: 22px !important;" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
                <div style="float:left;height:60px;width: 100px;background-color: #ffffff;display: none;border-bottom: 1px solid rgb(208, 208, 208);" class="file-tab-btn">
                    <button id="editor-files-btn" class="btn switch-mode file-tab-btn" style="z-index:100;width:100px;float:left;margin-top:2px;height:57px;text-align:center;border:none;display:none;overflow: hidden;;font-size: 14px;border-radius: 0px;padding: 0px;outline: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="My Files">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="far fa-copy" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            My Files
                        </span>
                    </button>
                    <script type="text/javascript">
                        $("#editor-files-btn").on('click', function () {
                            if (saving) {
                                swal({
                                    title: "Please wait until your PDF has saved.",
                                    type: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#4cae4c",
                                    confirmButtonText: "Wait for PDF to save",
                                    cancelButtonText: "Exit without saving",
                                    closeOnConfirm: true,
                                    closeOnCancel: true
                                },
                                    function (isConfirm) {
                                        if (isConfirm) {
                                        } else {
                                            window.location.href = ("/files");
                                        }
                                    });
                            } else {
                                $("#new-surface").activeEditor("mode", "TRANSFORM");
                                writeJSON();
                                if (lastSavedJson == JSON.stringify(documentData)) {
                                    window.location.href = ("/files");
                                } else {
                                    modalToMyFiles();
                                }
                            }
                        });
                    </script>
                </div>
                <div class="btn-group btn-group-vertical side-tool-buttons" style="float:left;height:60px;">
                    <button id="editor-select-btn" class="btn switch-mode switch-mode-transform tools-edit-tab-btn" style="z-index:100;width:70px;float:left;margin-top:0px;border-top-left-radius: 0px;height:100%;padding-right:0px;text-align:center;border:none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Select Element">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fas fa-arrows-alt" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Select
                        </span>
                    </button>
                    <button id="editor-delete-pages-btn" class="btn switch-mode switch-mode-delete-pages file-tab-btn" style="z-index:100;width:75px;float:left;margin-top:0px;height:100%;padding-right:0px;text-align:center;border:none;display:none;line-height:16px;" data-toggle="tooltip" data-placement="top" data-container="body" title="Delete Pages">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fas fa-cut" style="font-size: 16px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Delete<br>Pages
                        </span>
                    </button>
                    <button id="editor-merge-btn" class="btn switch-mode switch-mode-merge file-tab-btn" style="z-index:100;width:75px;float:left;margin-top:0px;height:100%;padding-right:0px;text-align:center;border:none;display:none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Merge PDFs">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="far fa-copy" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Merge
                        </span>
                    </button>
                    <button id="editor-rotate-btn" class="btn switch-mode switch-mode-rotate file-tab-btn" style="z-index:100;width:75px;float:left;margin-top:0px;height:100%;padding-right:0px;text-align:center;border:none;display:none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Rotate PDF">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fas fa-redo" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Rotate
                        </span>
                    </button>
                    <button id="editor-reorder-btn" class="btn switch-mode switch-mode-reorder file-tab-btn" style="z-index:100;width:75px;float:left;margin-top:0px;height:100%;padding-right:0px;text-align:center;border:none;display:none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Reorder PDF">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fas fa-exchange-alt" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Reorder
                        </span>
                    </button>
                    <button id="add-pages-btn" class="btn file-tab-btn" style="z-index:100;width:85px;float:left;margin-top:0px;height:100%;padding-right:0px;text-align:center;border:none;display:none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Add Blank Page">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="far fa-file" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Blank Page
                        </span>
                    </button>
                    <button id="protect-btn" class="btn switch-mode switch-mode-protect file-tab-btn" style="z-index:100;width:75px;float:left;margin-top:0px;height:100%;padding-right:0px;text-align:center;border:none;display:none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Protect file">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fas fa-lock" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Protect
                        </span>
                    </button>
                    <button id="editor-text-btn" class="btn switch-mode switch-mode-text tools-edit-tab-btn active" style="z-index:100;width:70px;float:left;margin-top:0px;height:100%;padding-right:0px;text-align:center;border:none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Add Text">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fas fa-font" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Text
                        </span>
                    </button>
                    <button id="editor-erase-btn" class="btn switch-mode switch-mode-whiteoutblock edit-tab-btn" style="z-index: 100; width: 70px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; display: block;" data-toggle="tooltip" data-placement="top" data-container="body" title="Eraser">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <span class="pseudo-icon">
                                <span style="display:inline-block;background-color:#fff;border:solid 1px black;width:19px;height:19px;margin-top:3px;margin-bottom:-3px;margin-left:3px;">
                                </span>
                                <br>
                                Erase
                            </span>
                        </span>
                    </button>
                    <button id="editor-check-btn" class="btn switch-mode switch-mode-checkmark edit-tab-btn" style="z-index: 100; width: 70px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; display: block;" data-toggle="tooltip" data-placement="top" data-container="body" title="Add Check">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fawe fawe-check" style="font-size: 22px !important;  padding-left: 5px;"></i>
                            <br>
                            Check
                        </span>
                    </button>
                    <button id="editor-cross-btn" class="btn upper-right switch-mode switch-mode-remove edit-tab-btn" style="z-index: 100; width: 70px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; display: block;" data-toggle="tooltip" data-placement="top" data-container="body" title="Add Cross">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fawe fawe-times" style="font-size: 22px !important;  padding-left: 5px;"></i>
                            <br>
                            Cross
                        </span>
                    </button>
                    <span class="edit-tab-btn" style="display: inline;">
                        <a data-toggle="modal" data-target="#image-modal" data-backdrop="false" id="image-modal-btn" href="/pdf_images">
                            <button class="btn switch-mode switch-mode-image document-button" style="z-index:100;width:70px;float:left;margin-top:0px;border-radius:0px;height:100%;padding-right:0px;text-align:center;border:none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Add Image">
                                <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                                    <i class="far fa-image" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                                    <br>
                                    Image
                                </span>
                            </button>
                        </a>
                    </span>
                    <span class="edit-tab-btn" style="display: inline;">
                        <a data-toggle="modal" data-target="#signature-modal" data-backdrop="false" class="sig-modal-btn" href="/pdf_signatures">
                            <button class="btn switch-mode switch-mode-signature document-button" style="z-index:100;width:75px;float:left;margin-top:0px;border-radius:0px;height:100%;padding-right:0px;text-align:center;border:none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Add Signature">
                                <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                                    <i class="fas fa-signature" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                                    <br>
                                    Signature
                                </span>
                            </button>
                        </a>
                    </span>
                    <button id="editor-draw-btn" class="btn switch-mode switch-mode-pen edit-tab-btn" style="z-index: 100; width: 70px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; display: block;" data-toggle="tooltip" data-placement="top" data-container="body" title="Draw">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fas fa-pencil-alt" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Draw
                        </span>
                    </button>
                    <button id="editor-link-btn" class="btn switch-mode switch-mode-hyperlink edit-tab-btn" style="z-index: 100; width: 70px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; display: block;" data-toggle="tooltip" data-placement="top" data-container="body" title="Add Hyperlink">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <i class="fas fa-link" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                            <br>
                            Link
                        </span>
                    </button>
                    <button id="editor-highlight-btn" class="btn switch-mode switch-mode-highlightblock edit-tab-btn" style="z-index: 100; width: 75px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; display: block;" data-toggle="tooltip" data-placement="top" data-container="body" title="Highlighter">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <span class="pseudo-icon">

                                <i class="fas fa-highlighter" style="font-size: 22px !important;  padding-left: 5px;" aria-hidden="true"></i>
                                <br>
                                Highlight
                            </span>
                        </span>
                    </button>
                    <button id="editor-blackout-btn" class="btn switch-mode switch-mode-redactblock edit-tab-btn" style="z-index: 100; width: 75px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; display: block;" data-toggle="tooltip" data-placement="top" data-container="body" title="Blackout">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;">
                            <span class="pseudo-icon">
                                <span style="display:inline-block;background-color:black;border:solid 1px black;width:19px;height:19px;margin-top:3px;margin-bottom:-3px;">
                                </span>
                            </span>
                            <br>
                            Blackout
                        </span>
                    </button>
                    <button type="button" class="btn edit-tab-btn" id="shapes-popover" data-container="body" data-toggle="popover" data-placement="bottom" data-content="<span class=&quot;close-shapes-popover&quot; style=&quot;float:right;cursor:pointer;&quot;>×</span><div class=&quot;svg-buttons&quot;><div class=&quot;btn-group&quot; style=&quot;display:inline-block;&quot;><button class=&quot;btn switch-mode switch-mode-rectangle shape-btn&quot; style=&quot;z-index:100&quot;><svg style=&quot;width:18px;height:18px;&quot;><rect x=&quot;3&quot; y=&quot;3&quot; width=&quot;12&quot; height=&quot;12&quot; stroke=&quot;#333333&quot; stroke-width=&quot;2&quot; fill=&quot;none&quot;></rect></svg></button><button class=&quot;btn switch-mode switch-mode-ellipse shape-btn&quot; style=&quot;z-index:100&quot;><svg style=&quot;width:18px;height:18px;&quot;><circle cx=&quot;9&quot; cy=&quot;9&quot; r=&quot;6&quot; stroke=&quot;#333333&quot; stroke-width=&quot;2&quot; fill=&quot;none&quot;></circle></svg></button><button class=&quot;btn switch-mode switch-mode-line shape-btn&quot; style=&quot;z-index:100&quot;><svg style=&quot;width:18px;height:18px;&quot;><line x1=&quot;3&quot; y1=&quot;3&quot; x2=&quot;15&quot; y2=&quot;15&quot; stroke=&quot;#333333&quot; stroke-width=&quot;2&quot; fill=&quot;none&quot;></line></svg></button><button class=&quot;btn switch-mode switch-mode-vert-line shape-btn&quot; style=&quot;z-index:100&quot;><svg style=&quot;width:18px;height:18px;&quot;><line x1=&quot;9&quot; y1=&quot;0&quot; x2=&quot;9&quot; y2=&quot;16&quot; stroke=&quot;#333333&quot; stroke-width=&quot;2&quot; fill=&quot;none&quot;></line></svg></button><button class=&quot;btn switch-mode switch-mode-hori-line shape-btn&quot; style=&quot;z-index:100&quot;><svg style=&quot;width:18px;height:18px;&quot;><line x1=&quot;0&quot; y1=&quot;8&quot; x2=&quot;16&quot; y2=&quot;8&quot; stroke=&quot;#333333&quot; stroke-width=&quot;2&quot; fill=&quot;none&quot;></line></svg></button></div></div>" style="float: left; width: 75px; margin-top: 0px; border-radius: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; padding-top: 6px; display: block;" data-html="true" data-original-title="" title="">
                        <span class="pbicon-wrapper" data-toggle="tooltip" data-placement="top" data-container="body" title="Add Shape" style="width:100%;border-right:none;">
                            <span class="pseudo-icon" style="width:25px;">
                                <i class="fas fa-shapes" style="font-size: 22px !important;" aria-hidden="true"></i>
                            </span>
                            <div style="line-height: 18px;">
                                Shapes
                            </div>
                        </span>
                    </button>
                    <button type="button" class="btn edit-tab-btn" id="symbols-popover" data-container="body" data-toggle="popover" data-placement="bottom" data-content="<span class=&quot;close-symbols-popover&quot; style=&quot;float:right;cursor:pointer;&quot;>×</span><div class=&quot;symbol-buttons&quot; style=&quot;&quot;><div class=&quot;btn-group symbol-group&quot;><button class=&quot;btn upper-left switch-mode switch-mode-checkmark&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-check&quot;></i></button><button class=&quot;btn upper-right switch-mode switch-mode-remove&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-times&quot;></i></button></div><br><div class=&quot;btn-group symbol-group&quot;><button class=&quot;btn switch-mode switch-mode-arrow-left&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-arrow-left&quot;></i></button><button class=&quot;btn switch-mode switch-mode-arrow-right&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-arrow-right&quot;></i></button></div><br><div class=&quot;btn-group symbol-group&quot;><button class=&quot;btn switch-mode switch-mode-arrow-up&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-arrow-up&quot;></i></button><button class=&quot;btn switch-mode switch-mode-arrow-down&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-arrow-down&quot;></i></button></div><br><div class=&quot;btn-group symbol-group&quot;><button class=&quot;btn switch-mode switch-mode-thumbs-up&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-thumbs-up&quot;></i></button><button class=&quot;btn switch-mode switch-mode-thumbs-down&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-thumbs-down&quot;></i></button></div><br><div class=&quot;btn-group symbol-group&quot;><button class=&quot;btn lower-left switch-mode switch-mode-question&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-question-circle&quot;></i></button><button class=&quot;btn lower-right switch-mode switch-mode-exclamation&quot; style=&quot;z-index:100&quot;><i class=&quot;fawe fawe-exclamation-circle&quot;></i></button></div></div>" style="float: left; width: 75px; margin-top: 0px; border-radius: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; display: block;" data-html="true" data-original-title="" title="">
                        <span class="pbicon-wrapper" data-toggle="tooltip" data-placement="top" data-container="body" title="Add Symbol" style="width:100%;border-right:none;">
                            <span class="pseudo-icon" style="width:25px;">
                                <i class="fas fa-plus-square" style="font-size: 22px !important;" aria-hidden="true"></i>
                            </span>
                            <div style="line-height: 18px;">
                                Symbols
                            </div>
                        </span>
                    </button>
                    <button id="editor-textfield-btn" class="btn switch-mode switch-mode-textfield forms-tab-btn form-field-btn" style="z-index: 100; width: 70px; float: left; margin-top: 0px; height: 100%; text-align: center; border: none; line-height: 16px; padding: 0px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Text Field">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;display: inline-block;height:100%;padding-top: 7px;">
                            <svg style="width:100%;height:13px;padding-left:15px;margin-bottom: 2px;">
                                <rect x="2" y="2" width="35" height="8" stroke="#333333" stroke-width="2" fill="none" rx="2"></rect>
                                <line x1="6" y1="6" x2="33" y2="6" stroke="#333333" stroke-width="2" fill="none"></line>
                            </svg>
                            <br>
                            Text<br>Field
                        </span>
                    </button>
                    <button id="editor-parafield-btn" class="btn switch-mode switch-mode-parafield forms-tab-btn form-field-btn" style="z-index: 100; width: 85px; float: left; margin-top: 0px; height: 100%; text-align: center; border: none; line-height: 16px; padding: 0px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Paragraph Field">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;display: inline-block;height:100%;padding-top: 3px;">
                            <svg style="width:39px;height:18px;margin-bottom: 1px;">
                                <rect x="2" y="2" width="35" height="14" stroke="#333333" stroke-width="2" fill="none" rx="2"></rect>
                                <line x1="6" y1="6" x2="33" y2="6" stroke="#333333" stroke-width="2" fill="none"></line>
                                <line x1="6" y1="9" x2="33" y2="9" stroke="#333333" stroke-width="2" fill="none"></line>
                                <line x1="6" y1="12" x2="29" y2="12" stroke="#333333" stroke-width="2" fill="none"></line>
                            </svg>
                            <br>
                            Paragraph<br>Field
                        </span>
                    </button>
                    <button id="editor-checkfield-btn" class="btn switch-mode switch-mode-checkfield forms-tab-btn form-field-btn" style="z-index: 100; width: 80px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; line-height: 16px; border-radius: 0px; padding-top: 4px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Checkbox Field">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;padding:0px;">
                            <i class="far fa-check-square" style="font-size: 18px !important;padding-left: 5px;margin-bottom: 3px;" aria-hidden="true"></i>
                            <br>
                            Checkbox<br>Field
                        </span>
                    </button>
                    <button id="editor-radiofield-btn" class="btn switch-mode switch-mode-radiofield forms-tab-btn form-field-btn" style="z-index: 100; width: 70px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; line-height: 16px; border-radius: 0px; padding-top: 4px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Radio Button Field">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;padding:0px;">
                            <i class="far fa-dot-circle" style="font-size: 18px !important;padding-left: 5px;margin-bottom: 3px;" aria-hidden="true"></i>
                            <br>
                            Radio<br>Field
                        </span>
                    </button>
                    <button id="editor-dropfield-btn" class="btn switch-mode switch-mode-dropfield forms-tab-btn form-field-btn" style="z-index: 100; width: 85px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; line-height: 16px; border-radius: 0px; padding-top: 4px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Dropdown Field">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;padding:0px;">
                            <i class="far fa-caret-square-down" style="font-size: 18px !important;padding-left: 5px;margin-bottom: 3px;" aria-hidden="true"></i>
                            <br>
                            Dropdown<br>Field
                        </span>
                    </button>
                    <button id="editor-listfield-btn" class="btn switch-mode switch-mode-listfield forms-tab-btn form-field-btn" style="z-index: 100; width: 65px; float: left; margin-top: 0px; height: 100%; padding-right: 0px; text-align: center; border: none; line-height: 16px; border-radius: 0px; padding-top: 4px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="List Field">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;padding:0px;">
                            <i class="far fa-list-alt" style="font-size: 18px !important;padding-left: 5px;margin-bottom: 3px;" aria-hidden="true"></i>
                            <br>
                            List<br>Field
                        </span>
                    </button>
                    <button id="editor-datefield-btn" class="btn switch-mode switch-mode-datefield forms-tab-btn form-field-btn" style="z-index: 100; width: 65px; float: left; margin-top: 0px; height: 100%; text-align: center; border: none; line-height: 16px; padding: 0px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Date Field">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;padding:0px;">
                            <i class="far fa-calendar-alt" style="font-size: 18px !important;padding-left: 5px;margin-bottom: 3px;" aria-hidden="true"></i>
                            <br>
                            Date<br>Field
                        </span>
                    </button>
                    <button id="editor-sigfield-btn" class="btn switch-mode switch-mode-sigfield forms-tab-btn form-field-btn" style="z-index: 100; width: 80px; float: left; margin-top: 0px; height: 100%; text-align: center; border: none; line-height: 16px; padding: 0px; border-radius: 0px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Signature Field">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;padding:0px;">
                            <i class="fas fa-edit" style="font-size: 18px !important;padding-left: 5px;margin-bottom: 3px;" aria-hidden="true"></i>
                            <br>
                            Signature<br>Field
                        </span>
                    </button>
                    <button id="editor-initialsfield-btn" class="btn switch-mode switch-mode-initialsfield forms-tab-btn form-field-btn" style="z-index: 100; width: 75px; float: left; margin-top: 0px; height: 100%; text-align: center; border: none; line-height: 16px; padding: 0px; border-radius: 0px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Initials Field">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;padding:0px;">
                            <div id="initials-icon">IN</div>
                            <div>Initials<br>Field</div>
                        </span>
                    </button>
                    <button id="editor-multiple-btn" class="btn switch-mode switch-mode-multiple forms-tab-btn form-field-btn" style="z-index: 100; width: 70px; float: left; margin-top: 0px; height: 100%; text-align: center; border: none; line-height: 14px; padding: 1px 0px 0px; display: none;" data-toggle="tooltip" data-placement="top" data-container="body" title="Arrange Fields">
                        <span class="pbicon-wrapper" style="width:100%;border-right:none;display: inline-block;height:100%;padding-top: 3px;">
                            <img class="multiple-image" src="/assets/align-left-cd09e086e3970392b6c5ffad65a7bdf72b35a880f7065424df60dfecd478cd01.png">
                            <br>Arrange<br>Fields
                        </span>
                    </button>
                </div>
                <div id="slider-container" class="btn-toolbar file-tab-btn" style="display:none;margin-bottom: 0px;border:none;min-height:54px;text-align:center;margin-top:0px;background-color: #d0d0d0;float: right;width: 270px;height:42px;">
                    <div class="zoom-slider" style="margin-top: 18px;margin-right: 5px;">
                        <i class="far fa-file-alt" style="float: left;margin-top: 6px;font-size: 13px;margin-left: 5px;" aria-hidden="true"></i>
                        <div id="slider" style="border: 1px solid #c5c5c5;float: left;width: 80%; margin: 7px 10px 7px 12px;height:11px;" class="ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content"><div class="ui-slider-range ui-corner-all ui-widget-header"></div><span tabindex="0" class="ui-slider-handle ui-corner-all ui-state-default" style="left: 12.5%;"></span></div>
                        <i class="far fa-file-alt" style="float: left;margin-top: 3px;font-size: 19px;" aria-hidden="true"></i>
                    </div>
                </div>
                <div style="clear:both;"></div>
            </div>
        </aside>
        <div id="one-page-view">
            <div id="viewer-toolbar" class="btn-toolbar editor-toolbar loaded-pdf-element row" style="display:inline-block;width:100%;border-bottom:1px solid rgb(204, 204, 204);padding: 5px 10px;height:55px;">
                <div style="text-align: left;float:left;height: 100%;margin-right: 20px;padding-top: 3px;">
                    <div class="btn btn-default active" style="padding: 5px 8px;height: 34px;margin-right:15px;" id="th-btn" data-toggle="tooltip" data-placement="bottom" data-container="body" title="View/hide thumbnails">
                        <i class="fas fa-th" style="font-size: 22px !important;" aria-hidden="true"></i>
                    </div>
                    <div class="btn-group" style="vertical-align:middle;display:inline-block;line-height: 32px;">
                        <span class="lbl" style="font-style:italic">Page: <span id="one_page" style="margin-left: 2px; display: inline;">1</span></span>
                        <select class="page-number btn-pdf-nav" id="page_num" style="margin-left: 2px; height: 30px; display: none;"><option value="1">1</option></select>
                        <span class="lbl" style="margin-left: 6px;font-style:italic">of <span class="page-count" style="margin-left:2px;">1</span></span>
                    </div>
                    <div class="btn-group" id="nav-btns" style="display: none;">
                        <button class="btn btn-page-previous btn-pdf-nav" data-toggle="tooltip" data-placement="bottom" data-container="body" title="Previous page"><i class="fas fa-chevron-left" aria-hidden="true"></i></button><button class="btn btn-page-next btn-pdf-nav" data-toggle="tooltip" data-placement="bottom" data-container="body" title="Next page"><i class="fas fa-chevron-right" aria-hidden="true"></i></button>
                    </div>
                </div>
                <div id="empty-toolbar" class="btn-toolbar editor-toolbar" style="margin-bottom: 0px; min-height: 42px; border: none; float: left; padding: 0px; display: none;">
                    <span class="prop" style="line-height:30px;">&nbsp;</span>
                </div>
                <div id="text-toolbar" class="btn-toolbar editor-toolbar" style="margin-bottom: 0px; padding: 0px 0px 0px 20px; border-top: none; border-right: none; border-bottom: none; border-image: initial; min-height: 38px; text-align: center; border-left: 2px solid rgb(208, 208, 208); height: 42px; float: left; display: block;">
                    <div style="float:left;margin-right:5px;">
                        <span class="lbl" style="line-height: 10px;">Font:</span>
                        <br>
                        <div id="dd" class="wrapper-dropdown-3" tabindex="1">
                            <span id="text-font" class="helvetica-font">Helvetica</span>
                            <ul class="dropdown font-list">
                                <li class="font-option active"><a href="#" class="helvetica-font">Helvetica</a></li>
                                <li class="font-option"><a href="#" class="times-new-roman-font">Times New Roman</a></li>
                                <li class="font-option"><a href="#" class="caladea-font">Caladea <span class="similar-font">(similar to Cambria)</span></a></li>
                                <li class="font-option"><a href="#" class="carlito-font">Carlito <span class="similar-font">(similar to Calibri)</span></a></li>
                                <li class="font-option"><a href="#" class="courier-font">Courier</a></li>
                                <li class="font-option"><a href="#" class="dejavu-sans-font">DejaVu Sans <span class="similar-font">(similar to Verdana)</span></a></li>
                                <li class="font-option"><a href="#" class="liberation-sans-font">Liberation Sans <span class="similar-font">(similar to Arial)</span></a></li>
                                <li class="font-option"><a href="#" class="open-sans-font">Open Sans</a></li>
                            </ul>
                        </div>
                    </div>
                    <div style="float:left;">
                        <span class="lbl" style="line-height: 10px;">Size:</span>
                        <div style="margin-top:3px">
                            <select id="text-size" style="width:75px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true">
                                <option value="6">6</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="16">16</option>
                                <option value="18">18</option>
                                <option value="20">20</option>
                                <option value="24">24</option>
                                <option value="28">28</option>
                                <option value="32">32</option>
                                <option value="36">36</option>
                                <option value="40">40</option>
                                <option value="48">48</option>
                                <option value="56">56</option>
                                <option value="64">64</option>
                                <option value="72">72</option>
                            </select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 75px;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-text-size-container"><span class="select2-selection__rendered" id="select2-text-size-container" title="14">14</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                        </div>
                        <script type="text/javascript">
            var fontSizes = [6,8,9,10,11,12,13,14,16,18,20,24,28,32,36,40,48,56,64,72];
            function sortedIndex(array, value) {
              var low = 0,
              high = array.length;

              while (low < high) {
                var mid = low + high >>> 1;
                if (array[mid] < value) low = mid + 1;
                else high = mid;
              }
              return low;
            };
            $(document).ready(function() {
              $("#text-size").select2({
                tags: true,
                data: fontSizes,
                createTag: function (params) {
                  // Don't offset to create a tag if there is no @ symbol
                  if (/^([1-9]+[0-9]*)$/.test(params.term)) {
                  } else {
                    return null;
                  }

                  return {
                    id: params.term,
                    text: params.term
                  }
                }
              });

              $.fn.refreshDataSelect2 = function (data, defaultValue) {
                this.select2('data', data);

                // Update options
                var $select = $(this[0]);
                var options = data.map(function(item) {
                    return '<option value="' + item + '">' + item + '</option>';
                });
                $select.html(options.join(''));
                $select.find("option[value='" + defaultValue +"']").prop("selected", "selected");
              };

              $("#text-size").on("change", function(e) {
                var thisItem = parseFloat($("#select2-text-size-container").text());
                if (_.contains(fontSizes, thisItem)) {} else {
                  fontSizes.splice(sortedIndex(fontSizes, thisItem), 0, thisItem);
                  $('#text-size').refreshDataSelect2(fontSizes, 14);
                  $('#text-size').find("option[value='" + thisItem + "']").prop("selected", "selected");
                }
                updateTextSettings();
              });
            });
                        </script>
                    </div>
                    <div style="width:62px;float:left;height:40px; margin-right: 4px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="text-colorpicker" id="text-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(0, 0, 0);"></div></div><div class="sp-dd">▼</div></div>


                    </div>
                    <div style="float:left;height:40px;margin-top:1px;">
                        <button id="text-bold" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-bold" aria-hidden="true"></i></button>
                        <button id="text-italic" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-italic" aria-hidden="true"></i></button>
                        <button id="text-underlined" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;margin-right:10px;outline: none;background-color: #d0d0d0;"><i class="fas fa-underline" style="margin-top: 4px;" aria-hidden="true"></i></button>
                        <button id="text-align-left" class="btn active" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-left" aria-hidden="true"></i></button>
                        <button id="text-align-center" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-center" aria-hidden="true"></i></button>
                        <button id="text-align-right" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-right" aria-hidden="true"></i></button>
                    </div>
                </div>
                <div id="text-field-toolbar" class="btn-toolbar editor-toolbar forms-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="float:left;margin-right:5px;">
                        <span class="lbl" style="line-height: 10px;">Font:</span>
                        <br>
                        <div id="tfdd" class="wrapper-dropdown-3" tabindex="1">
                            <span id="text-field-font" class="helvetica-font">Helvetica</span>
                            <ul class="dropdown">
                                <li class="font-option active"><a href="#" class="helvetica-font">Helvetica</a></li>
                                <li class="font-option"><a href="#" class="times-new-roman-font">Times New Roman</a></li>
                                <li class="font-option"><a href="#" class="courier-font">Courier</a></li>
                            </ul>
                        </div>
                    </div>
                    <div style="float:left;">
                        <span class="lbl" style="line-height: 10px;">Size:</span>
                        <div style="margin-top:3px">
                            <select id="text-field-size" style="width:75px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true">
                                <option value="auto">auto</option>
                                <option value="6">6</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="16">16</option>
                                <option value="18">18</option>
                                <option value="20">20</option>
                                <option value="24">24</option>
                                <option value="28">28</option>
                                <option value="32">32</option>
                                <option value="36">36</option>
                                <option value="40">40</option>
                                <option value="48">48</option>
                                <option value="56">56</option>
                                <option value="64">64</option>
                                <option value="72">72</option>
                            </select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 75px;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-text-field-size-container"><span class="select2-selection__rendered" id="select2-text-field-size-container" title="14">14</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                        </div>
                        <script type="text/javascript">
            var textFieldFontSizes = ["auto", 6,8,9,10,11,12,13,14,16,18,20,24,28,32,36,40,48,56,64,72];
            function sortedIndex(array, value) {
              var low = 0,
              high = array.length;

              while (low < high) {
                var mid = low + high >>> 1;
                if (array[mid] < value) low = mid + 1;
                else high = mid;
              }
              return low;
            };
            $(document).ready(function() {
              $("#text-field-size").select2({
                tags: true,
                data: textFieldFontSizes,
                createTag: function (params) {
                  // Don't offset to create a tag if there is no @ symbol
                  if (/^([1-9]+[0-9]*)$/.test(params.term)) {
                  } else {
                    return null;
                  }
                  return {
                    id: params.term,
                    text: params.term
                  }
                }
              });

              $("#text-field-size").on("change", function(e) {
                var thisItem = $("#select2-text-field-size-container").text();
                if (thisItem != "auto") {
                  if (_.contains(textFieldFontSizes, parseFloat(thisItem))) {} else {
                    textFieldFontSizes.splice(sortedIndex(textFieldFontSizes, parseFloat(thisItem)), 0, parseFloat(thisItem));
                    $('#text-field-size').refreshDataSelect2(textFieldFontSizes, 14);
                    $('#text-field-size').find("option[value='" + parseFloat(thisItem) + "']").prop("selected", "selected");
                  }
                }
                updateTextFieldSettings();
              });
            });
                        </script>
                    </div>
                    <div style="width:62px;float:left;height:40px; margin-right: 4px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="text-field-colorpicker" id="text-field-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(0, 0, 0);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                    <div style="float:left;height:40px;margin-top:1px;">
                        <button id="text-field-bold" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-bold" aria-hidden="true"></i></button>
                        <button id="text-field-italic" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;margin-right: 4px;outline: none;background-color: #d0d0d0;"><i class="fas fa-italic" aria-hidden="true"></i></button>

                        <button id="text-field-align-left" class="btn active" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-left" aria-hidden="true"></i></button>
                        <button id="text-field-align-center" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-center" aria-hidden="true"></i></button>
                        <button id="text-field-align-right" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-right" aria-hidden="true"></i></button>
                    </div>
                </div>
                <div id="combo-field-toolbar" class="btn-toolbar editor-toolbar forms-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="float:left;margin-right:5px;">
                        <span class="lbl" style="line-height: 10px;">Font:</span>
                        <br>
                        <div id="cbdd" class="wrapper-dropdown-3" tabindex="1">
                            <span id="combo-field-font" class="helvetica-font">Helvetica</span>
                            <ul class="dropdown">
                                <li class="font-option active"><a href="#" class="helvetica-font">Helvetica</a></li>
                                <li class="font-option"><a href="#" class="times-new-roman-font">Times New Roman</a></li>
                                <li class="font-option"><a href="#" class="courier-font">Courier</a></li>
                            </ul>
                        </div>
                    </div>
                    <div style="float:left;">
                        <span class="lbl" style="line-height: 10px;">Size:</span>
                        <div style="margin-top:3px">
                            <select id="combo-field-size" style="width:75px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true">
                                <option value="auto">auto</option>
                                <option value="6">6</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="16">16</option>
                                <option value="18">18</option>
                                <option value="20">20</option>
                                <option value="24">24</option>
                                <option value="28">28</option>
                                <option value="32">32</option>
                                <option value="36">36</option>
                                <option value="40">40</option>
                                <option value="48">48</option>
                                <option value="56">56</option>
                                <option value="64">64</option>
                                <option value="72">72</option>
                            </select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 75px;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-combo-field-size-container"><span class="select2-selection__rendered" id="select2-combo-field-size-container" title="16">16</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                        </div>
                        <script type="text/javascript">
            var comboFieldFontSizes = ["auto", 6,8,9,10,11,12,13,14,16,18,20,24,28,32,36,40,48,56,64,72];
            function sortedIndex(array, value) {
              var low = 0,
              high = array.length;

              while (low < high) {
                var mid = low + high >>> 1;
                if (array[mid] < value) low = mid + 1;
                else high = mid;
              }
              return low;
            };
            $(document).ready(function() {
              $("#combo-field-size").select2({
                tags: true,
                data: comboFieldFontSizes,
                createTag: function (params) {
                  // Don't offset to create a tag if there is no @ symbol
                  if (/^([1-9]+[0-9]*)$/.test(params.term)) {
                  } else {
                    return null;
                  }
                  return {
                    id: params.term,
                    text: params.term
                  }
                }
              });

              $("#combo-field-size").on("change", function(e) {
                var thisItem = $("#select2-combo-field-size-container").text();
                if (thisItem != "auto") {
                  if (_.contains(comboFieldFontSizes, parseFloat(thisItem))) {} else {
                    comboFieldFontSizes.splice(sortedIndex(comboFieldFontSizes, parseFloat(thisItem)), 0, parseFloat(thisItem));
                    $('#combo-field-size').refreshDataSelect2(comboFieldFontSizes, 14);
                    $('#combo-field-size').find("option[value='" + parseFloat(thisItem) + "']").prop("selected", "selected");
                  }
                }
                updateComboFieldSettings();
              });
            });
                        </script>
                    </div>
                    <div style="width:62px;float:left;height:40px; margin-right: 4px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="combo-field-colorpicker" id="combo-field-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(0, 0, 0);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                    <div style="float:left;height:40px;margin-top:1px;">
                        <button id="combo-field-bold" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-bold" aria-hidden="true"></i></button>
                        <button id="combo-field-italic" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;margin-right: 4px;outline: none;background-color: #d0d0d0;"><i class="fas fa-italic" aria-hidden="true"></i></button>
                        <button id="combo-field-align-left" class="btn active" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-left" aria-hidden="true"></i></button>
                        <button id="combo-field-align-center" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-center" aria-hidden="true"></i></button>
                        <button id="combo-field-align-right" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-right" aria-hidden="true"></i></button>
                    </div>
                </div>
                <div id="date-field-toolbar" class="btn-toolbar editor-toolbar forms-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="float:left;margin-right:5px;">
                        <span class="lbl" style="line-height: 10px;">Font:</span>
                        <br>
                        <div id="dfdd" class="wrapper-dropdown-3" tabindex="1">
                            <span id="date-field-font" class="helvetica-font">Helvetica</span>
                            <ul class="dropdown">
                                <li class="font-option active"><a href="#" class="helvetica-font">Helvetica</a></li>
                                <li class="font-option"><a href="#" class="times-new-roman-font">Times New Roman</a></li>
                                <li class="font-option"><a href="#" class="courier-font">Courier</a></li>
                            </ul>
                        </div>
                    </div>
                    <div style="float:left;">
                        <span class="lbl" style="line-height: 10px;">Size:</span>
                        <div style="margin-top:3px">
                            <select id="date-field-size" style="width:75px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true">
                                <option value="auto">auto</option>
                                <option value="6">6</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="16">16</option>
                                <option value="18">18</option>
                                <option value="20">20</option>
                                <option value="24">24</option>
                                <option value="28">28</option>
                                <option value="32">32</option>
                                <option value="36">36</option>
                                <option value="40">40</option>
                                <option value="48">48</option>
                                <option value="56">56</option>
                                <option value="64">64</option>
                                <option value="72">72</option>
                            </select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 75px;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-date-field-size-container"><span class="select2-selection__rendered" id="select2-date-field-size-container" title="14">14</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                        </div>
                        <script type="text/javascript">
            var dateFieldFontSizes = ["auto", 6,8,9,10,11,12,13,14,16,18,20,24,28,32,36,40,48,56,64,72];
            function sortedIndex(array, value) {
              var low = 0,
              high = array.length;

              while (low < high) {
                var mid = low + high >>> 1;
                if (array[mid] < value) low = mid + 1;
                else high = mid;
              }
              return low;
            };
            $(document).ready(function() {
              $("#date-field-size").select2({
                tags: true,
                data: dateFieldFontSizes,
                createTag: function (params) {
                  // Don't offset to create a tag if there is no @ symbol
                  if (/^([1-9]+[0-9]*)$/.test(params.term)) {
                  } else {
                    return null;
                  }
                  return {
                    id: params.term,
                    text: params.term
                  }
                }
              });

              $("#date-field-size").on("change", function(e) {
                var thisItem = $("#select2-date-field-size-container").text();
                if (thisItem != "auto") {
                  if (_.contains(dateFieldFontSizes, parseFloat(thisItem))) {} else {
                    dateFieldFontSizes.splice(sortedIndex(dateFieldFontSizes, parseFloat(thisItem)), 0, parseFloat(thisItem));
                    $('#date-field-size').refreshDataSelect2(dateFieldFontSizes, 14);
                    $('#date-field-size').find("option[value='" + parseFloat(thisItem) + "']").prop("selected", "selected");
                  }
                }
                updateDateFieldSettings();
              });
            });
                        </script>
                    </div>
                    <div style="width:62px;float:left;height:40px; margin-right: 4px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="date-field-colorpicker" id="date-field-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(0, 0, 0);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                    <div style="float:left;height:40px;margin-top:1px;">
                        <button id="date-field-bold" class="btn active" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-bold" aria-hidden="true"></i></button>
                        <button id="date-field-italic" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;margin-right: 4px;outline: none;background-color: #d0d0d0;"><i class="fas fa-italic" aria-hidden="true"></i></button>
                        <button id="date-field-align-left" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-left" aria-hidden="true"></i></button>
                        <button id="date-field-align-center" class="btn active" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-center" aria-hidden="true"></i></button>
                        <button id="date-field-align-right" class="btn" style="height:100%;border-radius:0px;width:40px;border: none;outline: none;background-color: #d0d0d0;"><i class="fas fa-align-right" aria-hidden="true"></i></button>
                    </div>
                </div>
                <div id="check-field-toolbar" class="btn-toolbar editor-toolbar forms-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="float:left;margin-right:5px;" class="check-field-pro">
                        <span class="lbl" style="line-height: 10px;">Character:</span>
                        <br>
                        <div id="cfdd" class="wrapper-dropdown-3" tabindex="1">
                            <span id="check-field-char">Check</span>
                            <ul class="dropdown">
                                <li class="char-option active"><a href="#">Check</a></li>
                                <li class="char-option"><a href="#">Cross</a></li>
                                <li class="char-option"><a href="#">Circle</a></li>
                                <li class="char-option"><a href="#">Square</a></li>
                                <li class="char-option"><a href="#">Star</a></li>
                                <li class="char-option"><a href="#">Diamond</a></li>
                            </ul>
                        </div>
                    </div>
                    <div style="float:left;">
                        <span class="lbl" style="line-height: 10px;">Size:</span>
                        <div style="margin-top:3px">
                            <select id="check-field-size" style="width:75px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true">
                                <option value="auto">auto</option>
                                <option value="6">6</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="16">16</option>
                                <option value="18">18</option>
                                <option value="20">20</option>
                                <option value="24">24</option>
                                <option value="28">28</option>
                                <option value="32">32</option>
                                <option value="36">36</option>
                                <option value="40">40</option>
                                <option value="48">48</option>
                                <option value="56">56</option>
                                <option value="64">64</option>
                                <option value="72">72</option>
                            </select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 75px;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-check-field-size-container"><span class="select2-selection__rendered" id="select2-check-field-size-container" title="auto">auto</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                        </div>
                        <script type="text/javascript">
            var checkFieldFontSizes = ["auto", 6,8,9,10,11,12,13,14,16,18,20,24,28,32,36,40,48,56,64,72];
            function sortedIndex(array, value) {
              var low = 0,
              high = array.length;

              while (low < high) {
                var mid = low + high >>> 1;
                if (array[mid] < value) low = mid + 1;
                else high = mid;
              }
              return low;
            };
            $(document).ready(function() {
              $("#check-field-size").select2({
                tags: true,
                data: checkFieldFontSizes,
                createTag: function (params) {
                  // Don't offset to create a tag if there is no @ symbol
                  if (/^([1-9]+[0-9]*)$/.test(params.term)) {
                  } else {
                    return null;
                  }
                  return {
                    id: params.term,
                    text: params.term
                  }
                }
              });

              $("#check-field-size").on("change", function(e) {
                var thisItem = $("#select2-check-field-size-container").text();
                if (thisItem != "auto") {
                  if (_.contains(checkFieldFontSizes, parseFloat(thisItem))) {} else {
                    checkFieldFontSizes.splice(sortedIndex(checkFieldFontSizes, parseFloat(thisItem)), 0, parseFloat(thisItem));
                    $('#check-field-size').refreshDataSelect2(checkFieldFontSizes, 14);
                    $('#check-field-size').find("option[value='" + parseFloat(thisItem) + "']").prop("selected", "selected");
                  }
                }
                updateCheckFieldSettings();
              });
            });
                        </script>
                    </div>
                    <div style="width:62px;float:left;height:40px; margin-right: 4px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="check-field-colorpicker" id="check-field-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(0, 0, 0);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                </div>
                <div id="signature-toolbar" class="btn-toolbar editor-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="float:left">
                        <span class="lbl" style="line-height: 10px;">Size:</span>
                        <br>
                        <div style="margin-top: 3px">
                            <select id="signature-size" style="margin-top: 2px;height:30px;width:75px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true">
                                <option value="6">6</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="16">16</option>
                                <option value="18">18</option>
                                <option value="20">20</option>
                                <option value="24">24</option>
                                <option value="28">28</option>
                                <option value="32">32</option>
                                <option value="36">36</option>
                                <option value="40">40</option>
                                <option value="48">48</option>
                                <option value="56">56</option>
                                <option value="64">64</option>
                                <option value="72">72</option>
                            </select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 75px;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-signature-size-container"><span class="select2-selection__rendered" id="select2-signature-size-container" title="40">40</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                        </div>
                        <script type="text/javascript">
            var signatureFontSizes = [6,8,9,10,11,12,13,14,16,18,20,24,28,32,36,40,48,56,64,72];
            $(document).ready(function() {
              $("#signature-size").select2({
                tags: true,
                data: signatureFontSizes,
                createTag: function (params) {
                  // Don't offset to create a tag if there is no @ symbol
                  if (/^([1-9]+[0-9]*)$/.test(params.term)) {
                  } else {
                    return null;
                  }

                  return {
                    id: params.term,
                    text: params.term
                  }
                }
              });

              $("#signature-size").on("change", function(e) {
                var thisItem = parseFloat($("#select2-signature-size-container").text());
                if (_.contains(signatureFontSizes, thisItem)) {} else {
                  signatureFontSizes.splice(sortedIndex(signatureFontSizes, thisItem), 0, thisItem);
                  $('#signature-size').refreshDataSelect2(signatureFontSizes, 40);
                  $('#signature-size').find("option[value='" + thisItem + "']").prop("selected", "selected");
                }
                updateSignatureSettings();
              });
            });
                        </script>
                    </div>
                    <div style="width: 75px;float:left;height:40px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="signature-colorpicker" id="signature-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(0, 0, 0);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                </div>
                <div id="multiple-toolbar" class="btn-toolbar editor-toolbar forms-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="float:left;margin-right: 10px;">
                        <span class="lbl" style="line-height: 10px;margin-bottom: 3px;display: inline-block;">Align:</span>
                        <br>
                        <div>
                            <div class="btn btn-default" id="align-left" data-toggle="tooltip" data-placement="top" data-container="body" title="Align Left">
                                <img class="multiple-image" src="/assets/align-left-cd09e086e3970392b6c5ffad65a7bdf72b35a880f7065424df60dfecd478cd01.png">
                            </div>
                            <div class="btn btn-default" id="align-right" data-toggle="tooltip" data-placement="top" data-container="body" title="Align Right">
                                <img class="multiple-image" src="/assets/align-right-469a3bcba8692cda268d98602cca363cbdc874425400a738b461a431af8269c7.png">
                            </div>
                            <div class="btn btn-default" id="align-top" data-toggle="tooltip" data-placement="top" data-container="body" title="Align Top">
                                <img class="multiple-image" src="/assets/align-top-4781c690ec46550fee325903cc771b072194ef95720f3e6ff143a6cfef2671f2.png">
                            </div>
                            <div class="btn btn-default" id="align-bottom" data-toggle="tooltip" data-placement="top" data-container="body" title="Align Bottom">
                                <img class="multiple-image" src="/assets/align-bottom-1e66cc02eaaecb1485b796a1de8c81f513bc7fd1650f4711124ea8d428d13f67.png">
                            </div>
                            <div class="btn btn-default" id="align-vert" data-toggle="tooltip" data-placement="top" data-container="body" title="Align Vertically">
                                <img class="multiple-image" src="/assets/align-vert-03006f916639fae8616cf3ab1c4763ce395056da19ba2e4313dced6a02a69567.png">
                            </div>
                            <div class="btn btn-default" id="align-hori" data-toggle="tooltip" data-placement="top" data-container="body" title="Align Horizontally">
                                <img class="multiple-image" src="/assets/align-hori-01a0925b500bb311ef2288e9d4682fe053b0342b59cdbd793759ae02956c034c.png">
                            </div>
                        </div>
                    </div>
                    <div style="float:left;margin-right: 10px;">
                        <span class="lbl" style="line-height: 10px;margin-bottom: 3px;display: inline-block;">Match size:</span>
                        <br>
                        <div>
                            <div class="btn btn-default" id="match-width" data-toggle="tooltip" data-placement="top" data-container="body" title="Match Width">
                                <img class="multiple-image" src="/assets/match-width-b743a16ba69bc6e27c9931768ca5c81fedd5e8f84a6138ad90de043b2028154f.png">
                            </div>
                            <div class="btn btn-default" id="match-height" data-toggle="tooltip" data-placement="top" data-container="body" title="Match Height">
                                <img class="multiple-image" src="/assets/match-height-34735e5fc4009de8a68170c34540195e146247c6df9b5ad5cefee3d4b83ce997.png">
                            </div>
                            <div class="btn btn-default" id="match-both" data-toggle="tooltip" data-placement="top" data-container="body" title="Match Width and Height">
                                <img class="multiple-image" src="/assets/match-both-c8721af65a2782dfb5ea89c383ac0974da1d56c61ef7cc11bfdb2b4354f5ae4b.png">
                            </div>
                        </div>
                    </div>
                    <div style="float:left">
                        <span class="lbl" style="line-height: 10px;margin-bottom: 3px;display: inline-block;">Field Spacing:</span>
                        <br>
                        <div>
                            <div class="btn btn-default" id="spacing-vert" data-toggle="tooltip" data-placement="top" data-container="body" title="Distribute Vertically">
                                <img class="multiple-image" src="/assets/dist-vert-8150e1524ef7b4de04237ac1febdae2d9b10ea6d82ca854bcc4d7c1a19c14ee6.png">
                            </div>
                            <div class="btn btn-default" id="spacing-hori" data-toggle="tooltip" data-placement="top" data-container="body" title="Distribute Horizontally">
                                <img class="multiple-image" src="/assets/dist-hori-f0cfea5dfb5231c1c83547be88dd17c44b6f522f64cf5fd74cc774cdeaab3fa2.png">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="path-toolbar" class="btn-toolbar editor-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="width: 75px;float:left;height:40px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="path-colorpicker" id="path-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(0, 0, 0);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                    <div style="float:left">
                        <span class="lbl" style="line-height: 10px;">Width:</span>
                        <br>
                        <select id="path-width" style="margin-top: 2px;height:30px;">
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option selected="">4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>8</option>
                            <option>10</option>
                            <option>12</option>
                        </select>
                    </div>
                </div>
                <div id="shape-toolbar" class="btn-toolbar editor-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="width: 75px;float:left;height:40px;" class="fill-group toolbar-option">
                        <span class="lbl" style="line-height: 10px;">Fill:</span>
                        <br>
                        <input type="text" name="shape-fill-colorpicker" id="shape-fill-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                    <div style="width: 75px;float:left;height:40px;" class="stroke-group toolbar-option">
                        <span class="lbl" style="line-height: 10px;">Stroke:</span>
                        <br>
                        <input type="text" name="shape-stroke-colorpicker" id="shape-stroke-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(0, 0, 0);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                    <div style="float:left" class="stroke-width-group toolbar-option">
                        <span class="lbl" style="line-height: 10px;">Stroke Width:</span>
                        <br>
                        <select id="shape-stroke-width" style="margin-top: 2px;height:30px;">
                            <option>1</option>
                            <option selected="">2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>8</option>
                            <option>10</option>
                            <option>12</option>
                        </select>
                    </div>
                </div>
                <div id="erase-toolbar" class="btn-toolbar editor-toolbar" style="margin-bottom: 0px; padding: 0px 0px 0px 20px; border-top: none; border-right: none; border-bottom: none; border-image: initial; min-height: 38px; text-align: center; border-left: 2px solid rgb(208, 208, 208); height: 42px; float: left; display: none;">
                    <div style="width: 75px;float:left;height:40px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="erase-colorpicker" id="erase-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(255, 255, 255);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                </div>
                <div id="highlight-toolbar" class="btn-toolbar editor-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="width: 75px;float:left;height:40px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="highlight-colorpicker" id="highlight-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(255, 255, 0);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                </div>
                <div id="hyperlink-toolbar" class="btn-toolbar editor-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="width: 115px;float:left;height:40px;" class="stroke-group toolbar-option">
                        <span class="lbl" style="line-height: 10px;">Border Color:</span>
                        <br>
                        <input type="text" name="hyperlink-colorpicker" id="hyperlink-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                    <div style="float:left" class="stroke-width-group toolbar-option">
                        <span class="lbl" style="line-height: 10px;">Border Stroke Width:</span>
                        <br>
                        <select id="hyperlink-stroke-width" style="margin-top: 2px;height:30px;">
                            <option selected="">0</option>
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>8</option>
                            <option>10</option>
                            <option>12</option>
                        </select>
                    </div>
                    <div style="float: left; margin-top: 6px; margin-left: 10px; display: block;" class="btn btn-default" id="hyperlink-properties">
                        Link Properties
                    </div>
                </div>
                <div id="symbol-toolbar" class="btn-toolbar editor-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;min-height:38px;text-align:center;border-left: 2px solid #d0d0d0;padding-left:20px;height:42px;float:left;">
                    <div style="width:75px;float:left;height:40px;">
                        <span class="lbl" style="line-height: 10px;">Color:</span>
                        <br>
                        <input type="text" name="symbol-colorpicker" id="symbol-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner" style="background-color: rgb(0, 0, 0);"></div></div><div class="sp-dd">▼</div></div>
                    </div>
                    <div style="float:left">
                        <span class="lbl" style="line-height: 10px;">Size:</span>
                        <br>
                        <select id="symbol-size-select" style="margin-top: 2px;height:30px;">
                            <option>1</option>
                            <option selected="">2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>7</option>
                            <option>8</option>
                        </select>
                    </div>
                </div>
                <div style="text-align: right;padding-top: 3px;">
                    <div class="btn btn-default pull-right" id="help-btn" style="height:34px;padding: 5px 12px">
                        <i class="fas fa-question-circle" style="margin-right:4px;font-size:22px;" aria-hidden="true"></i>
                        <span style="padding-right: 5px;font-size:16px;vertical-align: top;">Help</span>
                    </div>
                </div>
            </div>
            <div style="flex-grow: 1; overflow: hidden; margin-top: -5px; position: relative; height: 186px;" id="file-section">
                <div style="position: absolute;height: 100%;width: 100%;display: -webkit-box;display: -moz-box;display: -ms-flexbox;display: -webkit-flex;display: flex;-webkit-flex-direction: row;-moz-flex-direction: row;-ms-flex-direction: row;-o-flex-direction: row; flex-direction: row;">
                    <div style="touch-action: manipulation;-ms-touch-action: manipulation;width: 200px;outline: 0;background-color: rgb(238, 238, 238);border-right: #CCC 1px solid;display: -webkit-box;display: -moz-box;display: -ms-flexbox;display: -webkit-flex;display: flex;-webkit-flex-direction: column;-moz-flex-direction: column;-ms-flex-direction: column;-o-flex-direction: column;flex-direction: column;overflow-y: auto;" id="left-side-panel">
                        <div style="-webkit-flex-grow: 1;-moz-flex-grow: 1;-ms-flex-grow: 1;-o-flex-grow: 1;flex-grow: 1;padding: 0;text-align: center;margin: 10px auto 40px;">
                            <div id="thumb_pane">
                                <div id="thumb_1" class="thumb_element thumb_preview" data-page-shown="1" data-page-idx="1"><div style="position: relative; width: 100px; height: 129px;"><canvas id="thumb_canvas_1" class="deg-0 lozad thumb-canvas" data-rotation="0" width="100" height="129" data-loaded="true"></canvas><div id="active-thumb-1" class="active-editor" style="height: 100%; position: absolute; top: 0px; width: 100px; left: 0px;"><div class="active-layer"><div data-id="hYuwcAdGem7tRA1" data-type="TEXT_FIELD" class="active-element text-field-element is-editing helvetica-font" style="border: none; font-size: 2.28758px; left: 76.0349px; top: 30.8932px; color: rgb(0, 0, 0); font-weight: normal; font-style: normal; text-align: left; padding-left: 0px; padding-right: 0px; margin-top: 0px; text-decoration-skip-ink: none; height: 4.13943px; width: 16.3399px; overflow: hidden; line-height: 4.13943px; white-space: nowrap;"></div></div></div></div><div><small class="thumb-number">Page 1</small></div></div>
                            </div>
                        </div>
                    </div>
                    <div style="-webkit-flex-grow: 1;-moz-flex-grow: 1;-ms-flex-grow: 1;-o-flex-grow: 1;flex-grow: 1;position: relative;display: flex;flex-direction: column;background-color: #fafafa;">
                        <div style="touch-action: none;user-select: none;-webkit-user-drag: none;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);-webkit-flex-grow: 1;-moz-flex-grow: 1;-ms-flex-grow: 1;-o-flex-grow: 1;flex-grow: 1;position: relative;overflow: auto;" id="pdf-viewport">
                            <div style="position: absolute; width: 1076px; height: 100%; min-width: 1076px; max-width: 1076px; min-height: 1228px;" id="page-size-coord">
                                <div style="position: relative; margin: 10px 79px;" id="centre-pdf">
                                    <div style="position: absolute;overflow: visible;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;-o-user-select: none;user-select: none;touch-action: manipulation; -ms-touch-action: manipulation;top: 0px;">
                                        <div style="position: relative;">
                                            <div class="loaded-pdf-element" id="pdf-wrapper" style="box-shadow: rgba(0, 0, 0, 0.3) 0px 1px 3px; background: rgb(255, 255, 255); width: 100%; overflow: hidden; height: 1188px; display: block;">
                                                <canvas id="pdf-canvas" style="position: relative;left: 0px;top: 0px;" height="1188" width="918"></canvas>
                                                <div id="new-surface" class="pdf-editor active-editor" style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; display: block;" spellcheck="false">
                                                    <div id="linkForm" style="display: none;position: absolute;z-index: 10000;width:350px;" aria-hidden="true">
                                                        <div class="modal-content">
                                                            <button type="button" id="close-link-form" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                            <br>
                                                            <div style="padding: 0px 20px 20px;">
                                                                <form>
                                                                    <div class="form-group">
                                                                        <h3>Link properties</h3>
                                                                        <div class="radio">
                                                                            <label>
                                                                                <input checked="" value="uri" name="kind" type="radio">
                                                                                Link to external URL
                                                                                <br>
                                                                                <select id="link-prefix" name="linkPrefix" style="float: left;height: 30px;">
                                                                                    <option selected="selected" value="https://">https://</option>
                                                                                    <option value="http://">http://</option>
                                                                                    <option value="">&lt;none&gt;</option>
                                                                                </select>
                                                                                <input placeholder="www.example.com" name="linkUrl" class="form-control" type="text" value="www.example.com" style="float: left;width:215px;">
                                                                            </label>
                                                                        </div>
                                                                        <div class="radio" style="clear: both;">
                                                                            <label>
                                                                                <input value="page" name="kind" type="radio">
                                                                                Link to internal page
                                                                                <input placeholder="2" name="linkPage" class="form-control" type="text" value="2">
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                    <input name="elementId" type="hidden" id="elementId">
                                                                </form>
                                                            </div>
                                                            <script type="text/javascript">
                                                                $("#close-link-form").on('click', function () {
                                                                    hideLinkForm();
                                                                });
                                                            </script>
                                                        </div>
                                                    </div>
                                                    <div id="element-layer" class="active-layer"><div data-id="hYuwcAdGem7tRA1" data-type="TEXT_FIELD" class="active-element text-field-element is-editing form-field-element helvetica-font" style="border: none; font-size: 21px; left: 698px; top: 283.6px; color: rgb(0, 0, 0); font-weight: normal; font-style: normal; text-align: left; padding-left: 0px; padding-right: 0px; margin-top: 0px; text-decoration-skip-ink: none; height: 38px; width: 150px; overflow: hidden; line-height: 38px; white-space: nowrap;"></div><p data-id="EdwRXU9scAdRYdC" data-type="TEXT" class="active-element text-element is-editing helvetica-font" contenteditable="true" style="left: 65px; top: 358.4px; color: rgb(0, 0, 0); font-size: 21px; font-weight: normal; font-style: normal; text-align: left; padding-left: 0px; padding-right: 0px; margin-top: 0px; line-height: 21px; text-decoration: none; text-decoration-skip-ink: none; display: none;"></p></div><canvas id="path-layer" class="active-layer" style="position:absolute;left:0;top:0;"></canvas><div id="text-layer" class="active-layer"></div><div id="annot-transformer" style="display: none;">
                                                        <div class="drag-overlay"></div>
                                                        <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                    </div><div id="el-aligner" style="display: none;">
                                                        <div class="align-line" id="left-line" style="left: 40px;"></div>
                                                        <div class="align-line" id="top-line" style="top: 384px;"></div>
                                                        <div class="align-line" id="right-line" style="left: 205px;"></div>
                                                        <div class="align-line" id="bottom-line" style="top: 476px;"></div>
                                                    </div><div id="creation-layer" class="active-layer"></div><div id="transform-layer" class="active-layer text-mode selected-text-mode"><div class="transform-element text-field-transform-element form-transform-element" data-id="hYuwcAdGem7tRA1" style="left:698px;top:283.6px;width:150px;height:38px;margin-top:0px;z-index:101;" tabindex="AdGem7tRA1"></div><div class="transform-element" data-id="EdwRXU9scAdRYdC" style="left: 65px; top: 358.4px; width: 24px; height: 21px; margin-top: 0px; display: none;"></div></div><div id="transformer" style="display: none; left: 41px; top: 385px; width: 164px; height: 91px;" class="resize-all">
                                                        <div class="drag-overlay"></div>
                                                        <div class="ui-resizable-handle ui-resizable-nw" id="nwgrip" style="display: block;"></div>
                                                        <div class="ui-resizable-handle ui-resizable-ne" id="negrip" style="display: block;"></div>
                                                        <div class="ui-resizable-handle ui-resizable-sw" id="swgrip" style="display: block;"></div>
                                                        <div class="ui-resizable-handle ui-resizable-se" id="segrip" style="display: block;"></div>
                                                        <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                    </div><div id="text-transformer" style="display: block; left: 65px; top: 358.4px;" class="ui-draggable ui-draggable-handle ui-draggable-disabled is-editing">
                                                        <div class="text-transformer-text-element helvetica-font" contenteditable="true" tabindex="0" style="color: rgb(0, 0, 0); font-size: 21px; font-weight: normal; font-style: normal; text-align: left; line-height: 21px; text-decoration: none; text-decoration-skip-ink: none; outline: none;">zxcxzcz</div>
                                                        <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                        <a class="btn edit-element-button"><i class="fas fa-pencil-alt" style="color:#CC0000" aria-hidden="true"></i></a>
                                                        <a class="btn drag-element-button"><i class="fas fa-arrows-alt" style="color:#CC0000" aria-hidden="true"></i></a>
                                                    </div><div id="text-field-transformer" style="display: none;" class="ui-resizable ui-draggable ui-draggable-handle ui-draggable-disabled">
                                                        <input class="text-field-transformer-text-element">
                                                        <span class="edit-tools" style="display: none;">
                                                            <div class="ui-resizable-handle ui-resizable-nw" id="nwgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-n" id="ngrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-ne" id="negrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-w" id="wgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-sw" id="swgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-s" id="sgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-se" id="segrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-e" id="egrip"></div>
                                                            <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                            <a class="btn drag-element-button"><i class="fas fa-arrows-alt" style="color:#CC0000" aria-hidden="true"></i></a>
                                                        </span>
                                                    </div><div id="date-field-transformer" style="display: none;" class="ui-resizable ui-draggable ui-draggable-handle ui-draggable-disabled">
                                                        <input class="date-field-transformer-text-element" type="text">
                                                        <span class="edit-tools" style="display: none;">
                                                            <div class="ui-resizable-handle ui-resizable-nw" id="nwgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-n" id="ngrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-ne" id="negrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-w" id="wgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-sw" id="swgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-s" id="sgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-se" id="segrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-e" id="egrip"></div>
                                                            <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                            <a class="btn drag-element-button"><i class="fas fa-arrows-alt" style="color:#CC0000" aria-hidden="true"></i></a>
                                                        </span>
                                                    </div><div id="check-field-transformer" style="display: none;" class="ui-resizable ui-draggable ui-draggable-handle ui-draggable-disabled">
                                                        <div class="check-field-transformer-checkbox">
                                                        </div>
                                                        <span class="edit-tools" style="display: none;">
                                                            <div class="ui-resizable-handle ui-resizable-nw" id="nwgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-ne" id="negrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-sw" id="swgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-se" id="segrip"></div>
                                                            <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                            <a class="btn drag-element-button"><i class="fas fa-arrows-alt" style="color:#CC0000" aria-hidden="true"></i></a>
                                                        </span>
                                                    </div><div id="combo-field-transformer" style="display: none;" class="ui-resizable ui-draggable ui-draggable-handle ui-draggable-disabled">
                                                        <select class="combo-field-transformer-element"></select>
                                                        <span class="edit-tools" style="display: none;">
                                                            <div class="ui-resizable-handle ui-resizable-nw" id="nwgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-n" id="ngrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-ne" id="negrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-w" id="wgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-sw" id="swgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-s" id="sgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-se" id="segrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-e" id="egrip"></div>
                                                            <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                            <a class="btn drag-element-button"><i class="fas fa-arrows-alt" style="color:#CC0000" aria-hidden="true"></i></a>
                                                        </span>
                                                    </div><div id="sig-field-transformer" style="display: none;" class="ui-resizable ui-draggable ui-draggable-handle ui-draggable-disabled">
                                                        <div class="sig-field-transformer-element">
                                                        </div>
                                                        <span class="edit-tools" style="display: none;">
                                                            <div class="ui-resizable-handle ui-resizable-nw" id="nwgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-n" id="ngrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-ne" id="negrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-w" id="wgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-sw" id="swgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-s" id="sgrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-se" id="segrip"></div>
                                                            <div class="ui-resizable-handle ui-resizable-e" id="egrip"></div>
                                                            <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                            <a class="btn drag-element-button"><i class="fas fa-arrows-alt" style="color:#CC0000" aria-hidden="true"></i></a>
                                                        </span>
                                                    </div><div id="vert-transformer" style="display: none;" class="resize-all ui-resizable ui-draggable ui-draggable-handle">
                                                        <div class="drag-overlay"></div>
                                                        <div class="ui-resizable-handle ui-resizable-n" id="ngrip" style="display: block;"></div>
                                                        <div class="ui-resizable-handle ui-resizable-s" id="sgrip" style="display: block;"></div>
                                                        <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                    </div><div id="hori-transformer" style="display: none;" class="resize-all ui-resizable ui-draggable ui-draggable-handle">
                                                        <div class="drag-overlay"></div>
                                                        <div class="ui-resizable-handle ui-resizable-e" id="egrip" style="display: block;"></div>
                                                        <div class="ui-resizable-handle ui-resizable-w" id="wgrip" style="display: block;"></div>
                                                        <a class="delete-element-button"><i class="fas fa-times-circle" style="position: absolute;color: #CC0000;font-size: 20px;" aria-hidden="true"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="touch-action: manipulation; width: 200px; outline: 0px; background-color: rgb(238, 238, 238); border-left: 1px solid rgb(204, 204, 204); flex-direction: column; overflow-y: auto; display: none;" id="right-side-panel" class="">
                        <div style="-webkit-flex-grow: 1;-moz-flex-grow: 1;-ms-flex-grow: 1;-o-flex-grow: 1;flex-grow: 1;text-align: center;margin: 0px auto 40px;">
                            <div id="form_field_pane">
                                <h4 id="title-field-type" style="background-color: #d0d0d0;margin: 0px;padding: 10px;font-weight:bold;font-size: 16px;">Form Field Order</h4>
                                <div id="text-field-properties" style="margin-top: 10px; display: none;">
                                    <div class="text-field-prop">
                                        <span>Field name</span>
                                        <input type="text" name="text-field-name" id="text-field-name">
                                    </div>
                                    <div class="text-field-prop">
                                        <span>Placeholder</span>
                                        <input type="text" name="text-field-placeholder" id="text-field-placeholder">
                                    </div>
                                    <div class="text-field-prop" style="margin-bottom: 5px;text-align: center;">
                                        <input type="checkbox" name="text-field-required" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="text-field-required">
                                        <span>Required</span>
                                    </div>
                                    <div style="margin-bottom: 5px;text-align: center;" class="text-field-prop text-field-only">
                                        <input type="checkbox" name="text-field-comb" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="text-field-comb">
                                        <span>Combed</span>
                                        <i class="fas fa-info-circle" data-toggle="popover" data-placement="left" data-container="body" data-content="Combed: Evenly spaced characters according to the character length set. (Character length must be set to apply combing)" style="cursor:pointer;" aria-hidden="true" data-original-title="" title=""></i>
                                    </div>
                                    <div class="text-field-prop">
                                        <div>Character Length</div>
                                        <input type="number" name="text-field-maxlength" id="text-field-maxlength" style="width: 65px;" min="1" max="1000000000">
                                        <span id="maxlength-reset" class="color-reset" style="vertical-align: top;line-height: 30px;">Clear</span>
                                    </div>
                                    <div class="form-styles">
                                        <div id="text-field-back-color" style="margin-bottom: 10px;" class="text-field-prop">
                                            <div class="lbl">Background Color:</div>
                                            <input type="text" name="text-field-back-colorpicker" id="text-field-back-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="text-field-back-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div id="text-field-border-color" style="margin-bottom: 10px;" class="text-field-prop">
                                            <div class="lbl">Border Color:</div>
                                            <input type="text" name="text-field-border-colorpicker" id="text-field-border-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="text-field-border-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div class="text-field-border-width-group toolbar-option text-field-prop" style="margin-bottom: 10px;">
                                            <div class="lbl">Border Width:</div>
                                            <select id="text-field-border-width" style="margin-top: 2px;height:30px;">
                                                <option selected="">0</option>
                                                <option>1</option>
                                                <option>2</option>
                                                <option>3</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div id="combo-field-properties" style="display: none;">
                                    <div class="combo-field-prop combo-pro-only" style="margin: 0px 0px 10px;background-color: #fff;padding:15px 5px 25px;">
                                        <span>Add choices</span>
                                        <div style="margin-top:5px;">
                                            <input type="text" name="dd-item" id="dd-item" style="width:115px;margin-bottom: 0px;">
                                            <span class="btn btn-default" id="dd-choice-btn" style="font-size: 13px;padding: 5px 6px;height: 30px;line-height: 18px;">
                                                <i class="fas fa-plus" style="margin-right: 5px;" aria-hidden="true"></i>Add
                                            </span>
                                        </div>
                                        <div id="dd-choices" style="padding: 0px 3px;"></div>
                                    </div>
                                    <div class="combo-pro-only" style="margin: 10px 0px 5px;">
                                        <div class="combo-field-prop" style="margin-bottom: 5px;text-align: center;">
                                            <input type="checkbox" name="combo-field-sort" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="combo-field-sort">
                                            <span>Sort choices</span>
                                        </div>
                                        <div class="combo-field-prop dd-pro-only" style="margin-bottom: 5px;text-align: center;">
                                            <input type="checkbox" name="combo-field-edit" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="combo-field-edit">
                                            <span>Allow custom choice</span>
                                        </div>
                                        <div class="combo-field-prop list-pro-only" style="margin-bottom: 5px;text-align: center;">
                                            <input type="checkbox" name="combo-field-multiple" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="combo-field-multiple">
                                            <span>Allow multiple selected</span>
                                        </div>
                                        <div class="combo-field-prop dd-pro-only" style="margin-bottom: 5px;text-align: center;">
                                            <input type="checkbox" name="combo-field-empty" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="combo-field-empty">
                                            <span>Allow an empty choice</span>
                                        </div>

                                    </div>
                                    <div class="combo-field-prop" style="margin-top:10px;">
                                        <span>Field name</span>
                                        <input type="text" name="combo-field-name" id="combo-field-name">
                                    </div>
                                    <div class="combo-field-prop" style="margin-bottom: 5px;text-align: center;">
                                        <input type="checkbox" name="combo-field-required" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="combo-field-required">
                                        <span>Required</span>
                                    </div>
                                    <div class="form-styles">
                                        <div id="combo-field-back-color" style="margin-bottom: 10px;" class="combo-field-prop">
                                            <div class="lbl">Background Color:</div>
                                            <input type="text" name="combo-field-back-colorpicker" id="combo-field-back-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="combo-field-back-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div id="combo-field-border-color" style="margin-bottom: 10px;" class="combo-field-prop">
                                            <div class="lbl">Border Color:</div>
                                            <input type="text" name="combo-field-border-colorpicker" id="combo-field-border-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="combo-field-border-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div class="combo-field-border-width-group toolbar-option combo-field-prop" style="margin-bottom: 10px;">
                                            <div class="lbl">Border Width:</div>
                                            <select id="combo-field-border-width" style="margin-top: 2px;height:30px;">
                                                <option selected="">0</option>
                                                <option>1</option>
                                                <option>2</option>
                                                <option>3</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div id="date-field-properties" style="margin-top: 10px; display: none;">
                                    <div class="date-field-prop">
                                        <span>Field name</span>
                                        <input type="text" name="date-field-name" id="date-field-name">
                                    </div>
                                    <div class="date-field-prop" style="margin-bottom: 5px;text-align: center;">
                                        <input type="checkbox" name="date-field-required" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="date-field-required">
                                        <span>Required</span>
                                    </div>
                                    <div class="form-styles">
                                        <div id="date-field-back-color" style="margin-bottom: 10px;" class="date-field-prop">
                                            <div class="lbl">Background Color:</div>
                                            <input type="text" name="date-field-back-colorpicker" id="date-field-back-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="date-field-back-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div id="date-field-border-color" style="margin-bottom: 10px;" class="date-field-prop">
                                            <div class="lbl">Border Color:</div>
                                            <input type="text" name="date-field-border-colorpicker" id="date-field-border-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="date-field-border-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div class="date-field-border-width-group toolbar-option date-field-prop">
                                            <div class="lbl">Border Width:</div>
                                            <select id="date-field-border-width" style="margin-top: 2px;height:30px;">
                                                <option selected="">0</option>
                                                <option>1</option>
                                                <option>2</option>
                                                <option>3</option>
                                            </select>
                                        </div>
                                        <div id="date-field-format-group" class="date-field-prop" style="margin-bottom: 5px;">
                                            <div class="lbl">Date Format:</div>
                                            <select id="date-field-format" style="margin-top: 2px;height:30px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true">
                                                <option value="M/D/YY">M/D/YY</option>
                                                <option value="MM/DD/YY">MM/DD/YY</option>
                                                <option value="D/M/YY">D/M/YY</option>
                                                <option value="DD/MM/YY">DD/MM/YY</option>
                                                <option value="MMMM D, YYYY">MMMM D, YYYY</option>
                                                <option value="M/D/YYYY">M/D/YYYY</option>
                                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                                <option value="D/M/YYYY">D/M/YYYY</option>
                                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                <option value="MMM D, YYYY">MMM D, YYYY</option>
                                                <option value="D-MMM">D-MMM</option>
                                                <option value="D-MMM-YY">D-MMM-YY</option>
                                                <option value="D-MMM-YYYY">D-MMM-YYYY</option>
                                                <option value="DD-MMM-YY">DD-MMM-YY</option>
                                                <option value="DD-MMM-YYYY">DD-MMM-YYYY</option>
                                                <option value="M/D">M/D</option>
                                                <option value="MM/YY">MM/YY</option>
                                                <option value="MM/YYYY">MM/YYYY</option>
                                                <option value="YY-MM-DD">YY-MM-DD</option>
                                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                                <option value="MMM-YY">MMM-YY</option>
                                                <option value="MMM-YYYY">MMM-YYYY</option>
                                                <option value="MMMM-YY">MMMM-YY</option>
                                                <option value="MMMM-YYYY">MMMM-YYYY</option>
                                                <option value="M/D/YYYY h:mm a">M/D/YYYY h:mm a</option>
                                                <option value="M/D/YYYY HH:mm">M/D/YYYY HH:mm</option>
                                                <option value="M/D/YY h:mm a">M/D/YY h:mm a</option>
                                                <option value="M/D/YY HH:mm">M/D/YY HH:mm</option>
                                            </select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: auto;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-date-field-format-container"><span class="select2-selection__rendered" id="select2-date-field-format-container" title="M/D/YY">M/D/YY</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                                            <div id="today-format" style="font-weight: bold;padding:5px;">10/1/20</div>
                                            <script type="text/javascript">
                                                var dateFieldFormats = ["M/D/YY", "MM/DD/YY", "D/M/YY", "DD/MM/YY", "MMMM D, YYYY", "M/D/YYYY", "MM/DD/YYYY", "D/M/YYYY", "DD/MM/YYYY", "MMM D, YYYY", "D-MMM", "D-MMM-YY", "D-MMM-YYYY", "DD-MMM-YY", "DD-MMM-YYYY", "M/D", "MM/YY", "MM/YYYY", "YY-MM-DD", "YYYY-MM-DD", "MMM-YY", "MMM-YYYY", "MMMM-YY", "MMMM-YYYY", "M/D/YYYY h:mm a", "M/D/YYYY HH:mm", "M/D/YY h:mm a", "M/D/YY HH:mm"];
                                                $(document).ready(function () {
                                                    $("#date-field-format").select2({
                                                        tags: true,
                                                        data: dateFieldFormats,
                                                        createTag: function (params) {
                                                            // if (/^([1-9]+[0-9]*)$/.test(params.term)) {
                                                            // } else {
                                                            //   return null;
                                                            // }
                                                            return {
                                                                id: params.term,
                                                                text: params.term
                                                            }
                                                        }
                                                    });

                                                    $("#date-field-format").on("change", function (e) {
                                                        var thisItem = $("#select2-date-field-format-container").text();
                                                        if (_.contains(dateFieldFormats, thisItem)) { } else {
                                                            dateFieldFormats.push(thisItem);
                                                            $('#date-field-format').refreshDataSelect2(dateFieldFormats, "m/d/yy");
                                                            $('#date-field-format').find("option[value='" + thisItem + "']").prop("selected", "selected");
                                                        }
                                                        $("#today-format").text(moment().format(thisItem));
                                                        var activeElement = $("#new-surface").activeEditor("selectedElement").activeElement;
                                                        if (activeElement) {
                                                            activeElement.activeElement("fillDateField", thisItem);
                                                        }
                                                        updateDateFieldSettings();
                                                    });

                                                    $("#today-format").text(moment().format("M/D/YY"));
                                                });
                                            </script>
                                        </div>
                                        <div id="date-field-fill-btn" class="date-field-prop btn btn-default" style="margin-bottom: 10px;">
                                            Insert today's date
                                        </div>
                                    </div>
                                </div>
                                <div id="page-fields-properties" style="margin-top: 10px;">
                                    <ul id="field-sortable" style="margin-left: 0px;list-style-type: none;padding: 0px 5px;font-size: 12px;" class="ui-sortable"><li class="form-order-item ui-state-default" data-id="hYuwcAdGem7tRA1"><span class="ui-icon ui-icon-grip-dotted-vertical"></span>TexthLg2A</li></ul>
                                </div>
                                <div id="check-field-properties" style="display:none;margin-top:10px;">
                                    <div class="check-field-prop check-field-only">
                                        <span>Field name</span>
                                        <input type="text" name="check-field-name" id="check-field-name">
                                    </div>
                                    <div class="check-field-prop radio-field-only">
                                        <span>Group name</span>
                                        <input type="text" name="check-field-group" id="check-field-group">
                                    </div>
                                    <div class="check-field-prop" style="margin-bottom: 5px;text-align: center;">
                                        <input type="checkbox" name="check-field-required" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="check-field-required">
                                        <span>Required</span>
                                    </div>
                                    <div class="check-field-prop">
                                        <span>Export value</span>
                                        <i class="fas fa-info-circle" data-toggle="popover" data-placement="left" data-container="body" data-content="Export value: the value assigned to the checkbox" style="cursor:pointer;" aria-hidden="true" data-original-title="" title=""></i>
                                        <input type="text" name="check-field-export" value="yes" id="check-field-export">
                                    </div>
                                    <div class="form-styles">
                                        <div id="check-field-back-color" style="margin-bottom: 10px;" class="check-field-prop">
                                            <div class="lbl">Background Color:</div>
                                            <input type="text" name="check-field-back-colorpicker" id="check-field-back-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="check-field-back-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div id="check-field-border-color" style="margin-bottom: 10px;" class="check-field-prop">
                                            <div class="lbl">Border Color:</div>
                                            <input type="text" name="check-field-border-colorpicker" id="check-field-border-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="check-field-border-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div class="check-field-border-width-group toolbar-option check-field-prop" style="margin-bottom: 10px;">
                                            <div class="lbl">Border Width:</div>
                                            <select id="check-field-border-width" style="margin-top: 2px;height:30px;">
                                                <option selected="">0</option>
                                                <option>1</option>
                                                <option>2</option>
                                                <option>3</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div id="sig-field-properties" style="margin-top: 10px; display: none;">
                                    <div class="sig-field-prop">
                                        <span>Field name</span>
                                        <input type="text" name="sig-field-name" id="sig-field-name">
                                    </div>
                                    <div class="sig-field-prop" style="margin-bottom: 5px;text-align: center;">
                                        <input type="checkbox" name="sig-field-required" style="height: 19px !important;vertical-align: text-top;margin: 0px;" id="sig-field-required">
                                        <span>Required</span>
                                    </div>
                                    <div class="form-styles">
                                        <div id="sig-field-back-color" style="margin-bottom: 10px;" class="sig-field-prop">
                                            <div class="lbl">Background Color:</div>
                                            <input type="text" name="sig-field-back-colorpicker" id="sig-field-back-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="sig-field-back-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div id="sig-field-border-color" style="margin-bottom: 10px;" class="sig-field-prop">
                                            <div class="lbl">Border Color:</div>
                                            <input type="text" name="sig-field-border-colorpicker" id="sig-field-border-colorpicker" style="display: none;"><div class="sp-replacer sp-light"><div class="sp-preview"><div class="sp-preview-inner sp-clear-display" style="background-color: transparent;"></div></div><div class="sp-dd">▼</div></div>
                                            <span id="sig-field-border-reset" class="color-reset">Reset</span>
                                        </div>
                                        <div class="sig-field-border-width-group toolbar-option sig-field-prop" style="margin-bottom: 10px;">
                                            <div class="lbl">Border Width:</div>
                                            <select id="sig-field-border-width" style="margin-top: 2px;height:30px;">
                                                <option selected="">0</option>
                                                <option>1</option>
                                                <option>2</option>
                                                <option>3</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 5px;text-align: center;" class="sig-field-prop sig-field-only">
                                        <a data-toggle="modal" data-target="#signature-modal" data-backdrop="false" class="btn btn-default" id="sig-field-fill-btn" href="/pdf_signatures?sig_field=true">
                                            Insert Signature
                                        </a>
                                    </div>
                                    <div style="margin-bottom: 5px;text-align: center;" class="sig-field-prop initials-field-only">
                                        <a data-toggle="modal" data-target="#initials-modal" data-backdrop="false" class="btn btn-default" id="initials-field-fill-btn" href="/pdf_initials">
                                            Insert Initials
                                        </a>
                                    </div>
                                    <div class="sig-field-prop btn btn-default" id="sig-field-clear" style="margin-top: 10px; display: none;">
                                        Clear field
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="thumbnails-view" style="display: none;background-color: #fff;height: 100%;padding-bottom: 103px;overflow: auto;">
            <div class="row" style="height:100%;">
                <div class="col-xs-12" style="padding: 0px;height:100%;">
                    <div id="delete-pages-toolbar" class="btn-toolbar editor-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;text-align:center;height:42px;width:100%;">
                        <span class="lbl" style="line-height: 20px;">Delete page numbers:&nbsp;</span>
                        <div style="display:inline;margin-right: 5px;">
                            <input min="1" value="1" type="number" name="location1" id="pro_file_location" style="width: 50px;">
                            <span class="lbl" style="line-height: 10px;margin-left: 5px;">&nbsp;to&nbsp;</span>
                            <input min="1" value="1" type="number" name="location2" id="pro_file_location2" style="width: 50px;">
                        </div>
                        <div id="delete-locations" class="btn btn-default" style="font-size: 15px;padding: 4px 8px;margin-bottom: 6px;margin-left: 0px;">OK</div>
                    </div>
                    <div id="rotate-toolbar" class="btn-toolbar editor-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;text-align:center;height:42px;width:100%;">
                        <div class="stroke-group toolbar-option">
                            <span class="lbl" style="line-height: 10px;margin-right: 10px;">Rotate all pages:</span>
                            <div class="btn-group" role="group" aria-label="degrees" id="rotate-all-btns" style="margin-top: 4px;">
                                <button type="button" class="btn btn-default" data-degrees="270" style="padding: 5px 8px;"><i class="fas fa-undo" aria-hidden="true"></i><span style="padding-left: 8px;">90°</span></button>
                                <button type="button" class="btn btn-default" data-degrees="0" style="padding: 5px 8px;"><span style="padding: 0px 3px;">0°</span></button>
                                <button type="button" class="btn btn-default" data-degrees="90" style="padding: 5px 8px;"><i class="fas fa-redo" aria-hidden="true"></i><span style="padding-left: 8px;">90°</span></button>
                                <button type="button" class="btn btn-default" data-degrees="180" style="padding: 5px 8px;"><i class="fas fa-sync" aria-hidden="true"></i><span style="padding-left: 8px;">180°</span></button>
                            </div>
                        </div>
                    </div>

                    <div id="reorder-toolbar" class="btn-toolbar editor-toolbar" style="display:none; margin-bottom: 0px;padding:0px;border:none;text-align:center;height:42px;width:100%;">
                        <span class="lbl" style="line-height: 42px;">Drag &amp; drop the thumbnails below to reorder your file</span>
                    </div>
                    <div style="text-align:center;margin:3px auto;display:table;min-width: 100%;min-height: 300px;height:100%;" id="sortable-parent">
                        <ul id="sortable" style="margin: 0px;padding:0px 5px 20px;height:100%;" class="ui-sortable"><li class="ui-state-default grabbable reorder-item ui-sortable-handle" id="original_index_1" data-ordered-page="1" data-original-page="1"><div class="page-delete" id="delete_1"><span class="fas fa-times close" style="top: 0px;font-size:16px;opacity:0.5px" aria-hidden="true"></span></div><div id="sortable_1" class="thumb_element" data-page-idx="1" style="padding: 5px 18px;display: table-cell;vertical-align: middle;"><div style="display: table-cell;vertical-align: middle;position: relative;height:200px"><canvas id="sortable_canvas_1" style="box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);border: 1px solid #e1e1e;" class="lozad page-canvas deg-0" data-rotation="0" width="100px" height="141px"></canvas><div id="active-editor-1" class="active-editor" style="height: 200px;position: absolute;top: 0px;width: 100%;"><div class="active-layer"></div></div></div><div class="btn-group" role="group" aria-label="rotate" style="margin: 0 auto;display: table;"><button type="button" class="btn" style="border: 1px solid #ccc;" data-degrees="-90"><i class="fas fa-undo" aria-hidden="true"></i></button><button type="button" class="btn" style="border: 1px solid #ccc;" data-degrees="90"><i class="fas fa-redo" aria-hidden="true"></i></button></div><div class="reorder-number" style="float:left;width:100%;font-size:14px;font-weight:bold;padding-top:5px;">Page 1</div></div><input type="hidden" value="1" class="reorder-index"></li></ul>
                    </div>
                    <div id="merge-master" style="display:none;"></div>
                    <div id="protect-form" style="display:none;overflow-y:auto;height:100%;" class="no-print">
                        <div style="padding-top:15px;background-color:#ffffff;max-width: 1000px;margin: 10px auto 25px;">
                            <div id="change-protect-settings">
                                <form>
                                    <div style="font-size:20px;margin-bottom: 5px;">Document Open</div>
                                    <div style="margin-bottom: 7px;"><input id="open-password-checkbox" type="checkbox" name="open-password-checkbox" style="margin-top: -4px;margin-right: 2px;"> Require a password to open the document</div>
                                    <fieldset disabled="" id="open-password-required">
                                        <div style="margin-bottom: 10px;">Document Open Password: <input id="open-password-input" type="password" name="open-password-input" style="margin-left: 3px;margin-bottom: 0px;"></div>
                                        <div style="margin-bottom: 10px;">Re-enter Document Open Password: <input id="open-password-confirmation-input" type="password" name="open-password-confirmation-input" style="margin-left: 3px;margin-bottom: 0px;"></div>
                                    </fieldset>
                                    <div style="margin-bottom: 24px;"><i class="fas fa-info-circle" style="margin-right: 5px;" aria-hidden="true"></i><span id="document-open-alert">No password will be required to open this PDF.</span></div>
                                    <div style="font-size:20px;margin-bottom: 5px;">Permissions</div>
                                    <div style="margin-bottom: 10px;"><input id="owner-password-checkbox" type="checkbox" name="owner-password-checkbox" style="margin-top: -4px;margin-right: 2px;"> Require a password to edit or print the document</div>
                                    <fieldset disabled="" id="owner-password-required" style="margin-bottom: 15px;">
                                        <div style="margin-bottom: 15px;">
                                            Printing allowed:
                                            <select id="owner-printing" style="margin-left: 7px;margin-bottom: 0px;height:100%;width:490px;">
                                                <option value="none">None</option>
                                                <option value="lowRes">Low resolution</option>
                                                <option value="highRes">High resolution</option>
                                            </select>
                                        </div>
                                        <div style="margin-bottom: 15px;">
                                            Changes allowed:
                                            <select id="owner-changes" style="margin-left: 3px;margin-bottom: 0px;height:100%;width:490px;">
                                                <option value="none">None</option>
                                                <option value="insertDeleteRotate">Inserting, deleting and rotating pages</option>
                                                <option value="fillForms">Filling in form fields and signing existing signature fields</option>
                                                <option value="comment">Commenting, filling in form fields, and signing existing signature fields</option>
                                                <option value="noExtract">Any except extracting pages</option>
                                            </select>
                                        </div>
                                        <div style="margin-bottom: 10px;"><input id="copying-checkbox" type="checkbox" name="copying-checkbox" style="margin-top: -4px;margin-right: 2px;"> Enable copying of text, images, and other content</div>
                                        <fieldset style="margin-bottom: 10px;" id="text-access-field"><input id="text-access-checkbox" type="checkbox" name="text-access-checkbox" style="margin-top: -4px;margin-right: 2px;"> Enable text access for screen reader devices for the visually impaired</fieldset>
                                        <div style="margin-bottom: 10px;">Permissions Password: <input id="owner-password-input" type="password" name="owner-password-input" style="margin-left: 3px;margin-bottom: 0px;"></div>
                                        <div style="margin-bottom: 10px;">Re-enter Permissions Password: <input id="owner-password-confirmation-input" type="password" name="owner-password-confirmation-input" style="margin-left: 3px;margin-bottom: 0px;"></div>
                                    </fieldset>
                                    <div id="remove-security-btn" class="btn btn-default" style="float:left;margin-right:10px;">Remove security</div>
                                    <div id="submit-protect-btn" class="btn btn-success">Save settings</div>
                                </form>
                            </div>
                            <div id="view-protect-form" style="display:none;">
                                <div style="font-size:18px;margin-bottom: 10px;">This PDF is protected from editing. To change the security settings, please enter a permissions password below.</div>
                                <form id="pdf-view-protect-form" action="/files/aewpulhhsku-f412dfe3/update_password" accept-charset="UTF-8" data-remote="true" method="post">
                                    <input name="utf8" type="hidden" value="✓"><input type="hidden" name="_method" value="put">
                                    <div id="owner-password-field-group" style="margin-bottom: 10px;">
                                        <label for="pro_file_password">Password</label>&nbsp;&nbsp;
                                        <input id="view_protect_password" type="password" name="pro_file[owner_pwd]">
                                    </div>
                                    <input type="hidden" name="process_type" id="update-process-type" value="Protect">
                                    <input type="hidden" name="password_type" id="update-password-type" value="Owner">
                                    <input type="submit" id="submit-owner-btn" class="btn btn-success" value="Submit permissions password">
                                </form>
                                <script type="text/javascript">
                                    $("#pdf-view-protect-form").on('submit', function (e) {
                                        var passwordFieldLength = $("#view_protect_password").val().length;
                                        if (passwordFieldLength > 0) {
                                            $("#owner-password-error").remove();
                                            $("#owner-loading").show();
                                            $("#view-protect-form").hide();
                                        } else {
                                            $("#owner-password-error").remove();
                                            $("#owner-password-field-group").append("<p id='owner-password-error' style='color:red;font-weight:bold;'>You have not entered a password.</p>");
                                            return false;
                                        }
                                    });
                                </script>
                            </div>
                            <div id="owner-loading" style="display:none;text-align:center;">
                                <div style="font-size:20px;margin-bottom:10px;"><b>Loading</b></div>
                                <div><span class="fas fa-sync fa-spin fa-4x fa-fw" style="display:inline-block;" aria-hidden="true"></span></div>
                            </div>
                            <script type="text/javascript">
                                $('#copying-checkbox').change(function () {
                                    if (this.checked) {
                                        $("#text-access-field").prop("disabled", true);
                                        $("#text-access-checkbox").prop("checked", true);
                                    } else {
                                        $("#text-access-field").prop("disabled", false);
                                    }
                                });
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>